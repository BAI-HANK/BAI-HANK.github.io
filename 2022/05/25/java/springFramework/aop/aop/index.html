<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/blog.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/blog.svg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/blog.svg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-big-counter.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"bh.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","width":300,"display":"post","padding":8,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":{"gitalk":{"order":-1}},"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="aop 代理aop 是对 oop 的一种补充。 代理的好处：  控制本来的实现类的可访问性，透过代理对象访问，可以在代理类内创建原本的实现类，对用户而言减少创建的复杂性 做横向拦截，给实现类在不修改代码的情况下，增强功能 业务日志切面：可以记录业务方法调用的痕迹 事务控制：通过切面可以声明式控制事务 权限校验：执行方法之前先校验当前登录用户是否有权调用 数据缓存：执行方法之前先从缓存中取，取到则直">
<meta property="og:type" content="blog">
<meta property="og:title" content="spring framework aop">
<meta property="og:url" content="http://bh.com/2022/05/25/java/springFramework/aop/aop/index.html">
<meta property="og:site_name" content="Hank Blog">
<meta property="og:description" content="aop 代理aop 是对 oop 的一种补充。 代理的好处：  控制本来的实现类的可访问性，透过代理对象访问，可以在代理类内创建原本的实现类，对用户而言减少创建的复杂性 做横向拦截，给实现类在不修改代码的情况下，增强功能 业务日志切面：可以记录业务方法调用的痕迹 事务控制：通过切面可以声明式控制事务 权限校验：执行方法之前先校验当前登录用户是否有权调用 数据缓存：执行方法之前先从缓存中取，取到则直">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://bh.com/2022/05/25/java/springFramework/aop/aop/springAOPTwoWay.png">
<meta property="article:published_time" content="2022-05-25T02:25:37.000Z">
<meta property="article:modified_time" content="2022-12-16T03:55:43.082Z">
<meta property="article:author" content="Hank Bai">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://bh.com/2022/05/25/java/springFramework/aop/aop/springAOPTwoWay.png">


<link rel="canonical" href="http://bh.com/2022/05/25/java/springFramework/aop/aop/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://bh.com/2022/05/25/java/springFramework/aop/aop/","path":"2022/05/25/java/springFramework/aop/aop/","title":"spring framework aop"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>spring framework aop | Hank Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hank Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">热爱生活,拥抱开源,乐于分享</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">8</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">20</span></a></li><li class="menu-item menu-item-others"><a href="/others/" rel="section"><i class="fa fa-users fa-fw"></i>推荐</a></li><li class="menu-item menu-item-read"><a href="/read/" rel="section"><i class="fa fa-book fa-fw"></i>阅读</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#aop-%E4%BB%A3%E7%90%86"><span class="nav-number">1.</span> <span class="nav-text">aop 代理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">1.1.</span> <span class="nav-text">静态代理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">1.2.</span> <span class="nav-text">动态代理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#jdk-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">1.2.1.</span> <span class="nav-text">jdk 动态代理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CGLIB-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">1.2.2.</span> <span class="nav-text">CGLIB 动态代理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%AF%E4%BB%A5%E4%BC%A0%E9%80%92%E5%A4%9A%E4%B8%AA%E5%8A%9F%E8%83%BD%E5%A2%9E%E5%BC%BA%E5%99%A8-%E4%BD%86%E6%98%AF%E9%9C%80%E8%A6%81%E6%8C%87%E5%AE%9A%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">可以传递多个功能增强器,但是需要指定过滤器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Callback-%E5%A2%9E%E5%BC%BA%E5%99%A8%E7%9A%84%E5%85%B6%E4%BB%96%E5%8A%9F%E8%83%BD"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">Callback 增强器的其他功能</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF%E7%9A%84%E5%85%B6%E4%BB%96%E6%8E%A2%E7%B4%A2"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">字节码技术的其他探索</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Byte-Buddy-%E7%B1%BB%E4%BC%BC%E4%BA%8ECGLIB-%E7%9A%84%E5%AD%97%E8%8A%82%E7%A0%81%E6%A1%86%E6%9E%B6"><span class="nav-number">1.2.3.</span> <span class="nav-text">Byte Buddy 类似于CGLIB 的字节码框架</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AspectJ-%E9%9D%99%E6%80%81%E7%BB%87%E5%85%A5"><span class="nav-number">1.3.</span> <span class="nav-text">AspectJ 静态织入</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E7%BB%87%E5%85%A5"><span class="nav-number">1.3.1.</span> <span class="nav-text">静态织入</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E6%97%B6%E7%BB%87%E5%85%A5-aj-%E7%9A%84%E5%8A%9F%E8%83%BD%E5%A2%9E%E5%BC%BA%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">编译时织入.aj 的功能增强文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E6%97%B6%E7%BB%87%E5%85%A5%E6%99%AE%E9%80%9A%E7%9A%84-class-%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">编译时织入普通的 class 文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E7%9A%84%E6%97%B6%E5%80%99%E7%BB%87%E5%85%A5"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">加载的时候织入</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Spring-AOP-%E4%BB%A3%E7%90%86"><span class="nav-number">1.4.</span> <span class="nav-text">Spring AOP 代理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pointcut-%E5%88%87%E7%82%B9"><span class="nav-number">1.4.1.</span> <span class="nav-text">@Pointcut 切点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#execution-%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">execution 正则表达式匹配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#within-%E5%8C%B9%E9%85%8D%E5%88%B0%E7%B1%BB%E4%B8%BA%E6%AD%A2-%E7%B1%BB%E4%B8%8B%E6%96%B9%E6%B3%95%E8%87%AA%E5%8A%A8%E9%83%BD%E5%8C%B9%E9%85%8D%E5%88%B0"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">within 匹配到类为止,类下方法自动都匹配到</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#args-%E5%8F%AA%E5%8C%B9%E9%85%8D%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0-%E8%80%8C%E4%B8%8D%E8%80%83%E8%99%91%E5%85%B6%E5%AE%83%E5%9B%A0%E7%B4%A0"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">args  只匹配方法参数,而不考虑其它因素</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#this%E5%92%8Ctarget-%E5%8C%B9%E9%85%8D%E5%88%B0%E7%B1%BB%E6%88%96%E6%8E%A5%E5%8F%A3%E4%B8%BA%E6%AD%A2-%E5%8C%B9%E9%85%8D%E6%89%80%E6%9C%89%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.1.4.</span> <span class="nav-text">this和target 匹配到类或接口为止,匹配所有方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#annotation-%E6%B3%A8%E8%A7%A3%E5%8C%B9%E9%85%8D"><span class="nav-number">1.4.1.5.</span> <span class="nav-text">@annotation 注解匹配</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#within-%E7%BB%93%E5%90%88%E4%BA%86-annotation-%E5%92%8C-within"><span class="nav-number">1.4.1.6.</span> <span class="nav-text">@within 结合了 @annotation 和 within</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#args-%E7%BB%93%E5%90%88%E4%BA%86-annotation-%E5%92%8C-args"><span class="nav-number">1.4.1.7.</span> <span class="nav-text">@args 结合了 @annotation 和 args</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bean-Bean-id%E6%88%96%E5%90%8D%E5%AD%97%E9%80%9A%E9%85%8D%E7%AC%A6-%E5%8C%B9%E9%85%8D-bean-%E7%9A%84%E6%89%80%E6%9C%89%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.1.8.</span> <span class="nav-text">bean(Bean id或名字通配符)匹配 bean 的所有方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DeclareParents-%E6%8A%8A%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%E7%BB%87%E5%85%A5%E5%88%B0%E4%BB%A3%E7%90%86%E7%B1%BB%E4%B8%AD"><span class="nav-number">1.4.1.9.</span> <span class="nav-text">@DeclareParents  把一个方法织入到代理类中</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%87%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E7%BB%84%E5%90%88-amp-amp"><span class="nav-number">1.4.1.10.</span> <span class="nav-text">切点表达式的组合 &amp;&amp; , || , !</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AOP%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3%E5%8F%8A%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="nav-number">1.4.2.</span> <span class="nav-text">AOP常用注解及执行顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-AOP-%E5%A2%9E%E5%BC%BA%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0-JoinPoint-%E5%8F%8A-ProceedingJoinPoint"><span class="nav-number">1.4.3.</span> <span class="nav-text">Spring AOP 增强方法参数 JoinPoint 及 ProceedingJoinPoint</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A2%9E%E5%BC%BA%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96-getTarget-amp-getThis"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">增强方法参数获取 getTarget &amp; getThis</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A2%9E%E5%BC%BA%E6%96%B9%E6%B3%95%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96-getSignature"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">增强方法参数获取 getSignature</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ProceedingJoinPoint-AfterReturning-AfterThrowing-%E7%BB%91%E5%AE%9A"><span class="nav-number">1.4.3.3.</span> <span class="nav-text">ProceedingJoinPoint , (@AfterReturning,@AfterThrowing) 绑定</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#args-annotation-%E9%85%8D%E5%90%88-argNames"><span class="nav-number">1.4.4.</span> <span class="nav-text">args() , @annotation 配合 argNames</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#args-%E9%85%8D%E5%90%88-argNames"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">args() 配合 argNames</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#annotation-%E9%85%8D%E5%90%88-argNames"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">@annotation 配合 argNames</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E5%88%87%E9%9D%A2%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="nav-number">1.4.5.</span> <span class="nav-text">多个切面执行顺序</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E5%88%87%E9%9D%A2%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F-1"><span class="nav-number">1.4.5.1.</span> <span class="nav-text">多个切面执行顺序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8D%95%E4%B8%AA%E5%88%87%E9%9D%A2%E5%86%85%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="nav-number">1.4.5.2.</span> <span class="nav-text">单个切面内的执行顺序</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E8%B0%83%E7%94%A8%E8%87%AA%E8%BA%AB%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.6.</span> <span class="nav-text">代理对象调用自身的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Spring-AOP-SCOPE-SINGLETON-vs-SCOPE-PROTOTYPE"><span class="nav-number">1.4.7.</span> <span class="nav-text">Spring AOP SCOPE_SINGLETON vs SCOPE_PROTOTYPE</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E7%9A%84-SCOPE-%E6%98%AF%E8%B7%9F%E7%9D%80%E8%A2%AB%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E7%9A%84-SCOPE"><span class="nav-number">1.4.7.0.1.</span> <span class="nav-text">代理对象的 SCOPE 是跟着被代理对象的 SCOPE</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Aspect-%E5%AF%B9%E8%B1%A1%E7%9A%84-SCOPE-PROTOTYPE-%E6%98%AF%E8%B7%9F%E7%9D%80%E8%A2%AB%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1%E7%9A%84-SCOPE-PROTOTYPE"><span class="nav-number">1.4.7.0.2.</span> <span class="nav-text">Aspect 对象的 SCOPE_PROTOTYPE 是跟着被代理对象的 SCOPE_PROTOTYPE</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hank Bai"
      src="/images/rocket.png">
  <p class="site-author-name" itemprop="name">Hank Bai</p>
  <div class="site-description" itemprop="description">全栈工程师</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="/1410199713@qq.com" title="E-Mail → 1410199713@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/BAI-HANK" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;BAI-HANK" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.alloyteam.com/nav/" title="http:&#x2F;&#x2F;www.alloyteam.com&#x2F;nav&#x2F;" rel="noopener" target="_blank">Web前端导航</a>
        </li>
    </ul>
  </div>

        </div>
      </div>

      <div id="music163player" >
         <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=298 height=52 src="//music.163.com/outchain/player?type=2&id=5236281&auto=0&height=32">
         </iframe>
      </div><div>
  <br>
  <canvas id="canvasDiyBlock" style="width:60%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas><script src="/js/custom/clock.js"></script>
</div>
      
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/BAI-HANK" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://bh.com/2022/05/25/java/springFramework/aop/aop/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/rocket.png">
      <meta itemprop="name" content="Hank Bai">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hank Blog">
      <meta itemprop="description" content="全栈工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="spring framework aop | Hank Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          spring framework aop
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-05-25 10:25:37" itemprop="dateCreated datePublished" datetime="2022-05-25T10:25:37+08:00">2022-05-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-12-16 11:55:43" itemprop="dateModified" datetime="2022-12-16T11:55:43+08:00">2022-12-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/java/" itemprop="url" rel="index"><span itemprop="name">java</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>15 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="aop-代理"><a href="#aop-代理" class="headerlink" title="aop 代理"></a>aop 代理</h1><p>aop 是对 oop 的一种补充。</p>
<p>代理的好处：</p>
<ul>
<li>控制本来的实现类的可访问性，透过代理对象访问，可以在代理类内创建原本的实现类，对用户而言减少创建的复杂性</li>
<li>做横向拦截，给实现类在不修改代码的情况下，增强功能<ol>
<li>业务日志切面：可以记录业务方法调用的痕迹</li>
<li>事务控制：通过切面可以声明式控制事务</li>
<li>权限校验：执行方法之前先校验当前登录用户是否有权调用</li>
<li>数据缓存：执行方法之前先从缓存中取，取到则直接返回不走业务方法</li>
</ol>
</li>
</ul>
<span id="more"></span>
<h2 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h2><p>普通的静态代理需要给每个被代理的类创建一个代理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserStaticProxy</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserStaticProxy</span><span class="params">(UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">()</span> &#123;</span><br><span class="line">        userService.addUser();</span><br><span class="line">        System.out.println(<span class="string">&quot;增强的功能&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h2><p>动态代理是指代理关系在运行时确定的代理模式，因为代理类在编译前不存在，代理关系到运行时才能确定，因此称为动态代理。<br>动态代理，可以解决静态代理导致的代理类膨胀的问题</p>
<h3 id="jdk-动态代理"><a href="#jdk-动态代理" class="headerlink" title="jdk 动态代理"></a>jdk 动态代理</h3><p><em>核心 API 是 Proxy 类和 InvocationHandler 接口。它的原理是利用反射机制在运行时生成代理类的字节码,代理类会实现接口 和继承 Proxy 类</em></p>
<p>使用步骤：</p>
<ol>
<li>定义业务接口</li>
<li>被代理对象实现业务接口</li>
<li>通过 Proxy 的静态方法 newProxyInstance( ClassLoader loader, Class[] interfaces, InvocationHandler h) 创建一个代理对象</li>
<li>使用代理对象</li>
</ol>
<p>优点：</p>
<ul>
<li>无外部依赖,不用担心java 版本升级</li>
</ul>
<p>缺点</p>
<ul>
<li>被代理的类必须要有接口，因为被代理的类也要实现接口，也就是只能代理接口中的方法</li>
<li>InvocationHandler 功能增强实现类里要传入被代理类的对象实例</li>
<li>只能代理方法</li>
</ul>
<p><strong>示例代码</strong></p>
<p>定义的俩个接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hank.uti;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ServiceInterface1</span> &#123;</span><br><span class="line">     <span class="keyword">void</span> <span class="title function_">doSome1</span><span class="params">()</span>;</span><br><span class="line">     <span class="keyword">void</span> <span class="title function_">doSome2</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ServiceInterface2</span> &#123;</span><br><span class="line">     <span class="keyword">void</span> <span class="title function_">doSome3</span><span class="params">()</span>;</span><br><span class="line">     <span class="keyword">void</span> <span class="title function_">doSome4</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>增强的功能,需要做横向拦截进行功能增强,需要实现 InvocationHandler</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.hank.uti;</span><br><span class="line"><span class="comment">//上面接口处的实现类，此类要隐藏可访问性</span></span><br><span class="line"><span class="comment">//此类只能在包内 com.hank.uti 访问，需要限制不能在包外部被调用</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Service</span> <span class="keyword">implements</span> <span class="title class_">ServiceInterface1</span>, ServiceInterface2 &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSome1</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;doSome1&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSome2</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;doSome2&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSome3</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;doSome3&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSome4</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;doSome4&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//对 Service 类的方法进行功能增强，做横向拦截的，最为麻烦的是这里要传入一个被代理对象的实例 new Service()，会影响通用性</span></span><br><span class="line"><span class="comment">//默认是给所有的接口里的方法进行了代理，如果某些方法不需要进行功能增强，可以根据进行过滤</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceEnhance</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">//被代理的实例对象</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Service service;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">ServiceEnhance</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//如果被代理的很复杂,可以在这里构造，对外部用户用好</span></span><br><span class="line">    <span class="built_in">this</span>.service=<span class="keyword">new</span> <span class="title class_">Service</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;代理的方法 &quot;</span>+ method.getName()+<span class="string">&quot; 开始执行&quot;</span>);</span><br><span class="line"></span><br><span class="line">     <span class="comment">//被代理的类的方法执行，最为麻烦的是这里要传入一个被代理对象的实例</span></span><br><span class="line">     <span class="keyword">var</span> ret= method.invoke(service,args);</span><br><span class="line"></span><br><span class="line">     System.out.println(<span class="string">&quot;代理的方法 &quot;</span>+ method.getName()+<span class="string">&quot; 执行结束&quot;</span>);</span><br><span class="line">     <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hank;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//代理要增强的方法</span></span><br><span class="line">    <span class="keyword">var</span> handler=<span class="keyword">new</span> <span class="title class_">ServiceEnhance</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// jdk 动态代理反射生成的代理对象</span></span><br><span class="line">    <span class="comment">// jsk 动态代理是基于接口的,第二个参数要传递实现了需要实现的接口数组</span></span><br><span class="line">    <span class="comment">// 第三个参数是对那个对象进行增强的 InvocationHandler 实现对象</span></span><br><span class="line">    <span class="keyword">var</span> obj=Proxy.newProxyInstance(ServiceInterface1.class.getClassLoader(),<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;</span><br><span class="line">        ServiceInterface1.class,ServiceInterface2.class,</span><br><span class="line">    &#125;, handler);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//或者通过如下方式创建</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">clazz</span> <span class="operator">=</span>Proxy.getProxyClass(ServiceInterface1.class.getClassLoader(),<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;</span><br><span class="line">        ServiceInterface1.class,ServiceInterface2.class&#125;);</span><br><span class="line">    <span class="comment">//创建的代理对象</span></span><br><span class="line">    <span class="keyword">var</span> obj1= clazz.getConstructor(InvocationHandler.class).newInstance(handler);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Proxy 静态方法</span></span><br><span class="line">    System.out.println(<span class="string">&quot;是否是代理类&quot;</span>+Proxy.isProxyClass(obj.getClass()));</span><br><span class="line">    System.out.println(<span class="string">&quot;功能增强器的名字&quot;</span>+Proxy.getInvocationHandler(obj).getClass().getName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//代理的接口是 ServiceInterface1 &amp; ServiceInterface2</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">serviceProxy</span> <span class="operator">=</span>(ServiceInterface1 &amp; ServiceInterface2)obj;</span><br><span class="line">    serviceProxy.doSome1();</span><br><span class="line">    serviceProxy.doSome2();</span><br><span class="line">    serviceProxy.doSome3();</span><br><span class="line">    serviceProxy.doSome4();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CGLIB-动态代理"><a href="#CGLIB-动态代理" class="headerlink" title="CGLIB 动态代理"></a>CGLIB 动态代理</h3><p>CGlib(Code Generation Library)是一个开源项目；是一个强大的，高性能，高质量的Code生成类库，它可以在运行期扩展Java类与实现Java接口，它被AOP、测试、数据访问框架用于生成动态代理对象和拦截字段访问。</p>
<p><em>CGlib包的底层是通过使用一个小而快的字节码处理框架ASM，来转换字节码并生成新的类；CGlib是针对类来实现代理的，原理是对指定的业务类生成一个子类(继承),如果有接口会实现接口，并覆盖其中业务方法实现代理；所以CGlib可以为无接口的类直接做代理，当然有接口的类也是可以的并无影响.</em></p>
<p><em>ASM是一种通用Java字节码操作和分析框架。它可以用于修改现有的class文件或动态生成class文件，需要懂 java 底层的字节码及类文件格式功能才能使用，门槛很高</em></p>
<p>优点：</p>
<ul>
<li>不需要被代理的类必须实现接口，因为代理类是继承被代理类实现的</li>
<li>MethodInterceptor 功能增强实现类里不需要传入被代理类的对象的实例</li>
</ul>
<p>缺点：</p>
<ul>
<li>需要引入外部依赖 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>因为是对指定的类生成一个子类，覆盖其中的方法，并给其中方法的增强功能，但是因为采用的是继承，所以该类或方法最好不要生成final，对于final类或方法，是无法继承的  </li>
<li>只能代理方法</li>
</ul>
<p><em>实例代码</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Service</span> <span class="keyword">implements</span> <span class="title class_">ServiceInterface1</span>, ServiceInterface2 &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//增加构造函数</span></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Service</span><span class="params">(String str)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;被代理对象创建了&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//.......余下代码省略</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里和 jdk 动态代理不同的是，对象实例不需要提供，可以做到一定的通用性</span></span><br><span class="line"><span class="comment">//默认是给所有的接口里的方法进行了代理，如果某些方法不需要进行功能增强，可以根据进行过滤</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceMethodInterceptor</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;代理的方法 &quot;</span>+ method.getName()+<span class="string">&quot; 开始执行&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对象实例在接口方法里包含 Object o</span></span><br><span class="line">    <span class="keyword">var</span> ret= methodProxy.invokeSuper(o,objects);</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;代理的方法 &quot;</span>+ method.getName()+<span class="string">&quot; 执行结束&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">被代理对象创建了</span></span><br><span class="line"><span class="comment">代理的方法 doSome1 开始执行</span></span><br><span class="line"><span class="comment">doSome1</span></span><br><span class="line"><span class="comment">代理的方法 doSome1 执行结束</span></span><br><span class="line"><span class="comment">代理的方法 doSome2 开始执行</span></span><br><span class="line"><span class="comment">doSome2</span></span><br><span class="line"><span class="comment">代理的方法 doSome2 执行结束</span></span><br><span class="line"><span class="comment">代理的方法 doSome3 开始执行</span></span><br><span class="line"><span class="comment">doSome3</span></span><br><span class="line"><span class="comment">代理的方法 doSome3 执行结束</span></span><br><span class="line"><span class="comment">代理的方法 doSome4 开始执行</span></span><br><span class="line"><span class="comment">doSome4</span></span><br><span class="line"><span class="comment">代理的方法 doSome4 执行结束</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//Service 对象增强功能的对象</span></span><br><span class="line">      <span class="keyword">var</span> handler=<span class="keyword">new</span> <span class="title class_">ServiceMethodInterceptor</span>();</span><br><span class="line">      </span><br><span class="line">      <span class="type">var</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">      <span class="comment">//设置给那个类增强，不能是接口这里，因为是通过继承父类的方式生成的代理类，说以 api 叫 setSuperclass</span></span><br><span class="line">      <span class="comment">//默认是给对象的所有方法进行了代理（除过静态 final)</span></span><br><span class="line">      enhancer.setSuperclass(Class.forName(<span class="string">&quot;com.hank.uti.Service&quot;</span>));</span><br><span class="line">      <span class="comment">//设置回调对象,也就是增强的功能</span></span><br><span class="line">      enhancer.setCallback(handler);</span><br><span class="line">     </span><br><span class="line">      <span class="comment">//生成代理的对象</span></span><br><span class="line">      <span class="comment">//默认调用的是是被代理类的无参构造器,也可以指定构造器的参数</span></span><br><span class="line">      <span class="comment">//如下传入构造器需要的参数类型及值</span></span><br><span class="line">      <span class="type">var</span> <span class="variable">proxy</span> <span class="operator">=</span>(ServiceInterface1 &amp; ServiceInterface2)enhancer.create(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;para1&quot;</span>&#125;);</span><br><span class="line">      proxy.doSome1();</span><br><span class="line">      proxy.doSome2();</span><br><span class="line">      proxy.doSome3();</span><br><span class="line">      proxy.doSome4();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="可以传递多个功能增强器-但是需要指定过滤器"><a href="#可以传递多个功能增强器-但是需要指定过滤器" class="headerlink" title="可以传递多个功能增强器,但是需要指定过滤器"></a>可以传递多个功能增强器,但是需要指定过滤器</h4><p>不同于Proxy.newProxyInstance 的方法一次只能传递一个功能增强处理对象,CGLIB 可以传入多个,但是要提供过滤器,但是一个方法一次也只能有一个增强器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hank.uti;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在定义一个增强对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceMethodInterceptor1</span> <span class="keyword">implements</span> <span class="title class_">MethodInterceptor</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;代理的方法 &quot;</span>+ method.getName()+<span class="string">&quot; 开始执行1&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> ret= methodProxy.invokeSuper(o,objects);</span><br><span class="line">    System.out.println(<span class="string">&quot;代理的方法 &quot;</span>+ method.getName()+<span class="string">&quot; 执行结束1&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.hank;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">被代理对象创建了</span></span><br><span class="line"><span class="comment">代理的方法 doSome1 开始执行</span></span><br><span class="line"><span class="comment">doSome1</span></span><br><span class="line"><span class="comment">代理的方法 doSome1 执行结束</span></span><br><span class="line"><span class="comment">代理的方法 doSome2 开始执行</span></span><br><span class="line"><span class="comment">doSome2</span></span><br><span class="line"><span class="comment">代理的方法 doSome2 执行结束</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">代理的方法 doSome3 开始执行1</span></span><br><span class="line"><span class="comment">doSome3</span></span><br><span class="line"><span class="comment">代理的方法 doSome3 执行结束1</span></span><br><span class="line"><span class="comment">代理的方法 doSome4 开始执行1</span></span><br><span class="line"><span class="comment">doSome4</span></span><br><span class="line"><span class="comment">代理的方法 doSome4 执行结束1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//Service 对象增强功能的对象</span></span><br><span class="line">      <span class="keyword">var</span> handler=<span class="keyword">new</span> <span class="title class_">ServiceMethodInterceptor</span>();</span><br><span class="line">      <span class="keyword">var</span> handler1=<span class="keyword">new</span> <span class="title class_">ServiceMethodInterceptor1</span>();</span><br><span class="line">      <span class="type">var</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">      <span class="comment">//设置给那个类增强，不能是接口这里，因为是通过继承父类的方式生成的代理类，说以 api 叫 setSuperclass</span></span><br><span class="line">      enhancer.setSuperclass(Class.forName(<span class="string">&quot;com.hank.uti.Service&quot;</span>));</span><br><span class="line"></span><br><span class="line">      <span class="comment">//设置回调对象,也就是增强的功能，此处设置了多个增强器对象,但是一个被代理对象的方法一次只能被一个增强器处理,所以还要定义增强器过滤器</span></span><br><span class="line">      enhancer.setCallbacks(<span class="keyword">new</span> <span class="title class_">Callback</span>[]&#123;handler,handler1&#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">//增强器过滤器，指定那个方法被那个增强器处理</span></span><br><span class="line">      enhancer.setCallbackFilter(<span class="keyword">new</span> <span class="title class_">CallbackFilter</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">accept</span><span class="params">(Method method)</span> &#123;</span><br><span class="line">          <span class="comment">//这里返回的数字 0,1 代表的是 setCallbacks 传入的的回调数组里的回调对象在数组里的顺序</span></span><br><span class="line">          <span class="keyword">if</span>(method.getName().equalsIgnoreCase(<span class="string">&quot;doSome1&quot;</span>) || method.getName().equalsIgnoreCase(<span class="string">&quot;doSome2&quot;</span>)) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      </span><br><span class="line">      <span class="comment">//生成代理的对象,默认调用的是是被代理类的无参构造器,也可以指定构造器的参数</span></span><br><span class="line">      <span class="type">var</span> <span class="variable">proxy</span> <span class="operator">=</span>(ServiceInterface1 &amp; ServiceInterface2)enhancer.create(<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;para1&quot;</span>&#125;);</span><br><span class="line">      proxy.doSome1();</span><br><span class="line">      proxy.doSome2();</span><br><span class="line">      proxy.doSome3();</span><br><span class="line">      proxy.doSome4();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Callback-增强器的其他功能"><a href="#Callback-增强器的其他功能" class="headerlink" title="Callback 增强器的其他功能"></a>Callback 增强器的其他功能</h4><p>CGLIB中提供的Callback的子类有以下几种：</p>
<ul>
<li>NoOp 不做增强</li>
<li>FixedValue 不会执行被代理的方法的内部逻辑，直接返回固定的值</li>
<li>InvocationHandler  用法和 jdk 动态代理的 InvocationHandler 一样</li>
<li>MethodInterceptor </li>
<li>Dispatcher 调用代理对象的方法,每次都要求生成一个新被代理对象</li>
<li>LazyLoader 延迟生成被代理对象,在执行代理对象的方法时才生成被代理对象,之后使用相同的代理对象</li>
</ul>
<h4 id="字节码技术的其他探索"><a href="#字节码技术的其他探索" class="headerlink" title="字节码技术的其他探索"></a>字节码技术的其他探索</h4><p>CGLIB 因为采用的是 ASM 为底层的字节码生成技术能做的事情不仅仅是 aop 这些<br>比如如下的直接生成一个对象</p>
<p>ben 生成器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">var</span> <span class="variable">beanGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanGenerator</span>();</span><br><span class="line"><span class="comment">//增加属性</span></span><br><span class="line">beanGenerator.addProperty(<span class="string">&quot;age&quot;</span>,<span class="type">int</span>.class);</span><br><span class="line"><span class="comment">//凭空生成对象,就像是变魔术一样</span></span><br><span class="line"><span class="type">var</span> <span class="variable">obj</span> <span class="operator">=</span>  beanGenerator.create();</span><br><span class="line"></span><br><span class="line"><span class="comment">//奇怪的不能直接获取到字段</span></span><br><span class="line">System.out.println(Arrays.stream(obj.getClass().getFields()).map(p-&gt;&#123;</span><br><span class="line">         p.setAccessible(<span class="literal">true</span>);</span><br><span class="line">         <span class="keyword">return</span> p.getName();</span><br><span class="line">       &#125;).collect(Collectors.toList()).size());</span><br><span class="line"><span class="comment">//0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> setter=   obj.getClass().getMethod(<span class="string">&quot;setAge&quot;</span>,<span class="type">int</span>.class );</span><br><span class="line">setter.invoke(obj,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> getter=   obj.getClass().getMethod(<span class="string">&quot;getAge&quot;</span>);</span><br><span class="line">System.out.println(getter.invoke(obj));</span><br><span class="line"><span class="comment">//10</span></span><br></pre></td></tr></table></figure>

<h3 id="Byte-Buddy-类似于CGLIB-的字节码框架"><a href="#Byte-Buddy-类似于CGLIB-的字节码框架" class="headerlink" title="Byte Buddy 类似于CGLIB 的字节码框架"></a>Byte Buddy 类似于CGLIB 的字节码框架</h3><p>Byte Buddy 的目标是代替 CGLIB </p>
<p>//TODO  Byte Buddy</p>
<h2 id="AspectJ-静态织入"><a href="#AspectJ-静态织入" class="headerlink" title="AspectJ 静态织入"></a>AspectJ 静态织入</h2><blockquote>
<p>AspectJ 是一个在编译器和运行时都支持代码增强（织入）的开源框架，曾经非常流行AspectJ,现在属于 eclipse 开源基金会组织. AspectJ 是最早、功能比较强大的 AOP 实现之一，<br>对整套 AOP 机制都有较好的实现，很多其他语言的 AOP 实现，也借鉴或采纳了 AspectJ 中很多设计。在 Java 领域，AspectJ 中的很多语法结构基本上已成为 AOP 领域的标准。<br>AspectJ可以做Spring AOP干不了的事情，它是AOP编程的完全解决方案，AspectJ支持所有切入点，不仅仅是方法织入，因为AspectJ在实际运行之前就完成了织入，所以说它生成的类<br>是没有额外运行时开销的,缺点是使用复杂,它不会生成代理类,是在运行代码前直接修改 class 文件字节码的方式织入增强功能到原文件，其内部使用的是 BCEL 框架 来完成字节码的修改能力。<br><a target="_blank" rel="noopener" href="https://github.com/eclipse/org.aspectj">aspectj 地址</a></p>
</blockquote>
<p><em>aspectj 定义了一套专有名称的概念</em></p>
<ul>
<li>Aspect切面：一个分布在应用程序中多个位置的标准代码/功能是对现有业务的功能增强，通常与实际的业务逻辑不同,每个切面都侧重于一个特定的横切功能.</li>
<li>Joinpoint连接点：这是程序执行中的特定点，如方法执行，构调用造函数或字段赋值等,也就是需要指定增强代码在业务代码的插入点.</li>
<li>Advice通知：在一个连接点中，切面增强的具体功能代码,有 Before,After,Around,After,AfterReturning ,AfterThrowing  通知</li>
<li>Pointcut切点：一个匹配连接点的正则表达式。 每当任何连接点匹配一个切入点时，就执行与该切入点相关联的指定增强通知.</li>
<li>Weaving织入：链接切面和目标对象来创建一个通知对象的过程.</li>
</ul>
<p>因为是直接去改原来的 class文件,所以它可以在如下五个位置插入自定义的代码：</p>
<ol>
<li>在方法（包括构造方法）被调用的位置。</li>
<li>在方法体（包括构造方法）的内部。</li>
<li>在读写变量的位置。</li>
<li>在静态代码块内部。</li>
<li>在异常处理的位置的前后。</li>
</ol>
<p>使用前期条件：</p>
<ol>
<li>IDE 安装插件Aspect，这样在编写 .aj 文件的时候有智能提示及语法检查</li>
<li>maven 安装依赖 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--处理 aspectj  注解--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aspectjrt&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.9</span><span class="number">.9</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">  &lt;!--它的主要作用是负责解析切入点表达式,在加载是织入是会用到--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.9</span><span class="number">.9</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--ajc编译器,比如 .aj文件  需要它去编译，需要配合IDE 的插件 AspectJ 才能起到作用--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aspectjtools&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.9</span><span class="number">.9</span><span class="number">.1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li>
<li>编译时织入代码到 class 文，需要靠此插件支持，如果不用插件要用命令调用 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;aspectj-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.14</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">        &lt;complianceLevel&gt;<span class="number">11</span>&lt;/complianceLevel&gt;</span><br><span class="line">        &lt;source&gt;<span class="number">11</span>&lt;/source&gt;</span><br><span class="line">        &lt;target&gt;<span class="number">11</span>&lt;/target&gt;</span><br><span class="line">        &lt;showWeaveInfo&gt;<span class="literal">true</span>&lt;/showWeaveInfo&gt;</span><br><span class="line">        &lt;verbose&gt;<span class="literal">true</span>&lt;/verbose&gt;</span><br><span class="line">        &lt;Xlint&gt;ignore&lt;/Xlint&gt;</span><br><span class="line">        &lt;encoding&gt;UTF-<span class="number">8</span> &lt;/encoding&gt;</span><br><span class="line">    &lt;/configuration&gt;</span><br><span class="line">    &lt;executions&gt;</span><br><span class="line">        &lt;execution&gt;</span><br><span class="line">            &lt;goals&gt;</span><br><span class="line">                &lt;!-- use <span class="built_in">this</span> goal to weave all your main classes --&gt;</span><br><span class="line">                &lt;goal&gt;compile&lt;/goal&gt;</span><br><span class="line">                &lt;!-- use <span class="built_in">this</span> goal to weave all your test classes --&gt;</span><br><span class="line">                &lt;goal&gt;test-compile&lt;/goal&gt;</span><br><span class="line">            &lt;/goals&gt;</span><br><span class="line">        &lt;/execution&gt;</span><br><span class="line">    &lt;/executions&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="静态织入"><a href="#静态织入" class="headerlink" title="静态织入"></a>静态织入</h3><p>在编译的时或<font color=blue>类加载到 JVM</font> 的时候，直接修改原来的class文件内容,把增强的功能直接混入原本的 class 文件</p>
<p>被代理的类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hank.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(String name)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;foo 方法返回结果&quot;</span>+name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编译时织入-aj-的功能增强文件"><a href="#编译时织入-aj-的功能增强文件" class="headerlink" title="编译时织入.aj 的功能增强文件"></a>编译时织入.aj 的功能增强文件</h4><blockquote>
<p>利用ajc编译器替代 javac 编译器，直接将源文件 (java或者aspect文件) 编译成 class 文件并将切面织入进代码。</p>
</blockquote>
<p><em>代理类,此类是在 IDE 安装插件后通过右键添加 Aspect 类型的文件,文件用 .aj 结尾</em><br><font color=royalblue>此文件的的语法要参考 aspect .aj 文件的格式</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hank.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> aspect BarEnhance &#123;</span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">show</span><span class="params">(JoinPoint point)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;目标类对象：&quot;</span>+point.getTarget ()+</span><br><span class="line">           <span class="string">&quot;,被增强的方法：&quot;</span>+point.getSignature ().getName ()+</span><br><span class="line">           <span class="string">&quot;传入的参数是&quot;</span>+String.join(<span class="string">&quot;;&quot;</span>, Arrays.stream(point.getArgs()).map(p-&gt;p.toString()).collect(Collectors.toList()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  pointcut  <span class="title function_">pt1</span><span class="params">()</span> : execution(* com.hank.aop.Bar.*(..));</span><br><span class="line"></span><br><span class="line">  before() : pt1()&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;编译时织入 before 增强，&quot;</span>+show(thisJoinPoint));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Object <span class="title function_">around</span><span class="params">()</span>  : pt1()  &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;编译时织入 around 增强前，&quot;</span>+show(thisJoinPoint));</span><br><span class="line">    <span class="comment">//这里不需要传入参数</span></span><br><span class="line">    <span class="keyword">var</span> obj=  proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;编译时织入 around 增强后，&quot;</span>+show(thisJoinPoint));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;编译时织入,&quot;</span>+obj;</span><br><span class="line">  &#125;</span><br><span class="line">   after() : pt1()&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;编译时织入 after 增强，&quot;</span>+show(thisJoinPoint));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hank;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Bar</span>().foo();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    编译时织入 before 增强，目标类对象：com.hank.aop.Bar@2344fc66,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    编译时织入 around 增强前，目标类对象：com.hank.aop.Bar@2344fc66,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    编译时织入 around 增强后，目标类对象：com.hank.aop.Bar@2344fc66,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    编译时织入 after 增强，目标类对象：com.hank.aop.Bar@2344fc66,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    编译时织入,foo 方法返回结果ok</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="编译时织入普通的-class-文件"><a href="#编译时织入普通的-class-文件" class="headerlink" title="编译时织入普通的 class 文件"></a>编译时织入普通的 class 文件</h4><blockquote>
<p>这种用法比写 .aj 文件方便多了</p>
</blockquote>
<p>定义一个切面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BarAspect</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">show</span><span class="params">(JoinPoint point)</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;目标类对象：&quot;</span>+point.getTarget ()+</span><br><span class="line">          <span class="string">&quot;,被增强的方法：&quot;</span>+point.getSignature ().getName ()+</span><br><span class="line">          <span class="string">&quot;传入的参数是&quot;</span>+String.join(<span class="string">&quot;;&quot;</span>, Arrays.stream(point.getArgs()).map(p-&gt;p.toString()).collect(Collectors.toList()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Pointcut(&quot;execution(* com.hank.aop.Bar.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Before(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeAdvice</span><span class="params">(JoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;编译时织入，通过 注解 配置， before 增强，&quot;</span>+show(point));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;编译时织入，通过 注解 配置， around 增强前，&quot;</span>+show(point));</span><br><span class="line">    <span class="keyword">var</span> ret= point.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;编译时织入，通过 注解 配置， around 增强后，&quot;</span>+show(point));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;运行时织入，通过 注解 配置,&quot;</span>+ret;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@After(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterAdvice</span><span class="params">(JoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;编译时织入，通过 注解 配置， after 增强，，&quot;</span>+show(point));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hank;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Bar</span>().foo();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    编译时织入 before 增强，目标类对象：com.hank.aop.Bar@2344fc66,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    编译时织入 around 增强前，目标类对象：com.hank.aop.Bar@2344fc66,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    编译时织入 around 增强后，目标类对象：com.hank.aop.Bar@2344fc66,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    编译时织入 after 增强，目标类对象：com.hank.aop.Bar@2344fc66,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    编译时织入,foo 方法返回结果ok</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="加载的时候织入"><a href="#加载的时候织入" class="headerlink" title="加载的时候织入"></a>加载的时候织入</h4><p><em>不同于编译时的织入，会直接修改原本的 class 文件， 加载的时候织入不会修改原本的 class 文件,但是会修改加载到 jvm 里的文件</em><br>通过java agent机制在内存中操作类文件，可以不需要ajc的支持做到在JVM 中定义任何类型之前织入它们的增强代码<br>因为是通过java agent 机制，所以不需要在编写 .aj 文件，可以用纯 java 代码去定义增强的功能，所以不需要 ajc 编译器的支持</p>
<p>切面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BarAspect</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">show</span><span class="params">(JoinPoint point)</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;目标类对象：&quot;</span>+point.getTarget ()+</span><br><span class="line">          <span class="string">&quot;,被增强的方法：&quot;</span>+point.getSignature ().getName ()+</span><br><span class="line">          <span class="string">&quot;传入的参数是&quot;</span>+String.join(<span class="string">&quot;;&quot;</span>, Arrays.stream(point.getArgs()).map(p-&gt;p.toString()).collect(Collectors.toList()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Pointcut(&quot;execution(* com.hank.aop.Bar.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Before(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeAdvice</span><span class="params">(JoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;加载的时候织入，通过 注解 配置， before 增强，&quot;</span>+show(point));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;加载的时候织入，通过 注解 配置， around 增强前，&quot;</span>+show(point));</span><br><span class="line">    <span class="keyword">var</span> ret= point.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;加载的时候织入，通过 注解 配置， around 增强后，&quot;</span>+show(point));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;加载的时候织入，通过 注解 配置,&quot;</span>+ret;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@After(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterAdvice</span><span class="params">(JoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;加载的时候织入，通过 注解 配置， after 增强，，&quot;</span>+show(point));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在资源路径下建立 META-INF 文件夹,并在此文件夹下建立 aop.xml 文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aspectj</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aspects</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 切面类，此类目的是在加载的时候告诉 aspectj 切面定义在哪里 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aspect</span> <span class="attr">name</span>=<span class="string">&quot;com.hank.aop.BarAspect&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aspects</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">weaver</span> <span class="attr">options</span>=<span class="string">&quot;-verbose -showWeaveInfo&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定需要进行织入操作的目标类范围 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">within</span>=<span class="string">&quot;com.hank.aop.*&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">weaver</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aspectj</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>不需要插件支持,但是要告诉 jvm ,如下参数，目的是加载 class 文件的时候先执行如下包内的相关命令<br><font color=brown>vm  参数 -javaagent:D:\Cache\maven\org\aspectj\aspectjweaver\1.9.9.1\aspectjweaver-1.9.9.1.jar</font></p>
<p>测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hank;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Bar</span>().foo();</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    加载的时候织入 before 增强，目标类对象：com.hank.aop.Bar@2344fc66,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    加载的时候织入 around 增强前，目标类对象：com.hank.aop.Bar@2344fc66,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    加载的时候织入 around 增强后，目标类对象：com.hank.aop.Bar@2344fc66,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    加载的时候织入 after 增强，目标类对象：com.hank.aop.Bar@2344fc66,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    加载的时候织入,foo 方法返回结果ok</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903664469950478">参考-说说在,Spring AOP 中如何实现类加载期织入（LTW）</a></p>
<h2 id="Spring-AOP-代理"><a href="#Spring-AOP-代理" class="headerlink" title="Spring AOP 代理"></a>Spring AOP 代理</h2><p><em>spring aop 在  spring ioc 的基础上对上面的动态代理框架的封装，spring aop 的实现要依赖于 spring  ioc,注定能进行 aop 的只能是 注入的 bean 对象,及只能进行运行时的动态代理</em>,jdk 动态代理或 cglib 这些动态代理是一种硬编码方式的动态代理，需要代码去实现对应的接口,spring aop 对它们进行了封装,做到更好的无侵入. 默认如果使用接口的，用JDK动态代理实现,如果没有接口则使用 CGLIB 实现,也可以通过配置只使用 CGLIB 代理,但是鉴于 aspectj 的知名度,在使用的语法上有用了 aspect 使用上的那一套概念.这一套概念有 AOP 联盟提出了标准接口,目的时降低使用 aop 在技术上的复杂度.spring 也是按照这套标准.<br><a target="_blank" rel="noopener" href="https://aopalliance.sourceforge.net/">aop alliance 联盟</a></p>
<p><img src="/2022/05/25/java/springFramework/aop/aop/springAOPTwoWay.png" alt="springAOPTwoWay"></p>
<p>优点:</p>
<ul>
<li>使用aspectj 的语法概念,使用简单</li>
<li>切点表达式不局限于正则表达式</li>
</ul>
<p>缺点:</p>
<ul>
<li>只能代理非 final及静态的方法</li>
<li>只能用于 spring ioc 容器内的 bean 对象</li>
<li>因为是在运行时生成代码有额外的开销</li>
</ul>
<p>例子</p>
<p>spring  新版本默认没有引入 aspectJ 包,需要引入此包,才能使用 aspectj 切面定义语法</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjrt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.9.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(String name)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;foo 方法返回结果&quot;</span>+name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//和上面的例子相比,只是把切面类(功能增强类) 增加了一个 @Component 注解</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String <span class="title function_">show</span><span class="params">(JoinPoint point)</span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;目标类对象：&quot;</span>+point.getTarget ()+</span><br><span class="line">          <span class="string">&quot;,被增强的方法：&quot;</span>+point.getSignature ().getName ()+</span><br><span class="line">          <span class="string">&quot;传入的参数是&quot;</span>+String.join(<span class="string">&quot;;&quot;</span>, Arrays.stream(point.getArgs()).map(p-&gt;p.toString()).collect(Collectors.toList()));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Pointcut(&quot;execution(* com.hank.aop.Bar.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@Before(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeAdvice</span><span class="params">(JoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;运行时织入，通过 注解 配置， before 增强，&quot;</span>+show(point));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;运行时织入，通过 注解 配置， around 增强前，&quot;</span>+show(point));</span><br><span class="line">    <span class="keyword">var</span> ret= point.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;运行时织入，通过 注解 配置， around 增强后，&quot;</span>+show(point));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;运行时织入，通过 注解 配置,&quot;</span>+ret;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@After(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterAdvice</span><span class="params">(JoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;运行时织入，通过 注解 配置， after 增强，，&quot;</span>+show(point));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试例子,编译后的代码没有没有进行织入的操作,织入的操作在运行时进行的 </p>
<figure class="highlight java"><figcaption><span>要增加 @EnableAspectJAutoProxy 注解使能 spring aop 的功能</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">     <span class="type">var</span>  <span class="variable">context</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line"></span><br><span class="line">     <span class="comment">// beanDefine 登记的还是被代理对象 Bar</span></span><br><span class="line">     Stream.of(context.getBeanDefinitionNames()).forEach(p-&gt;&#123;</span><br><span class="line">       <span class="keyword">if</span>(p.equalsIgnoreCase(<span class="string">&quot;bar&quot;</span>))&#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;bar 注册器里 bean class:&quot;</span>+context.getBeanDefinition(p).getBeanClassName());</span><br><span class="line">          <span class="comment">//bar 注册器里 bean class:com.hank.aop.Bar</span></span><br><span class="line">       &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 但是实例化bean 的时候 beanName 指向了代理对象</span></span><br><span class="line">    <span class="comment">// 容器里既有 Bar 对象 ，也有代理对象</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">bar</span> <span class="operator">=</span>(Bar) context.getBean(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;通过 context 只能获取到代理对象:&quot;</span>+bar.getClass().getName());</span><br><span class="line">    <span class="comment">//通过 context 只能获取到代理对象:com.hank.aop.Bar$$EnhancerBySpringCGLIB$$cb2b574d</span></span><br><span class="line">    bar.foo(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    运行时织入，通过 注解 配置， around 增强前，目标类对象：com.hank.aop.Bar@85e6769,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    运行时织入，通过 注解 配置， before 增强，目标类对象：com.hank.aop.Bar@85e6769,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    运行时织入，通过 注解 配置， after 增强，，目标类对象：com.hank.aop.Bar@85e6769,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    运行时织入，通过 注解 配置， around 增强后，目标类对象：com.hank.aop.Bar@85e6769,被增强的方法：foo传入的参数是ok</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Pointcut-切点"><a href="#Pointcut-切点" class="headerlink" title="@Pointcut 切点"></a>@Pointcut 切点</h3><p>@Pointcut 注解要加在一个空方法上</p>
<h4 id="execution-正则表达式匹配"><a href="#execution-正则表达式匹配" class="headerlink" title="execution 正则表达式匹配"></a>execution 正则表达式匹配</h4><p><em>正则表达式匹配的是方法参数是参考的方法原型的参数类型,而不是方法调用处实际传递的参数对象类型,正</em></p>
<p><em>则表达式不能使用参数,如下使用是非法的</em><br>  <code>@Pointcut(value = &quot;execution(* com.hank.aop.Bar.*(value,name))&quot;,argNames = &quot;value,name&quot;)</code><br>  <code>public  void pt(int value,String name)&#123;&#125;</code></p>
<p>execution(modifiers-pattern? ret-type-pattern declaring-type-pattern?name-pattern(param-pattern?) throws-pattern?)<br>这里问号表示当前项可以有也可以没有，其中各项的语义如下：</p>
<ul>
<li>modifiers-pattern：方法的可见性，如public，protected,<font color=plum><em>可选</em></font>.</li>
<li>ret-type-pattern：方法的返回值类型，如int，void等,<font color=plum><em>必选</em></font>.</li>
<li>declaring-type-pattern：方法所在<font color=green>类或接口的全路径名</font>，如com.hank.Bar,<br><font color=green>.. 匹配: hank.. 表示hank包及 hank下的子包</font>,<font color=plum><em>可选</em></font>.</li>
<li>name-pattern：方法名类型，如far(),<font color=plum><em>必选</em></font>.</li>
<li>param-pattern：方法的参数类型,如java.lang.String,不提供表示没有参数,<br><font color=green>.. 匹配:表示 0 个或任意个参数</font>,<font color=plum><em>必选</em></font>.</li>
<li>throws-pattern：方法抛出的异常类型，如 throws java.lang.Exception,多个异常用 ‘,’ 隔开,<br><font color=plum><em>可选</em></font>.</li>
<li>* 表示匹配通配符,匹配单个连续的词组,或者是以某个词为前缀或后缀的单词词组<ul>
<li>* com.hank.*.uti.*.*() 匹配 com.hank 包下的任意包下的 uti 包下的任意类的任意方法,但是方法的参数个数是零个</li>
<li>* com.hank.*.uti.Test_*.*() 匹配 com.hank 包下的任意包下的 uti 包下的 匹配Test_开头的类的任意方法,但是方法的参数个数是零个</li>
</ul>
</li>
<li>+匹配父类及子类型</li>
</ul>
<p><font color=blue>例子1: * 匹配</font></p>
<p>@Pointcut(“execution(* com.hank..<em>.</em>(..))”)<br>整个表达式可以分为四个部分:</p>
<ol>
<li>第一个 * 号：表示返回类型， *号表示所有的类型.</li>
<li>包名: com.hank 表示需要拦截的包名，后面的..表示当前包和当前包的所有子包,com.hank包、子包下所有类的方法.</li>
<li>第二个 * 号: 表示类名,*号表示所有的类.</li>
<li>*(..):最后这个星号表示方法名, *号表示所有的方法,后面括弧里面表示方法的参数，两个句点表示任何参数.</li>
</ol>
<p><font color=blue>例子2: * 匹配</font></p>
<p>@Pointcut(“execution( * com.hank.aop.uti.Test.*(int,String,..))”)</p>
<ol>
<li>第一个 * 号：表示返回类型， *号表示所有的类型.</li>
<li>包名: com.hank.aop.uti,Test 表示需要拦截的类名</li>
<li>*(int,String,..):最后这个星号表示方法名, *号表示所有的方法,后面括弧里面表示方法的参数，第一个参数是 int 类型,第二个参数是 String 类型, 后面两个句点表示任何<br>参数</li>
</ol>
<p><font color=blue>例子3:<em>+匹配父类及子类型</em> </font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;parent&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">parentFoo</span><span class="params">(String name,<span class="type">int</span> value )</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="string">&quot;parentFoo 返回:&quot;</span>+name+<span class="string">&quot;,&quot;</span>+value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> <span class="keyword">extends</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(String name,<span class="type">int</span> value )</span>&#123;</span><br><span class="line">     <span class="keyword">return</span>  <span class="string">&quot;foo 返回:&quot;</span>+name+<span class="string">&quot;,&quot;</span>+value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span>  <span class="type">int</span>  <span class="title function_">boo</span><span class="params">(String name,String value )</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;execution( String Parent+.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint pointcut)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;匹配的切点:&quot;</span>+pointcut.getStaticPart());</span><br><span class="line">    System.out.println(pointcut.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + pointcut.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> pointcut.proceed();</span><br><span class="line">    System.out.println(pointcut.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + pointcut.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+bean.foo(<span class="string">&quot;ok&quot;</span>,<span class="number">1</span>));</span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+bean.parentFoo(<span class="string">&quot;ok&quot;</span>,<span class="number">1</span>));</span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+bean.boo(<span class="string">&quot;notOK&quot;</span>,<span class="string">&quot;notOK&quot;</span>));</span><br><span class="line">    System.out.println(<span class="string">&quot;---------------------------------------&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> parent= (Parent)context.getBean(<span class="string">&quot;parent&quot;</span>);</span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+parent.parentFoo(<span class="string">&quot;ok&quot;</span>,<span class="number">1</span>));;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">匹配的切点:execution(String com.hank.aop.Bar.foo(String,int))</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.foo,around 增强前</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.foo,around 增强后</span></span><br><span class="line"><span class="comment">方法返回的结果是:foo 返回:ok,1</span></span><br><span class="line"><span class="comment">匹配的切点:execution(String com.hank.aop.Parent.parentFoo(String,int))</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.parentFoo,around 增强前</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.parentFoo,around 增强后</span></span><br><span class="line"><span class="comment">方法返回的结果是:parentFoo 返回:ok,1</span></span><br><span class="line"><span class="comment">方法返回的结果是:1</span></span><br><span class="line"><span class="comment">---------------------------------------</span></span><br><span class="line"><span class="comment">匹配的切点:execution(String com.hank.aop.Parent.parentFoo(String,int))</span></span><br><span class="line"><span class="comment">com.hank.aop.Parent.parentFoo,around 增强前</span></span><br><span class="line"><span class="comment">com.hank.aop.Parent.parentFoo,around 增强后</span></span><br><span class="line"><span class="comment">方法返回的结果是:parentFoo 返回:ok,1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><font color=blue>例子4: 匹配异常</font></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">被代理类</span><br><span class="line"><span class="meta">@Component()</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span>   &#123;</span><br><span class="line">  <span class="comment">//此方法标记抛出 NullPointerException</span></span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(String name,<span class="type">int</span> value )</span><span class="keyword">throws</span> NullPointerException&#123;</span><br><span class="line">     <span class="keyword">return</span>  <span class="string">&quot;foo 返回:&quot;</span>+name+<span class="string">&quot;,&quot;</span>+value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">boo</span><span class="params">(String name,<span class="type">int</span> value )</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="string">&quot;boo 返回:&quot;</span>+name+<span class="string">&quot;,&quot;</span>+value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//切点</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="comment">// throws NullPointerException 匹配方法签名里抛出 NullPointerException 的</span></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;execution(* *(..) throws NullPointerException)&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint pointcut)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;匹配的切点:&quot;</span>+pointcut.getStaticPart());</span><br><span class="line">    System.out.println(pointcut.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + pointcut.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> pointcut.proceed();</span><br><span class="line">    System.out.println(pointcut.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + pointcut.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+bean.foo(<span class="string">&quot;ok&quot;</span>,<span class="number">1</span>));</span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+bean.boo(<span class="string">&quot;notOK&quot;</span>,<span class="number">2</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">匹配的切点:execution(String com.hank.aop.Bar.foo(String,int))</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.foo,around 增强前</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.foo,around 增强后</span></span><br><span class="line"><span class="comment">方法返回的结果是:foo 返回:ok,1</span></span><br><span class="line"><span class="comment">方法返回的结果是:boo 返回:notOK,2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><font color=blue>例子5: 接口匹配</font></p>
<p><em>接口匹配要注意获取代理类要通过 beanName ,并且要把代理类转换为接口使用</em></p>
<p>接口及被代理类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hank.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ServiceInterface</span> &#123;</span><br><span class="line">    String  <span class="title function_">foo</span><span class="params">(String name,<span class="type">int</span> value )</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component(&quot;bar&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> <span class="keyword">implements</span> <span class="title class_">ServiceInterface</span> &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(String name,<span class="type">int</span> value )</span>&#123;</span><br><span class="line">     <span class="keyword">return</span>  <span class="string">&quot;foo 返回:&quot;</span>+name+<span class="string">&quot;,&quot;</span>+value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//被切入的方法是接口里的方法,在 ioc 里找实现此接口的 bean,代理</span></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;execution(* ServiceInterface.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint pointcut)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;匹配的切点:&quot;</span>+pointcut.getStaticPart());</span><br><span class="line">    System.out.println(pointcut.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + pointcut.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> pointcut.proceed();</span><br><span class="line">    System.out.println(pointcut.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + pointcut.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="comment">//通过这种方式不行  var bean= (ServiceInterface)context.getBean(&quot;Bar.class);</span></span><br><span class="line">    <span class="comment">//以为容器里现在能提供的是代理列,而不是被代理类,只能通过 beanName获 取被代理类</span></span><br><span class="line">    <span class="keyword">var</span> bean= (ServiceInterface)context.getBean(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+bean.foo(<span class="string">&quot;ok&quot;</span>,<span class="number">1</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><font color=blue>例子6: 泛型匹配</font></p>
<p><em>切点表达式匹配的是方法的原型,也就是定义是的方法签名</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hank.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Son</span> <span class="keyword">extends</span>  <span class="title class_">Parent</span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span>  &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(List&lt;? extends  Parent&gt; t)</span>&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&quot;foo&quot;</span>+t.toString();</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//此方法不能被切点表达式切中</span></span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">boo</span><span class="params">(List&lt;Son&gt; t)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;boo&quot;</span>+t.toString();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>切点</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//这里是匹配方法的原型里的参数</span></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;execution(* com.hank.aop.Bar.*(java.util.List&lt;? extends Parent&gt;))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint pointcut)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;匹配的切点:&quot;</span>+pointcut.getStaticPart());</span><br><span class="line">    System.out.println(pointcut.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + pointcut.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> pointcut.proceed();</span><br><span class="line">    System.out.println(pointcut.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + pointcut.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    <span class="keyword">var</span> list=List.of(<span class="keyword">new</span> <span class="title class_">Son</span>());</span><br><span class="line">    System.out.println(bean.foo(list));</span><br><span class="line">    System.out.println(bean.boo(list));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">匹配的切点:execution(String com.hank.aop.Bar.foo(List))</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.foo,around 增强前</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.foo,around 增强后</span></span><br><span class="line"><span class="comment">foo[com.hank.aop.Son@5c18016b]</span></span><br><span class="line"><span class="comment">boo[com.hank.aop.Son@5c18016b]</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="within-匹配到类为止-类下方法自动都匹配到"><a href="#within-匹配到类为止-类下方法自动都匹配到" class="headerlink" title="within 匹配到类为止,类下方法自动都匹配到"></a>within 匹配到类为止,类下方法自动都匹配到</h4><p><em>within表达式的粒度为类，其参数为全路径的类名（可使用通配符），表示匹配当前表达式的所有类都将被当前方法环绕</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被代理类</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bar foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">boo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bar boo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//within 内填写需要拦截的类的全限定名</span></span><br><span class="line">  <span class="meta">@Pointcut(&quot;within(com.hank.aop.Bar)&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;运行时织入,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println(bean.foo());</span><br><span class="line">    System.out.println(bean.boo());</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    com.hank.aop.Bar.foo,around 增强前</span></span><br><span class="line"><span class="comment">    com.hank.aop.Bar.foo,around 增强后</span></span><br><span class="line"><span class="comment">    运行时织入,Bar foo 方法返回结果</span></span><br><span class="line"><span class="comment">    com.hank.aop.Bar.boo,around 增强前</span></span><br><span class="line"><span class="comment">    com.hank.aop.Bar.boo,around 增强后</span></span><br><span class="line"><span class="comment">    运行时织入,Bar boo 方法返回结果</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="args-只匹配方法参数-而不考虑其它因素"><a href="#args-只匹配方法参数-而不考虑其它因素" class="headerlink" title="args  只匹配方法参数,而不考虑其它因素"></a>args  只匹配方法参数,而不考虑其它因素</h4><p><em>args表达式的作用是匹配指定参数类型和指定参数数量的方法，无论其类路径或者是方法名是什么</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line">   </span><br><span class="line">   args 表达式匹配 如下匹配第一个参数是 <span class="type">int</span> ,第二个参数是 String, 余下参数不限制的方法</span><br><span class="line">  <span class="meta">@Pointcut(&quot;args(int ,String,..)&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//如果想要获取注解类型的参数</span></span><br><span class="line">  <span class="meta">@Pointcut(&quot;@args(arg1,arg2,..)&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt3</span><span class="params">(<span class="type">int</span> arg1 ,String arg2)</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;运行时织入,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//被代理类</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(String name,<span class="type">int</span> value)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bar foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//按照上面的切切入点表达式 args 只能匹配到此方法</span></span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">boo</span><span class="params">(<span class="type">int</span> value,String name)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bar boo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println(bean.foo());</span><br><span class="line">    System.out.println(bean.boo());</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    Bar foo 方法返回结果</span></span><br><span class="line"><span class="comment">    com.hank.aop.Bar.boo,around 增强前</span></span><br><span class="line"><span class="comment">    com.hank.aop.Bar.boo,around 增强后</span></span><br><span class="line"><span class="comment">    运行时织入,Bar boo 方法返回结果</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="this和target-匹配到类或接口为止-匹配所有方法"><a href="#this和target-匹配到类或接口为止-匹配所有方法" class="headerlink" title="this和target 匹配到类或接口为止,匹配所有方法"></a>this和target 匹配到类或接口为止,匹配所有方法</h4><p><em>this表示代理对象,target表示被代理对象,使用方式上比较绕,不要使用</em></p>
<p>举例说明:<br>接口：com.hank.aop.ServiceInterface<br>接口实现类：com.hank.aop.ServiceImpl</p>
<p>jdk生成的动态代理类：实现接口HelloService，继承Proxy类<br>cglib生成的动态代理类：实现接口HelloService，继承HelloServiceImpl</p>
<p>使用 jdk 动态代理</p>
<ul>
<li>@Pointcut(“this(com.hank.aop.ServiceInterface)”)：匹配切点<br>代理对象需要实现此接口所以匹配</li>
<li>@Pointcut(“this(com.hank.aop.ServiceImpl)”)：不匹配切点<br>代理对象没有继承被代理对象,所以不匹配</li>
<li>@Pointcut(“target(com.hank.aop.ServiceInterface)”)：匹配切点<br>被代理对象实现此接口,所以匹配</li>
<li>@Pointcut(“target(com.hank.aop.ServiceImpl)”)：匹配切点</li>
</ul>
<p>使用 cglib 动态代理, 用如下切点去匹配 ServiceImpl 类的方法</p>
<ul>
<li>@Pointcut(“this(com.hank.aop.aop.ServiceInterface)”)：匹配切点<br>代理对象实现此接口,所以匹配</li>
<li>@Pointcut(“this(com.hank.aop.ServiceImpl)”)：匹配切点<br>代理对象继承自此对象,所以匹配</li>
<li>@Pointcut(“target(com.hank.aop.ServiceInterface)”)：匹配切点<br>被代理对象实现此接口,所以匹配</li>
<li>@Pointcut(“target(com.hank.aop.ServiceImpl)”)：匹配切点</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(String name,<span class="type">int</span> value)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bar foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">boo</span><span class="params">(<span class="type">int</span> value,String name)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bar boo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//被代理对象就是 com.hank.aop.Bar 所以匹配</span></span><br><span class="line">  <span class="meta">@Pointcut(&quot;target(com.hank.aop.Bar)&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;运行时织入,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="annotation-注解匹配"><a href="#annotation-注解匹配" class="headerlink" title="@annotation 注解匹配"></a>@annotation 注解匹配</h4><p><em>使用起来更为灵活,想给那个方法加 aop 直接加注解,为了方便可以把注解加到被代理类上,则对所有方法都起作用</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义注解,通过注解找切入点</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD , ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAopAnnotationAOP &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//被代理类</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//给需要拦截增强功能的方法添加注解,定义切入点</span></span><br><span class="line">  <span class="meta">@MyAopAnnotationAOP</span></span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">boo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;boo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过注解关联的切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// @annotation里填入注解的全路径名</span></span><br><span class="line">  <span class="meta">@Pointcut(&quot;@annotation(com.hank.aop.MyAopAnnotationAOP)&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">   </span><br><span class="line">  <span class="comment">//如果想要获取注解类型的参数</span></span><br><span class="line">  <span class="meta">@Pointcut(&quot;@annotation(myAopAnnotationAOP)&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt3</span><span class="params">(MyAopAnnotationAOP myAopAnnotationAOP)</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;运行时织入,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println(bean.foo());</span><br><span class="line">    System.out.println(bean.boo());</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    com.hank.aop.Bar.foo,around 增强前</span></span><br><span class="line"><span class="comment">    com.hank.aop.Bar.foo,around 增强后</span></span><br><span class="line"><span class="comment">    运行时织入,foo 方法返回结果</span></span><br><span class="line"><span class="comment">    boo 方法返回结果</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="within-结合了-annotation-和-within"><a href="#within-结合了-annotation-和-within" class="headerlink" title="@within 结合了 @annotation 和 within"></a>@within 结合了 @annotation 和 within</h4><p><em>@within 也是匹配到类为止,但是 @within 的参数不是类名,而是自定义的注解名,此注解要加到被代理类上</em></p>
<h4 id="args-结合了-annotation-和-args"><a href="#args-结合了-annotation-和-args" class="headerlink" title="@args 结合了 @annotation 和 args"></a>@args 结合了 @annotation 和 args</h4><p><em>@args表示使用指定注解标注的类作为某个方法的参数时该方法将会被匹配</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyArgAnnotation &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//注解加到类上,用此类作为参数的方法会被 aop</span></span><br><span class="line"><span class="meta">@MyArgAnnotation</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//此方法会被代理</span></span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(Order order)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bar foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">boo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bar boo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//寻找的切入点 @args(com.hank.aop.MyArgAnnotation) </span></span><br><span class="line">  <span class="comment">//先找此注解标注的类,在找 ioc 容器里找 bean 用此类作为参数的方法,此方法会被代理</span></span><br><span class="line">  <span class="meta">@Pointcut(&quot;@args(com.hank.aop.MyArgAnnotation)&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;运行时织入,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println(bean.foo(<span class="keyword">new</span> <span class="title class_">Order</span>()));</span><br><span class="line">    System.out.println(bean.boo());</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     com.hank.aop.Bar.foo,around 增强前</span></span><br><span class="line"><span class="comment">     com.hank.aop.Bar.foo,around 增强后</span></span><br><span class="line"><span class="comment">     运行时织入,Bar foo 方法返回结果</span></span><br><span class="line"><span class="comment">     Bar boo 方法返回结果</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="bean-Bean-id或名字通配符-匹配-bean-的所有方法"><a href="#bean-Bean-id或名字通配符-匹配-bean-的所有方法" class="headerlink" title="bean(Bean id或名字通配符)匹配 bean 的所有方法"></a>bean(Bean id或名字通配符)匹配 bean 的所有方法</h4><p><em>使用“bean(Bean id或名字通配符)”匹配特定名称的Bean对象的执行方法；Spring ASP扩展的，在AspectJ中无相应概念</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被代理类</span></span><br><span class="line"><span class="meta">@Component(&quot;bar&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(String name,<span class="type">int</span> value )</span>&#123;</span><br><span class="line">     <span class="keyword">return</span>  <span class="string">&quot;foo 返回:&quot;</span>+name+<span class="string">&quot;,&quot;</span>+value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span>  <span class="type">int</span>  <span class="title function_">boo</span><span class="params">(String name,String value )</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//也可以和通配符配合 *bar 以bar 结尾的  bean</span></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;bean(bar)&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint pointcut)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;匹配的切点:&quot;</span>+pointcut.getStaticPart());</span><br><span class="line">    System.out.println(pointcut.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + pointcut.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> pointcut.proceed();</span><br><span class="line">    System.out.println(pointcut.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + pointcut.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">测试</span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+bean.foo(<span class="string">&quot;ok&quot;</span>,<span class="number">1</span>));</span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+bean.boo(<span class="string">&quot;notOK&quot;</span>,<span class="string">&quot;notOK&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">匹配的切点:execution(String com.hank.aop.Bar.foo(String,int))</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.foo,around 增强前</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.foo,around 增强后</span></span><br><span class="line"><span class="comment">方法返回的结果是:foo 返回:ok,1</span></span><br><span class="line"><span class="comment">匹配的切点:execution(int com.hank.aop.Bar.boo(String,String))</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.boo,around 增强前</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.boo,around 增强后</span></span><br><span class="line"><span class="comment">方法返回的结果是:1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h4 id="DeclareParents-把一个方法织入到代理类中"><a href="#DeclareParents-把一个方法织入到代理类中" class="headerlink" title="@DeclareParents  把一个方法织入到代理类中"></a>@DeclareParents  把一个方法织入到代理类中</h4><p>把一个接口的方法织入到代理类中,被代理类就可以使用此方法了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被代理类</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bar foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//要织入的接口及实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderInterface</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">boo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> <span class="keyword">implements</span>  <span class="title class_">OrderInterface</span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">boo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Order boo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>切面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line">  <span class="comment">//value :指定指定的接口的方法织入给那个被代理类</span></span><br><span class="line">  <span class="comment">//指定被织入的方法的实现类</span></span><br><span class="line">  <span class="meta">@DeclareParents(value = &quot;com.hank.*.Bar&quot;,defaultImpl = Order.class)</span></span><br><span class="line">  <span class="comment">//此注解只能加在属性上,属性是一个接口类</span></span><br><span class="line">  <span class="keyword">private</span> OrderInterface order;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">     <span class="keyword">if</span>(bean <span class="keyword">instanceof</span> OrderInterface)&#123;</span><br><span class="line">        <span class="keyword">var</span> order= (OrderInterface)bean;</span><br><span class="line">       System.out.println( order.boo());</span><br><span class="line">       <span class="comment">// Order boo 方法返回结果</span></span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="切点表达式的组合-amp-amp"><a href="#切点表达式的组合-amp-amp" class="headerlink" title="切点表达式的组合 &amp;&amp; , || , !"></a>切点表达式的组合 &amp;&amp; , || , !</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被代理类</span></span><br><span class="line"><span class="keyword">package</span> com.hank.aop;</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(String name,<span class="type">int</span> value )</span>&#123;</span><br><span class="line">     <span class="keyword">return</span>  <span class="string">&quot;返回:&quot;</span>+name+<span class="string">&quot;,&quot;</span>+value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// || 或的关系,只有 execution 表达式能匹配到方法</span></span><br><span class="line">   <span class="meta">@Pointcut(value = &quot;execution( * com.hank.aop.Bar.*(..)) || args(int ,int )&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt1</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// &amp;&amp; 与的关系,没有方法的参数符合 args(int ,int ) ,所以没有匹配的方法</span></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;execution( * com.hank.aop.Bar.*(..)) &amp;&amp; args(int ,int )&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//切点表达式也可以组合以有的切点</span></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;pt1() &amp;&amp; pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt3</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(&quot;pt1()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;匹配的切点:&quot;</span>+point.getStaticPart());</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//因为 pt2 切点表达式没有匹配到任何方法,所以如下的增强功能没有执行</span></span><br><span class="line">  <span class="meta">@AfterReturning(&quot;pt2()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span>&#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;afterReturning 增强&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+bean.foo(<span class="string">&quot;ok&quot;</span>,<span class="number">1</span>));;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">匹配的切点:execution(String com.hank.aop.Bar.foo(String,int))</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.foo,around 增强前</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.foo,around 增强后</span></span><br><span class="line"><span class="comment">方法返回的结果是:返回:ok,1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="AOP常用注解及执行顺序"><a href="#AOP常用注解及执行顺序" class="headerlink" title="AOP常用注解及执行顺序"></a>AOP常用注解及执行顺序</h3><ul>
<li>@Aspect：作用是把当前类标识为一个切面供容器读取</li>
<li>@Pointcut：切入点是对连接点进行拦截的条件定义，在程序中主要体现为书写切入点表达式,切入点表达式也可以加在各种通知上</li>
<li>@Before：标识一个前置增强方法，该注解标注的方法在业务模块代码执行之前执行，其不能阻止业务模块的执行，除非抛出异常</li>
<li>@AfterReturning：后置增强，该注解标注的方法在业务模块代码执行之后执行,如果业务代码抛出异常,此方法就不会执行了</li>
<li>@AfterThrowing：异常抛出增强，该注解标注的方法在业务模块抛出指定异常后执行</li>
<li>@After：final增强，该注解标注的方法在所有的Advice执行完成后执行，无论业务模块是否抛出异常，类似于finally的作用</li>
<li>@Around：环绕增强，该注解功能最为强大，其所标注的方法用于编写包裹业务模块执行的代码，其可以传入一个ProceedingJoinPoint用于调用<br>业务模块的代<br>码，无论是调用前逻辑还是调用后逻辑，都可以在该方法中编写，甚至其可以根据一定的条件而阻断业务模块的调用；</li>
<li>@DeclareParents:在属性声明上使用，主要用于为指定的业务模块添加新的接口和相应的实现。</li>
</ul>
<p>执行顺序<br><font color=blue><em>业务代码没有错误</em></font></p>
<pre class="mermaid">graph LR
    Around前 -.-> Before -.-> 业务 -.-> AfterReturning -.-> After -.-> Around后</pre>

<p><font color=blue>业务代码有错误</font></p>
<pre class="mermaid">  graph LR
    Around前 -.-> Before -.-> 业务 -.-> AfterThrowing -.-> After</pre>


<h3 id="Spring-AOP-增强方法参数-JoinPoint-及-ProceedingJoinPoint"><a href="#Spring-AOP-增强方法参数-JoinPoint-及-ProceedingJoinPoint" class="headerlink" title="Spring AOP 增强方法参数 JoinPoint 及 ProceedingJoinPoint"></a>Spring AOP 增强方法参数 JoinPoint 及 ProceedingJoinPoint</h3><p><em>通过这俩个 JoinPoint 及 ProceedingJoinPoint  参数获取的信息,方便在做横向拦截的时候,比如日志记录的时候就可以进行完整的记录比如什么对象的什么方法返回结果是什么</em></p>
<h4 id="增强方法参数获取-getTarget-amp-getThis"><a href="#增强方法参数获取-getTarget-amp-getThis" class="headerlink" title="增强方法参数获取 getTarget &amp; getThis"></a>增强方法参数获取 getTarget &amp; getThis</h4><p>如下代码打印 getTarget , getThis 显示的都是 原本的 Bar 对象 com.hank.aop.Bar@2f4205be,难道被代理对象和和代理对象是一个对象码?<br>获取对象类型看下,被代理对象和代理对象的对象类型不一样,说明代理对象没有重写被代理对象的 toString 方法.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  <span class="title function_">Bar</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="built_in">this</span>);</span><br><span class="line">    <span class="comment">//com.hank.aop.Bar@2f4205be</span></span><br><span class="line">    <span class="comment">//构造器执行的时候,还没没有生成代理对象</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bar foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(&quot;execution( * com.hank.aop.Bar.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">    System.out.println(joinPoint.getTarget());</span><br><span class="line">    System.out.println(joinPoint.getThis());</span><br><span class="line">    <span class="comment">//com.hank.aop.Bar@2f4205be</span></span><br><span class="line">    <span class="comment">//com.hank.aop.Bar@2f4205be</span></span><br><span class="line"></span><br><span class="line">    System.out.println(joinPoint.getTarget().getClass().getName());</span><br><span class="line">    System.out.println(joinPoint.getThis().getClass().getName());</span><br><span class="line">    <span class="comment">//com.hank.aop.Bar</span></span><br><span class="line">    <span class="comment">//com.hank.aop.Bar$$EnhancerBySpringCGLIB$$602e8f0e</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="增强方法参数获取-getSignature"><a href="#增强方法参数获取-getSignature" class="headerlink" title="增强方法参数获取 getSignature"></a>增强方法参数获取 getSignature</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(<span class="type">int</span> value )</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Bar foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(&quot;execution( * com.hank.aop.Bar.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(Pointcut pointcut)</span>&#123;</span><br><span class="line">    <span class="comment">// joinPoint.getSignature() 方法签名获取</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取方法定义的类的类型</span></span><br><span class="line">    System.out.println(joinPoint.getSignature().getDeclaringType());</span><br><span class="line">    <span class="comment">//方法的名字</span></span><br><span class="line">    System.out.println(joinPoint.getSignature().getName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果获取方法的参数  返回值呢? 直接获取没有对应的 api ,看一下 joinPoint.getSignature() 对象的接口类型</span></span><br><span class="line">    <span class="type">var</span> <span class="variable">list</span> <span class="operator">=</span>Arrays.stream(joinPoint.getSignature().getClass().getInterfaces()).map(p-&gt;p.getName()).collect(Collectors.toList());</span><br><span class="line">    System.out.println(Arrays.toString(list.toArray()));</span><br><span class="line">    <span class="comment">//org.aspectj.lang.reflect.MethodSignature</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//把签名对象转换为此接口</span></span><br><span class="line">    <span class="keyword">var</span> methodSignature=(MethodSignature)joinPoint.getSignature();</span><br><span class="line">    <span class="comment">//获取返回类型</span></span><br><span class="line">    System.out.println(methodSignature.getMethod().getReturnType());</span><br><span class="line">    <span class="comment">//class java.lang.String</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取参数类型</span></span><br><span class="line">    Arrays.stream(methodSignature.getMethod().getParameterTypes()).forEach(p-&gt;&#123;</span><br><span class="line">      System.out.println(p);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//int</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//直接获取的参数类型是 object,如果参数类型是值类型,就是被包装过的. 所以不如上面的 MethodSignature 接口获取的参数类型还用</span></span><br><span class="line">    Arrays.stream(joinPoint.getArgs()).forEach(p-&gt;&#123;</span><br><span class="line">      System.out.println(p.getClass());</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//class java.lang.Integer</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ProceedingJoinPoint-AfterReturning-AfterThrowing-绑定"><a href="#ProceedingJoinPoint-AfterReturning-AfterThrowing-绑定" class="headerlink" title="ProceedingJoinPoint , (@AfterReturning,@AfterThrowing) 绑定"></a>ProceedingJoinPoint , (@AfterReturning,@AfterThrowing) 绑定</h4><p>注意点:</p>
<ul>
<li>ProceedingJoinPoint 执行 proceed 方法时也可以重新给方法传递新的参数</li>
<li>执行 proceed 不要把异常在往外部抛出</li>
<li>如果要在 @AfterReturning(value = “pt()”,returning = “ret”) ,@AfterThrowing(value = “pt()”,throwing = “e”) ,这俩个增强方法里获取到参数要在注解里增加相应的绑定,比如 returning = “ret”</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被代理类</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(<span class="type">int</span> value )</span>&#123;</span><br><span class="line">    <span class="comment">//抛出错误</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>(<span class="string">&quot;空指针&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(&quot;execution( * com.hank.aop.Bar.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span>  &#123;</span><br><span class="line">    <span class="comment">//这里的 try catch 是给增强方法自己使用的,被代理类的方法执行错误捕获是在代理类类,不是这里的 try catch</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">//此方法默认不用传递参数</span></span><br><span class="line">      <span class="comment">//如果传递参会，就会覆盖在外部调用处传递进来的参数</span></span><br><span class="line">      <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> joinPoint.proceed(<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="number">2</span>&#125;);</span><br><span class="line">      <span class="keyword">return</span> ret;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//没有异常被抛出此方法才会被调用</span></span><br><span class="line">  <span class="meta">@AfterReturning(value = &quot;pt()&quot;,returning = &quot;ret&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object ret)</span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;afterReturning advice:&quot;</span>+ret);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//有异常抛出的时候调用</span></span><br><span class="line">  <span class="meta">@AfterThrowing(value = &quot;pt()&quot;,throwing = &quot;e&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">throwError</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;throwError advice:&quot;</span>+e.getMessage());</span><br><span class="line">    <span class="comment">//throwError:空指针</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 此通知无论是否有异常抛出，都会被调用，也就是在被 spring AOP 在内部代理对象的 finally 方法被回调的</span></span><br><span class="line">  <span class="meta">@After(value = &quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;after advice&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+bean.foo(<span class="number">1</span>));</span><br><span class="line">    <span class="comment">//方法返回的结果是:null</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 输出的结果:</span></span><br><span class="line"><span class="comment">// throwError:空指针</span></span><br><span class="line"><span class="comment">// after</span></span><br><span class="line"><span class="comment">// 方法返回的结果是:null</span></span><br></pre></td></tr></table></figure>

<h3 id="args-annotation-配合-argNames"><a href="#args-annotation-配合-argNames" class="headerlink" title="args() , @annotation 配合 argNames"></a>args() , @annotation 配合 argNames</h3><p><font color=chocolate>* 代理对象 ( this)、目标对象 ( target) 和注解 ( @within、 @target、@annotation和@args)  都是可以和 argNames 进行配合的*</font></p>
<h4 id="args-配合-argNames"><a href="#args-配合-argNames" class="headerlink" title="args() 配合 argNames"></a>args() 配合 argNames</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(value = &quot;args( arg1,arg2 )&quot;)</span></span><br><span class="line"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">(String arg1,<span class="type">int</span> arg2)</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>切点表达式参数 (String arg1,int arg2) 接收的外部调用被代理类相应方法被调用时传递进来的参数,是按照顺序传递的,此参数的类型(String ,int )是要去匹配被代理方法的参数, args( arg1,arg2 ) 定义了传递进来参数的接收名字. 直接定义成 args( String,int ) 也可以匹配到被切入的方法,但是在增强方法里不能  <code>@Around(value = &quot;pt(p1,p2)&quot;,argNames = &quot;pointcut,p1,p2&quot;) public Object around(ProceedingJoinPoint pointcut,String p1,int p2)</code> 在增强方法里传递参数给 around 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被代理类</span></span><br><span class="line"><span class="keyword">package</span> com.hank.aop;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">(String name,<span class="type">int</span> value )</span>&#123;</span><br><span class="line">     <span class="keyword">return</span>  <span class="string">&quot;foo 返回:&quot;</span>+name+<span class="string">&quot;,&quot;</span>+value;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//此方法不能被切点表达式切中</span></span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">boo</span><span class="params">(String name,String value )</span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  <span class="string">&quot;boo 返回:&quot;</span>+name+<span class="string">&quot;,&quot;</span>+value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;args( arg1,arg2 )&quot;)</span></span><br><span class="line">  <span class="keyword">public</span>  <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">(String arg1,<span class="type">int</span> arg2)</span>&#123;&#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  <span class="comment">//arg1,arg2 到 p1,p2 参数是按照顺序传递的.</span></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt(p1,p2)&quot;,argNames = &quot;pointcut,p1,p2&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pointcut,String p1,<span class="type">int</span> p2)</span> &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">args</span> <span class="operator">=</span>pointcut.getArgs();</span><br><span class="line">    <span class="comment">//getArgs 获取的参数是 Object 类型</span></span><br><span class="line">    </span><br><span class="line">    System.out.println(<span class="string">&quot;匹配的切点:&quot;</span>+pointcut.getStaticPart());</span><br><span class="line">    System.out.println(<span class="string">&quot;传入的参数是&quot;</span>+p1+<span class="string">&quot;,&quot;</span>+p2);</span><br><span class="line">    System.out.println(pointcut.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + pointcut.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> pointcut.proceed();</span><br><span class="line">    System.out.println(pointcut.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + pointcut.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+bean.foo(<span class="string">&quot;ok&quot;</span>,<span class="number">1</span>));;</span><br><span class="line"></span><br><span class="line">    System.out.println( <span class="string">&quot;方法返回的结果是:&quot;</span>+bean.boo(<span class="string">&quot;notOK&quot;</span>,<span class="string">&quot;notOK&quot;</span>));;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">匹配的切点:execution(String com.hank.aop.Bar.foo(String,int))</span></span><br><span class="line"><span class="comment">传入的参数是ok,1</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.foo,around 增强前</span></span><br><span class="line"><span class="comment">com.hank.aop.Bar.foo,around 增强后</span></span><br><span class="line"><span class="comment">方法返回的结果是:foo 返回:ok,1</span></span><br><span class="line"><span class="comment">方法返回的结果是:boo 返回:notOK,notOK</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>


<h4 id="annotation-配合-argNames"><a href="#annotation-配合-argNames" class="headerlink" title="@annotation 配合 argNames"></a>@annotation 配合 argNames</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD , ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAopAnnotationAOP &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//给需要拦截增强功能的方法添加注解,定义切入点</span></span><br><span class="line">  <span class="meta">@MyAopAnnotationAOP</span></span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">boo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;boo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>切面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//如果想要获取注解类型的参数</span></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;@annotation(myAopAnnotationAOP)&quot;, argNames =  &quot;myAopAnnotationAOP&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">(MyAopAnnotationAOP myAopAnnotationAOP)</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt(myAopAnnotationAOP)&quot;,argNames = &quot;point,myAopAnnotationAOP&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint point,MyAopAnnotationAOP myAopAnnotationAOP)</span> &#123;</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(point.getTarget().getClass().getName() + <span class="string">&quot;.&quot;</span> + point.getSignature().getName() + <span class="string">&quot;,around 增强后&quot;</span>);</span><br><span class="line">    System.out.println(myAopAnnotationAOP.annotationType());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;运行时织入,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println(bean.foo());</span><br><span class="line">    System.out.println(bean.boo());</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    com.hank.aop.Bar.foo,around 增强前</span></span><br><span class="line"><span class="comment">    com.hank.aop.Bar.foo,around 增强后</span></span><br><span class="line"><span class="comment">    interface com.hank.aop.MyAopAnnotationAOP</span></span><br><span class="line"><span class="comment">    运行时织入,foo 方法返回结果</span></span><br><span class="line"><span class="comment">    boo 方法返回结果</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多个切面执行顺序"><a href="#多个切面执行顺序" class="headerlink" title="多个切面执行顺序"></a>多个切面执行顺序</h3><h4 id="多个切面执行顺序-1"><a href="#多个切面执行顺序-1" class="headerlink" title="多个切面执行顺序"></a>多个切面执行顺序</h4><p>默认是安装切面类名的unicode编码顺序执行的，小的先执行，如果需要强制执行顺序有俩种方法，也是安装数字小的先执行：</p>
<ol>
<li>切面类加注解 @Order()</li>
<li>实现 Ordered 接口</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect1</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;execution(* Bar.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;AopAspect1,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;AopAspect1,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;AopAspect1,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span> <span class="keyword">implements</span> <span class="title class_">Ordered</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;execution(* Bar.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;AopAspect,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;AopAspect,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;AopAspect,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getOrder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println(bean.foo());</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    AopAspect1,around 增强前</span></span><br><span class="line"><span class="comment">    AopAspect,around 增强前</span></span><br><span class="line"><span class="comment">    AopAspect,around 增强后</span></span><br><span class="line"><span class="comment">    AopAspect1,around 增强后</span></span><br><span class="line"><span class="comment">    AopAspect1,AopAspect,foo 方法返回结果</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="单个切面内的执行顺序"><a href="#单个切面内的执行顺序" class="headerlink" title="单个切面内的执行顺序"></a>单个切面内的执行顺序</h4><p><em>单个切面内的同一功能的增强器执行顺序，是按照 unicode编码顺序执行的，小的先执行</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span>  &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;execution(* Bar.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">b</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;b,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;b,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;AopAspect,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt()&quot;)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">a</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;a,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;a,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;AopAspect,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println(bean.foo());</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    a,around 增强前</span></span><br><span class="line"><span class="comment">    b,around 增强前</span></span><br><span class="line"><span class="comment">    b,around 增强后</span></span><br><span class="line"><span class="comment">    a,around 增强后</span></span><br><span class="line"><span class="comment">    AopAspect,AopAspect,foo 方法返回结果</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="代理对象调用自身的方法"><a href="#代理对象调用自身的方法" class="headerlink" title="代理对象调用自身的方法"></a>代理对象调用自身的方法</h3><p>如下代码在被代理对象内方法调用方法 <code>var  str =this.doo();</code> doo方法 没有被增强，是因为方法想要增强必须是被代理对象调用，而不是被被代理对象调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被代理对象</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//被代理对象调用的方法不会被增强</span></span><br><span class="line">    <span class="type">var</span>  <span class="variable">str</span> <span class="operator">=</span><span class="built_in">this</span>.doo();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;foo 方法返回结果,&quot;</span>+str;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span>  String <span class="title function_">doo</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="keyword">return</span>  <span class="string">&quot;doo&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//切面</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span>  &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;execution(* Bar.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;around,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;around,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;AopAspect,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean= context.getBean(Bar.class);</span><br><span class="line">    System.out.println(bean.foo());</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    around,around 增强前</span></span><br><span class="line"><span class="comment">    around,around 增强后</span></span><br><span class="line"><span class="comment">    AopAspect,foo 方法返回结果,doo</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那如何在被代理对象内获取代理对象呢？解决方法:</p>
<ol>
<li>注入代理对象<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">// 注入代理对象</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> Bar bar;</span><br><span class="line">   <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="type">var</span>  <span class="variable">str</span> <span class="operator">=</span>bar.doo();</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&quot;foo 方法返回结果,&quot;</span>+str;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span>  String <span class="title function_">doo</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="keyword">return</span>  <span class="string">&quot;doo&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
<li>更方便的方法是 用AopContext 上下文 获取代理对象<br>默认 AopContext 上下文是没有对外赋值的，如果要赋值要开启<br><code>@EnableAspectJAutoProxy(exposeProxy = true)</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="type">var</span>  <span class="variable">str</span> <span class="operator">=</span> ((Bar)AopContext.currentProxy()).doo();</span><br><span class="line">     <span class="keyword">return</span> <span class="string">&quot;foo 方法返回结果,&quot;</span>+str;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span>  String <span class="title function_">doo</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="keyword">return</span>  <span class="string">&quot;doo&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="Spring-AOP-SCOPE-SINGLETON-vs-SCOPE-PROTOTYPE"><a href="#Spring-AOP-SCOPE-SINGLETON-vs-SCOPE-PROTOTYPE" class="headerlink" title="Spring AOP SCOPE_SINGLETON vs SCOPE_PROTOTYPE"></a>Spring AOP SCOPE_SINGLETON vs SCOPE_PROTOTYPE</h3><h5 id="代理对象的-SCOPE-是跟着被代理对象的-SCOPE"><a href="#代理对象的-SCOPE-是跟着被代理对象的-SCOPE" class="headerlink" title="代理对象的 SCOPE 是跟着被代理对象的 SCOPE"></a>代理对象的 SCOPE 是跟着被代理对象的 SCOPE</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//被代理对象是  PROTOTYPE</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(BeanDefinition.SCOPE_PROTOTYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Bar</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Bar 构造函数执行&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//切面默认是单例</span></span><br><span class="line"><span class="meta">@Aspect()</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span>  &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">AopAspect</span><span class="params">()</span>&#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;AopAspect 执行一次-----------------------------&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Pointcut(value = &quot;execution(* Bar.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;around,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;around,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;AopAspect,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line">  <span class="meta">@EnableAspectJAutoProxy(exposeProxy = true)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">  <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">  <span class="keyword">var</span> bean1= context.getBean(Bar.class);</span><br><span class="line">  System.out.println(<span class="string">&quot;代理对象的 hashCode: &quot;</span>bean1.hashCode());</span><br><span class="line">  System.out.println(bean1.foo());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> bean2=context.getBean(Bar.class);</span><br><span class="line">  System.out.println(<span class="string">&quot;代理对象的 hashCode: &quot;</span>bean2.hashCode());</span><br><span class="line">  System.out.println(bean2.foo());</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  AopAspect 执行一次-----------------------------</span></span><br><span class="line"><span class="comment">  Bar 构造函数执行</span></span><br><span class="line"><span class="comment">  代理对象的 hashCode:773512481</span></span><br><span class="line"><span class="comment">  around,around 增强前</span></span><br><span class="line"><span class="comment">  around,around 增强后</span></span><br><span class="line"><span class="comment">  AopAspect,foo 方法返回结果</span></span><br><span class="line"><span class="comment">  Bar 构造函数执行</span></span><br><span class="line"><span class="comment">  代理对象的 hashCode: 800359709</span></span><br><span class="line"><span class="comment">  around,around 增强前</span></span><br><span class="line"><span class="comment">  around,around 增强后</span></span><br><span class="line"><span class="comment">  AopAspect,foo 方法返回结果</span></span><br><span class="line"><span class="comment">  </span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Aspect-对象的-SCOPE-PROTOTYPE-是跟着被代理对象的-SCOPE-PROTOTYPE"><a href="#Aspect-对象的-SCOPE-PROTOTYPE-是跟着被代理对象的-SCOPE-PROTOTYPE" class="headerlink" title="Aspect 对象的 SCOPE_PROTOTYPE 是跟着被代理对象的 SCOPE_PROTOTYPE"></a>Aspect 对象的 SCOPE_PROTOTYPE 是跟着被代理对象的 SCOPE_PROTOTYPE</h5><p>Aspect 对象的 SCOPE 是 PROTOTYPE ，必须代理对象的 SCOPE 必须也是 PROTOTYPE, 单独 Aspect 对象的 SCOPE 是 PROTOTYPE 没有作用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(BeanDefinition.SCOPE_PROTOTYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Bar</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Bar</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Bar 构造函数执行&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span>  String  <span class="title function_">foo</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;foo 方法返回结果&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect()</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(BeanDefinition.SCOPE_PROTOTYPE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAspect</span>  &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">AopAspect</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;AopAspect 执行一次-----------------------------&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Pointcut(value = &quot;execution(* Bar.*(..))&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@SneakyThrows</span></span><br><span class="line">  <span class="meta">@Around(value = &quot;pt()&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint point)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;around,around 增强前&quot;</span>);</span><br><span class="line">    <span class="type">var</span> <span class="variable">ret</span> <span class="operator">=</span> point.proceed();</span><br><span class="line">    System.out.println(<span class="string">&quot;around,around 增强后&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;AopAspect,&quot;</span> + ret;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;com.hank&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy(exposeProxy = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Programmer</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">var</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(Programmer.class);</span><br><span class="line">    <span class="keyword">var</span> bean1= context.getBean(Bar.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;代理对象的 hashCode: &quot;</span>+bean1.hashCode());</span><br><span class="line">    System.out.println(bean1.foo());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> bean2=context.getBean(Bar.class);</span><br><span class="line">    System.out.println(<span class="string">&quot;代理对象的 hashCode: &quot;</span>+bean2.hashCode());</span><br><span class="line">    System.out.println(bean2.foo());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">代理对象的 hashCode: 818388744</span></span><br><span class="line"><span class="comment">AopAspect 执行一次-----------------------------</span></span><br><span class="line"><span class="comment">around,around 增强前</span></span><br><span class="line"><span class="comment">around,around 增强后</span></span><br><span class="line"><span class="comment">AopAspect,foo 方法返回结果</span></span><br><span class="line"><span class="comment">Bar 构造函数执行</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">代理对象的 hashCode: -1106177088</span></span><br><span class="line"><span class="comment">AopAspect 执行一次-----------------------------</span></span><br><span class="line"><span class="comment">around,around 增强前</span></span><br><span class="line"><span class="comment">around,around 增强后</span></span><br><span class="line"><span class="comment">AopAspect,foo 方法返回结果</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Hank Bai
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://bh.com/2022/05/25/java/springFramework/aop/aop/" title="spring framework aop">http://bh.com/2022/05/25/java/springFramework/aop/aop/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/05/25/java/springFramework/ioc/ioc/" rel="prev" title="spring framework ioc">
                  <i class="fa fa-chevron-left"></i> spring framework ioc
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/05/25/java/yaml/yaml/" rel="next" title="yaml">
                  yaml <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hank Bai</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">98k</span>
  </span>
</div>


  <script src='https://unpkg.com/mermaid@9.2.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>


    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"version":"9.2.2","theme":{"light":"default","dark":"dark","options":{"maxTextSize":99999}},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.2.2/mermaid.min.js","integrity":"sha256-CemUs9ITT7liCZpVMktcEw0BpAOZ1+mujlMB3UyuImU="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"BAI-HANK","repo":"bai-hank.github.io","client_id":"ee40f9d8aaf703fdb6ed","client_secret":"64cd53b08de038c5276753612c35ace517544597","admin_user":"BAI-HANK","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"5b46808a00a57832e3b916ee5321f718"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":0.7}});</script></body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/custom/clickLove.js"></script>

