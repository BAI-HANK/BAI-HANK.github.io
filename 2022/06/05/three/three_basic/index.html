<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/blog.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/blog.svg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/blog.svg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-big-counter.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"bh.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","width":300,"display":"post","padding":8,"offset":12},"copycode":{"enable":true,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":{"gitalk":{"order":-1}},"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Three.js 简介随着 HTML5 标准的颁布，以及主流浏览器的功能日益强大，直接在浏览器中展示三维图像和动画已经变得越来越容易。WebGL 技术为在浏览器中创建丰富的三维图形提供了丰富且强大的接口，它们不仅可以创建二维图形和应用，还可以充分利用 GPU，创建漂亮的、高性能的三维应用。但是直接使用 WebGL 编程非常复杂，需要了解 WebGL 的内部细节，学习复杂的着色器语法和足够多的数学和">
<meta property="og:type" content="blog">
<meta property="og:title" content="three.js 基础">
<meta property="og:url" content="http://bh.com/2022/06/05/three/three_basic/index.html">
<meta property="og:site_name" content="Hank Blog">
<meta property="og:description" content="Three.js 简介随着 HTML5 标准的颁布，以及主流浏览器的功能日益强大，直接在浏览器中展示三维图像和动画已经变得越来越容易。WebGL 技术为在浏览器中创建丰富的三维图形提供了丰富且强大的接口，它们不仅可以创建二维图形和应用，还可以充分利用 GPU，创建漂亮的、高性能的三维应用。但是直接使用 WebGL 编程非常复杂，需要了解 WebGL 的内部细节，学习复杂的着色器语法和足够多的数学和">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E9%9D%A2.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%BB%98%E5%88%B6%E7%82%B9.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%BB%98%E5%88%B6%E7%BA%BF.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%87%A0%E4%BD%95%E4%BD%93.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%90%83%E4%BD%93%E7%82%B9.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%90%83%E4%BD%93%E7%BA%BF.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%BA%BF%E6%AE%B5%E9%A2%9C%E8%89%B2%E6%8F%92%E5%80%BC.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E9%9D%A2%E9%A2%9C%E8%89%B2%E6%8F%92%E5%80%BC.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%AD%A3%E6%96%B9%E4%BD%93.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%9D%90%E6%A0%87%E7%A7%8D%E7%B1%BB.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E6%9C%AC%E5%9C%B0%E5%9D%90%E6%A0%87%E5%92%8C%E4%B8%96%E7%95%8C%E5%9D%90%E6%A0%87%E9%87%8D%E5%A4%8D.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E6%97%8B%E8%BD%AC%E6%9C%AC%E5%9C%B0%E5%9D%90%E6%A0%87.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%90%91%E9%87%8F%E6%96%B9%E5%90%91%E6%97%8B%E8%BD%AC.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E6%9C%AC%E5%9C%B0%E5%9D%90%E6%A0%87%E5%92%8C%E4%B8%96%E7%95%8C%E5%9D%90%E6%A0%87%E9%87%8D%E5%A4%8D.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%A7%BB%E5%8A%A8%E6%9C%AC%E5%9C%B0%E5%9D%90%E6%A0%87.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%90%91%E9%87%8F%E6%96%B9%E5%90%91%E5%B9%B3%E7%A7%BB.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%87%A0%E4%BD%95%E4%BD%93%E5%8F%8D%E6%96%B9%E5%90%91%E7%BC%A9%E6%94%BE.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/mesh%E5%8F%8D%E6%96%B9%E5%90%91%E7%BC%A9%E6%94%BE.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/center%E5%89%8D.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/center%E5%90%8E.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%B1%82%E7%BA%A7%E5%85%B3%E7%B3%BBgroup.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%B1%82%E7%BA%A7%E5%85%B3%E7%B3%BBmesh.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%B9%B3%E9%9D%A2%E7%9B%B4%E7%BA%BF.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%B9%B3%E9%9D%A2%E5%9C%86%E5%BC%A7.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%B9%B3%E9%9D%A2%E6%A4%AD%E5%9C%86.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E4%B8%89%E7%BB%B4%E6%A0%B7%E6%9D%A1%E6%9B%B2%E7%BA%BF.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E4%B8%89%E7%BB%B4%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/curvepath.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/path.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/canvas%E7%BB%98%E5%88%B62dShape.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/point%E7%BB%98%E5%88%B6Shape.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/shapeHole.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%BB%84%E5%90%88shape.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/tube.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E6%97%8B%E8%BD%AC%E6%88%90%E5%9E%8B.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%85%89%E6%BB%91%E7%9A%84%E6%97%8B%E8%BD%AC%E6%88%90%E5%9E%8B.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E6%8B%89%E4%BC%B8%E6%88%90%E5%9E%8B.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E6%89%AB%E6%8F%8F%E6%8B%89%E4%BC%B8%E6%88%90%E5%9E%8B.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%BB%98%E5%88%B63d%E6%96%87%E5%AD%97.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/uv%E8%A3%81%E5%89%AA%E5%9D%90%E6%A0%871.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/uv%E8%A3%81%E5%89%AA%E5%9B%BE%E7%89%87%E7%9A%84%E4%B8%80%E5%8D%8A.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E4%B8%89%E8%A7%92%E9%9D%A2uv.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/uv%E8%A3%81%E5%89%AA4%E5%88%86%E4%B9%8B%E4%B8%80.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/uv%E5%9D%90%E6%A0%87%E4%B8%AA%E6%95%B0%E4%B8%80%E8%87%B4.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%A0%E4%BD%95%E4%BD%93.png">
<meta property="og:image" content="http://bh.com/dice.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%BA%B9%E7%90%86%E9%98%B5%E5%88%97.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%BA%B9%E7%90%86%E5%81%8F%E7%A7%BB%E5%8A%A8%E7%94%BB.gif">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%BA%B9%E7%90%86%E6%97%8B%E8%BD%AC.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/canvasTexture%E7%BA%B9%E7%90%86.png">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%BA%B9%E7%90%86%E8%A7%86%E9%A2%91.gif">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%8A%A8%E7%94%BB%E5%B8%A7.gif">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/%E5%8F%98%E5%BD%A2%E5%8A%A8%E7%94%BB%E5%B8%A7.gif">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/rainSprint.gif">
<meta property="og:image" content="http://bh.com/2022/06/05/three/three_basic/dat-gui%E4%BD%BF%E7%94%A8%E6%95%88%E6%9E%9C.png">
<meta property="article:published_time" content="2022-06-05T02:03:00.000Z">
<meta property="article:modified_time" content="2022-12-16T03:55:43.086Z">
<meta property="article:author" content="Hank Bai">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://bh.com/2022/06/05/three/three_basic/%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E9%9D%A2.png">


<link rel="canonical" href="http://bh.com/2022/06/05/three/three_basic/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://bh.com/2022/06/05/three/three_basic/","path":"2022/06/05/three/three_basic/","title":"three.js 基础"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>three.js 基础 | Hank Blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hank Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">热爱生活,拥抱开源,乐于分享</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">8</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">20</span></a></li><li class="menu-item menu-item-others"><a href="/others/" rel="section"><i class="fa fa-users fa-fw"></i>推荐</a></li><li class="menu-item menu-item-read"><a href="/read/" rel="section"><i class="fa fa-book fa-fw"></i>阅读</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Three-js-%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">Three.js 简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Scene"><span class="nav-number">1.1.</span> <span class="nav-text">Scene</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9C%A8-react-%E9%87%8C-%E4%BD%BF%E7%94%A8-THREE"><span class="nav-number">2.</span> <span class="nav-text">在 react 里 使用 THREE</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89-hooks"><span class="nav-number">3.</span> <span class="nav-text">使用自定义 hooks</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%89%E6%BA%90"><span class="nav-number">4.</span> <span class="nav-text">光源</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%82%B9%EF%BC%8C%E7%BA%BF%EF%BC%8C%E4%B8%89%E8%A7%92%E9%9D%A2%EF%BC%8C%E5%87%A0%E4%BD%95%E4%BD%93"><span class="nav-number">5.</span> <span class="nav-text">点，线，三角面，几何体</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B6%E7%82%B9%E4%BD%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E6%B8%B2%E6%9F%93"><span class="nav-number">5.1.</span> <span class="nav-text">顶点位置数据渲染</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="nav-number">5.1.1.</span> <span class="nav-text">几何体的本质</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%9C%E8%89%B2%E6%8F%92%E5%80%BC%E8%AE%A1%E7%AE%97"><span class="nav-number">5.2.</span> <span class="nav-text">颜色插值计算</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E6%AE%B5%E9%A2%9C%E8%89%B2%E6%9C%89%E9%A1%B6%E7%82%B9%E9%A2%9C%E8%89%B2%E6%8F%92%E5%80%BC%E5%BE%97%E6%9D%A5"><span class="nav-number">5.2.1.</span> <span class="nav-text">线段颜色有顶点颜色插值得来</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9D%A2%E9%A2%9C%E8%89%B2%E6%8F%92%E5%80%BC"><span class="nav-number">5.2.2.</span> <span class="nav-text">面颜色插值</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%A6%E6%B3%95%E7%BA%BF%E7%9A%84%E5%87%A0%E4%BD%95%E4%BD%93"><span class="nav-number">5.3.</span> <span class="nav-text">带法线的几何体</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E7%B4%A2%E5%BC%95%E5%87%8F%E5%B0%91%E9%87%8D%E5%A4%8D%E7%9A%84%E7%82%B9"><span class="nav-number">5.4.</span> <span class="nav-text">通过索引减少重复的点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E5%87%A0%E4%BD%95%E4%BD%93%E6%95%B0%E6%8D%AE%E5%8F%8A%E6%8B%B7%E8%B4%9D%E5%A4%8D%E5%88%B6"><span class="nav-number">5.5.</span> <span class="nav-text">访问几何体数据及拷贝复制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E5%87%A0%E4%BD%95%E4%BD%93%E5%B9%B6%E6%9B%B4%E6%94%B9%E6%95%B0%E6%8D%AE"><span class="nav-number">5.5.1.</span> <span class="nav-text">访问几何体并更改数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%B7%E8%B4%9D%E5%A4%8D%E5%88%B6"><span class="nav-number">5.5.2.</span> <span class="nav-text">拷贝复制</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E5%9D%90%E6%A0%87%E5%92%8C%E4%B8%96%E7%95%8C%E5%9D%90%E6%A0%87"><span class="nav-number">6.</span> <span class="nav-text">本地坐标和世界坐标</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%97%8B%E8%BD%AC-%E7%BC%A9%E6%94%BE-%E5%B9%B3%E7%A7%BB-%E6%97%8B%E8%BD%AC%E6%96%B9%E5%90%91%E6%98%AF%E5%8F%B3%E6%89%8B%E5%AE%9A%E5%88%99"><span class="nav-number">7.</span> <span class="nav-text">旋转 缩放 平移 ,旋转方向是右手定则</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%8B%E8%BD%AC-%E5%BA%95%E5%B1%82%E6%98%AF%E6%AC%A7%E6%8B%89%E8%A7%92Euler"><span class="nav-number">7.1.</span> <span class="nav-text">旋转 底层是欧拉角Euler</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#rotateX-rotateY-rotateZ"><span class="nav-number">7.1.1.</span> <span class="nav-text">rotateX, rotateY,rotateZ,</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rotateOnAxis%EF%BC%8C"><span class="nav-number">7.1.2.</span> <span class="nav-text">rotateOnAxis，</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BD%93%E7%88%B6%E5%AF%B9%E8%B1%A1%E6%97%8B%E8%BD%AC%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E5%AD%90%E5%AF%B9%E8%B1%A1%E7%BB%95%E7%88%B6%E5%AF%B9%E8%B1%A1%E6%97%8B%E8%BD%AC"><span class="nav-number">7.1.3.</span> <span class="nav-text">当父对象旋转的时候，子对象绕父对象旋转</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B3%E7%A7%BB"><span class="nav-number">7.2.</span> <span class="nav-text">平移</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#translateX-translateY-translateZ"><span class="nav-number">7.2.1.</span> <span class="nav-text">translateX ,translateY, translateZ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#translateOnAxis-%E6%B2%BF%E7%9D%80%E7%9D%80%E6%8C%87%E5%AE%9A%E7%9A%84%E5%90%91%E9%87%8F%E6%96%B9%E5%90%91%E5%B9%B3%E7%A7%BB%E4%B8%80%E5%AE%9A%E7%9A%84%E8%B7%9D%E7%A6%BB"><span class="nav-number">7.2.2.</span> <span class="nav-text">translateOnAxis 沿着着指定的向量方向平移一定的距离</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%A9%E6%94%BE"><span class="nav-number">7.3.</span> <span class="nav-text">缩放</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E5%87%A0%E4%BD%95%E4%B8%AD%E5%BF%83"><span class="nav-number">8.</span> <span class="nav-text">设置几何体的几何中心</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84"><span class="nav-number">9.</span> <span class="nav-text">几何体的层次结构</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E5%B9%B3%E9%9D%A2%E5%9B%BE%E5%BD%A2"><span class="nav-number">10.</span> <span class="nav-text">绘制平面图形</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%B4%E7%BA%BF"><span class="nav-number">10.1.</span> <span class="nav-text">直线</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%86%E5%BC%A7"><span class="nav-number">10.2.</span> <span class="nav-text">圆弧</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A4%AD%E5%9C%86"><span class="nav-number">10.3.</span> <span class="nav-text">椭圆</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B7%E6%9D%A1%E6%9B%B2%E7%BA%BF"><span class="nav-number">10.4.</span> <span class="nav-text">样条曲线</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF"><span class="nav-number">10.5.</span> <span class="nav-text">贝塞尔曲线</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E7%BA%BF%E6%9D%A1%E7%BB%84%E5%90%88%E6%9B%B2%E7%BA%BFCurvePath"><span class="nav-number">10.6.</span> <span class="nav-text">多个线条组合曲线CurvePath</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#path"><span class="nav-number">10.7.</span> <span class="nav-text">path</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#shape"><span class="nav-number">10.8.</span> <span class="nav-text">shape</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E7%BA%BF%E6%9D%A1%E7%9A%84%E7%BB%84%E5%90%88"><span class="nav-number">10.8.1.</span> <span class="nav-text">多个线条的组合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E7%82%B9%E7%9A%84%E7%BB%84%E5%90%88"><span class="nav-number">10.8.2.</span> <span class="nav-text">多个点的组合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E5%BD%A2%E7%8A%B6%E5%86%85%E9%83%A8%E6%8C%96%E5%AD%94"><span class="nav-number">10.8.3.</span> <span class="nav-text">在形状内部挖孔</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AAshape-%E7%9A%84%E7%BB%84%E5%90%88"><span class="nav-number">10.8.4.</span> <span class="nav-text">多个shape 的组合</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E4%B8%89%E7%BB%B4%E5%9B%BE%E5%BD%A2"><span class="nav-number">11.</span> <span class="nav-text">绘制三维图形</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#tube"><span class="nav-number">11.1.</span> <span class="nav-text">tube</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%8B%E8%BD%AC-Lathe"><span class="nav-number">11.2.</span> <span class="nav-text">旋转 Lathe</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%89%E4%BC%B8%EF%BC%8C%E6%89%AB%E6%8F%8F%E6%88%90%E5%9E%8B-ExtrudeGeometry"><span class="nav-number">11.3.</span> <span class="nav-text">拉伸，扫描成型 ExtrudeGeometry</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%89%E4%BC%B8%E6%88%90%E5%9E%8B-%E6%98%AF%E7%9B%B4%E7%BA%BF%E6%8B%89%E4%BC%B8%EF%BC%8C%E6%8B%89%E4%BC%B8%E7%9A%84%E8%BD%A8%E8%BF%B9%E4%B8%8D%E8%83%BD%E8%87%AA%E5%AE%9A%E4%B9%89%EF%BC%8C%E5%8F%AA%E8%83%BD%E4%B9%8B%E5%AE%9A%E4%B9%89%E6%8B%89%E4%BC%B8%E7%9A%84%E8%B7%9D%E7%A6%BB"><span class="nav-number">11.3.1.</span> <span class="nav-text">拉伸成型 是直线拉伸，拉伸的轨迹不能自定义，只能之定义拉伸的距离</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%AB%E6%8F%8F%E6%88%90%E5%9E%8B%EF%BC%8C%E4%B8%8D%E8%83%BD%E5%AE%9A%E4%B9%89%E8%B7%9D%E7%A6%BB%EF%BC%8C%E4%BD%86%E6%98%AF%E8%A6%81%E6%8C%87%E5%AE%9A%E6%89%AB%E6%8F%8F%E7%9A%84%E8%BD%A8%E8%BF%B9"><span class="nav-number">11.3.2.</span> <span class="nav-text">扫描成型，不能定义距离，但是要指定扫描的轨迹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%98%E5%88%B63d%E6%96%87%E5%AD%97"><span class="nav-number">11.4.</span> <span class="nav-text">绘制3d文字</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BA%B9%E7%90%86%E8%B4%B4%E5%9B%BE"><span class="nav-number">12.</span> <span class="nav-text">纹理贴图</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%B9%E7%90%86%E8%B4%B4%E5%9B%BE%E8%A1%A8%E8%BE%BE%E7%9A%84%E6%98%AF%E5%9B%BE%E7%89%87%E5%92%8C%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E9%9D%A2%E5%9D%90%E6%A0%87%E4%B9%8B%E9%97%B4%E7%9A%84%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB"><span class="nav-number">12.1.</span> <span class="nav-text">纹理贴图表达的是图片和几何体的面坐标之间的映射关系</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A3%81%E5%89%AA%E5%9B%BE%E7%89%87%E4%B8%80%E5%8D%8A"><span class="nav-number">12.1.1.</span> <span class="nav-text">裁剪图片一半</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E8%A7%92%E9%9D%A2uv"><span class="nav-number">12.1.2.</span> <span class="nav-text">三角面uv</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A3%81%E5%89%AA%E5%90%8E%E7%9A%84%E9%9D%A2%E7%A7%AF%E5%87%8F%E5%B0%91%E4%BA%86%EF%BC%8C%E4%BD%86%E6%98%AF-uv-%E5%9D%90%E6%A0%87%E7%9A%84%E4%B8%AA%E6%95%B0%E4%B8%8D%E8%83%BD%E5%87%8F%E5%B0%91"><span class="nav-number">12.1.3.</span> <span class="nav-text">裁剪后的面积减少了，但是 uv 坐标的个数不能减少</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E7%BA%B9%E7%90%86%E8%B4%B4%E5%9B%BE"><span class="nav-number">12.1.4.</span> <span class="nav-text">自定义几何体的纹理贴图</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E6%9D%90%E8%B4%A8"><span class="nav-number">12.2.</span> <span class="nav-text">数组材质</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%B9%E7%90%86%E9%98%B5%E5%88%97"><span class="nav-number">12.3.</span> <span class="nav-text">纹理阵列</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%B9%E7%90%86%E5%81%8F%E7%A7%BB"><span class="nav-number">12.4.</span> <span class="nav-text">纹理偏移</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%B9%E7%90%86%E6%97%8B%E8%BD%AC"><span class="nav-number">12.5.</span> <span class="nav-text">纹理旋转</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#canvas-%E4%BD%9C%E4%B8%BA%E7%BA%B9%E7%90%86"><span class="nav-number">12.6.</span> <span class="nav-text">canvas 作为纹理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%86%E9%A2%91%E4%BD%9C%E4%B8%BA%E7%BA%B9%E7%90%86"><span class="nav-number">12.7.</span> <span class="nav-text">视频作为纹理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%B9%E5%87%B8%E8%B4%B4%E5%9B%BE-%E6%B3%95%E7%BA%BF%E8%B4%B4%E5%9B%BE"><span class="nav-number">12.8.</span> <span class="nav-text">凹凸贴图 ,法线贴图</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%A7%E5%8A%A8%E7%94%BB"><span class="nav-number">13.</span> <span class="nav-text">帧动画</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E7%BB%98%E6%A8%A1%E5%9E%8B%E5%8A%A8%E7%94%BB%E5%B8%A7"><span class="nav-number">13.1.</span> <span class="nav-text">自绘模型动画帧</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E6%A8%A1%E5%9E%8B%E5%8A%A8%E7%94%BB%E5%B8%A7"><span class="nav-number">13.2.</span> <span class="nav-text">外部模型动画帧</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%98%E5%BD%A2%E5%8A%A8%E7%94%BB"><span class="nav-number">14.</span> <span class="nav-text">变形动画</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E5%A4%96%E9%83%A8%E6%A8%A1%E5%9E%8B"><span class="nav-number">15.</span> <span class="nav-text">使用外部模型</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B2%BE%E7%81%B5%E6%A8%A1%E5%9E%8B%E5%92%8C%E7%B2%92%E5%AD%90%E7%B3%BB%E7%BB%9F"><span class="nav-number">16.</span> <span class="nav-text">精灵模型和粒子系统</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#dat-gui-%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">17.</span> <span class="nav-text">dat.gui 工具的使用</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Hank Bai"
      src="/images/rocket.png">
  <p class="site-author-name" itemprop="name">Hank Bai</p>
  <div class="site-description" itemprop="description">全栈工程师</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="/1410199713@qq.com" title="E-Mail → 1410199713@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/BAI-HANK" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;BAI-HANK" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.alloyteam.com/nav/" title="http:&#x2F;&#x2F;www.alloyteam.com&#x2F;nav&#x2F;" rel="noopener" target="_blank">Web前端导航</a>
        </li>
    </ul>
  </div>

        </div>
      </div>

      <div id="music163player" >
         <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=298 height=52 src="//music.163.com/outchain/player?type=2&id=5236281&auto=0&height=32">
         </iframe>
      </div><div>
  <br>
  <canvas id="canvasDiyBlock" style="width:60%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas><script src="/js/custom/clock.js"></script>
</div>
      
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/BAI-HANK" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://bh.com/2022/06/05/three/three_basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/rocket.png">
      <meta itemprop="name" content="Hank Bai">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hank Blog">
      <meta itemprop="description" content="全栈工程师">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="three.js 基础 | Hank Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          three.js 基础
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-06-05 10:03:00" itemprop="dateCreated datePublished" datetime="2022-06-05T10:03:00+08:00">2022-06-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-12-16 11:55:43" itemprop="dateModified" datetime="2022-12-16T11:55:43+08:00">2022-12-16</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/three-js/" itemprop="url" rel="index"><span itemprop="name">three.js</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>14 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Three-js-简介"><a href="#Three-js-简介" class="headerlink" title="Three.js 简介"></a>Three.js 简介</h1><p>随着 HTML5 标准的颁布，以及主流浏览器的功能日益强大，直接在浏览器中展示三维图像和动画已经变得越来越容易。WebGL 技术为在浏览器中创建丰富的三维图形提供了丰富且<br>强大的接口，它们不仅可以创建二维图形和应用，还可以充分利用 GPU，创建漂亮的、高性能的三维应用。但是直接使用 WebGL 编程非常复杂，需要了解 WebGL 的内部细节，学习<br>复杂的着色器语法和足够多的数学和图形学方面的专业知识才能学好 WebGL。<br>Three.js 就是一款基于原生 WebGL 封装运行在浏览器中的 3D 引擎，可以用它创建各种三维场景，包括了摄影机、光影、材质等各种对象。使用 Three.js 不必学习 WebGL 的<br>详细细节，就能轻松创建出漂亮的三维图形。</p>
<p><strong>Three.js  长短单位默认是米，时间是秒，除过相机的fov 是角度其余都是弧度</strong></p>
<span id="more"></span>

<h2 id="Scene"><a href="#Scene" class="headerlink" title="Scene"></a>Scene</h2><p>Scene 是场景对象，所有的网格对象、灯光、动画等都需要放在场景中，使用 new THREE.Scene 初始化场景，下面是场景的一些常用属性和方法。</p>
<ol>
<li>fog：设置场景的雾化效果,可以渲染出一层雾气，隐层远处的的物体。<br>Fog(color, near, far)<br>color: 表示雾的颜色，如设置为白色，场景中远处物体为蓝色，场景中最近处距离物体是自身颜色，最远和最近之间的物体颜色是物体本身颜色和雾颜色的混合效果。<br>near：表示应用雾化效果的最小距离，距离活动摄像机长度小于 near 的物体将不会被雾所影响。<br>far：表示应用雾化效果的最大距离，距离活动摄像机长度大于 far 的物体将不会被雾所影响。</li>
<li>overrideMaterial：强制场景中所有物体使用相同材质。</li>
<li>autoUpdate：设置是否自动更新。</li>
<li>background：设置场景背景，默认为黑色。</li>
<li>children：所有对象的列表。</li>
<li>add()：向场景中添加对象。</li>
<li>remove()：从场景中移除对象。</li>
<li>getChildByName()：根据名字直接返回这个对象。</li>
<li> traverse()：传入一个回调函数访问所有的对象。</li>
</ol>
<h1 id="在-react-里-使用-THREE"><a href="#在-react-里-使用-THREE" class="headerlink" title="在 react 里 使用 THREE"></a>在 react 里 使用 THREE</h1><p>利用React Hooks 封装 THREE,方便使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; useCallback, useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="comment">// 0.144 版没有默认导出，需要什么导出什么</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> <span class="variable constant_">THREE</span> <span class="keyword">from</span> <span class="string">&quot;three&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">OrbitControls</span> &#125; <span class="keyword">from</span> <span class="string">&quot;three/examples/jsm/controls/OrbitControls&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Stats</span> <span class="keyword">from</span> <span class="string">&quot;stats.js&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="variable constant_">GUI</span> &#125; <span class="keyword">from</span> <span class="string">&quot;dat.gui&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 非常重要  需要通过gui控制必须要给 mesh 或 group 设置 name 属性, 并且 key 里要包含 name 属性</span></span><br><span class="line"><span class="comment"> * key 可以是 ‘,’ 逗号分隔的对象 第一个是父对象的名称,第二个是子对象名称或属性名  */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> guiChangePropertyType = &#123; [<span class="attr">key</span>: <span class="built_in">string</span>]: &#123; <span class="attr">name</span>: <span class="built_in">string</span>; min?: <span class="built_in">number</span>; max?: <span class="built_in">number</span>; step?: <span class="built_in">number</span> &#125; | &#123; <span class="attr">name</span>: <span class="built_in">string</span>; min?: <span class="built_in">number</span>; max?: <span class="built_in">number</span>; step?: <span class="built_in">number</span> &#125;[] &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//自定义hooks</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">useTHREE</span>(<span class="params">props: &#123;</span></span><br><span class="line"><span class="params">  //画布的父容器</span></span><br><span class="line"><span class="params">  placeRenderingRef: React.RefObject&lt;HTMLElement&gt;;</span></span><br><span class="line"><span class="params">  //是否使用辅助轴</span></span><br><span class="line"><span class="params">  isUseAxes?: <span class="built_in">boolean</span>;</span></span><br><span class="line"><span class="params">  //是否使用相机轨道控制器</span></span><br><span class="line"><span class="params">  isUseOrbitControls?: <span class="built_in">boolean</span>;</span></span><br><span class="line"><span class="params">  //是否使用性能监控</span></span><br><span class="line"><span class="params">  isUsePerformanceMonitor?: <span class="built_in">boolean</span>;</span></span><br><span class="line"><span class="params">  //是否使用辅助相机</span></span><br><span class="line"><span class="params">  isUseAssistCamera?: <span class="built_in">boolean</span>;</span></span><br><span class="line"><span class="params">  /** dat.gui 工具可以改变的属性 */</span></span><br><span class="line"><span class="params">  guiChangePropertys?: guiChangePropertyType;</span></span><br><span class="line"><span class="params">  /** 点击画布的元素拾取 mesh */</span></span><br><span class="line"><span class="params">  clickHandle?: (clickMesh: (THREE.Mesh | THREE.Group)[]) =&gt; <span class="built_in">void</span>;</span></span><br><span class="line"><span class="params">  /**相机轨道控制器变化了 */</span></span><br><span class="line"><span class="params">  orbitControlsChange?: () =&gt; <span class="built_in">void</span>;</span></span><br><span class="line"><span class="params">&#125;</span>) &#123;</span><br><span class="line">  <span class="comment">//渲染器</span></span><br><span class="line">  <span class="keyword">const</span> renderer = useRef&lt;<span class="variable constant_">THREE</span>.<span class="property">WebGLRenderer</span>&gt;();</span><br><span class="line">  <span class="comment">//场景</span></span><br><span class="line">  <span class="keyword">const</span> scene = useRef&lt;<span class="variable constant_">THREE</span>.<span class="property">Scene</span>&gt;();</span><br><span class="line">  <span class="comment">//相机</span></span><br><span class="line">  <span class="keyword">const</span> camera = useRef&lt;<span class="variable constant_">THREE</span>.<span class="property">Camera</span>&gt;();</span><br><span class="line">  <span class="comment">//辅助相机</span></span><br><span class="line">  <span class="keyword">const</span> assistCamera = useRef&lt;<span class="variable constant_">THREE</span>.<span class="property">Camera</span>&gt;();</span><br><span class="line">  <span class="comment">//辅助轴</span></span><br><span class="line">  <span class="keyword">const</span> axesHelper = useRef&lt;<span class="variable constant_">THREE</span>.<span class="property">AxesHelper</span>&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//THREE 提供的对象可以计算俩次渲染的时间差</span></span><br><span class="line">  <span class="keyword">const</span> clock = useRef&lt;<span class="variable constant_">THREE</span>.<span class="property">Clock</span>&gt;();</span><br><span class="line">  <span class="comment">//性能监视器</span></span><br><span class="line">  <span class="keyword">const</span> starts = useRef&lt;<span class="title class_">Stats</span>&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> orbitControls = useRef&lt;<span class="title class_">OrbitControls</span>&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//在页面加载的时候的初始动画</span></span><br><span class="line">  <span class="keyword">const</span> primaryAnimation = useRef&lt;<span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>&gt;&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="comment">//根据传入的 json 配置 dat.ui 界面</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!props.<span class="property">guiChangePropertys</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">func</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> gui = <span class="keyword">new</span> <span class="title function_">GUI</span>(&#123; <span class="attr">closed</span>: <span class="literal">false</span> &#125;);</span><br><span class="line">      <span class="keyword">const</span> allPropertysArr = _.<span class="title function_">keys</span>(props.<span class="property">guiChangePropertys</span>);</span><br><span class="line"></span><br><span class="line">      allPropertysArr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> objs = p.<span class="title function_">split</span>(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="comment">//获取mesh 对象</span></span><br><span class="line">        <span class="comment">// eslint-disable-next-line @typescript-eslint/no-unused-vars</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//嵌套获取对象</span></span><br><span class="line">        <span class="keyword">let</span> <span class="attr">object3D</span>: <span class="variable constant_">THREE</span>.<span class="property">Object3D</span> | <span class="literal">null</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        objs.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p, index</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            object3D = index === <span class="number">0</span> ? (scene.<span class="property">current</span>?.<span class="title function_">getObjectByName</span>(p) <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Object3D</span>) : _.<span class="title function_">has</span>(object3D, p) ? _.<span class="title function_">get</span>(object3D, p) : (object3D?.<span class="title function_">getObjectByName</span>(p) <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Object3D</span>);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!object3D) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果是数组说明是一个属性有多个子属性</span></span><br><span class="line">        <span class="keyword">if</span> (props.<span class="property">guiChangePropertys</span> &amp;&amp; _.<span class="title function_">isArray</span>(props.<span class="property">guiChangePropertys</span>[p])) &#123;</span><br><span class="line">          <span class="keyword">const</span> folder = gui.<span class="title function_">addFolder</span>(p);</span><br><span class="line">          folder.<span class="title function_">open</span>();</span><br><span class="line">          <span class="keyword">const</span> obj = props.<span class="property">guiChangePropertys</span>[p] <span class="keyword">as</span> &#123; <span class="attr">name</span>: <span class="built_in">string</span>; min?: <span class="built_in">number</span>; max?: <span class="built_in">number</span>; step?: <span class="built_in">number</span> &#125;[];</span><br><span class="line">          <span class="comment">//展开子属性</span></span><br><span class="line">          obj.<span class="title function_">forEach</span>(<span class="function">(<span class="params">q</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (q.<span class="property">name</span> === <span class="string">&quot;color&quot;</span>) &#123;</span><br><span class="line">              folder.<span class="title function_">addColor</span>(object3D <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Object3D</span>, q.<span class="property">name</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              <span class="keyword">if</span> (_.<span class="title function_">isFunction</span>(_.<span class="title function_">get</span>(object3D, q.<span class="property">name</span>))) &#123;</span><br><span class="line">                <span class="keyword">const</span> bindParameter = &#123;</span><br><span class="line">                  [q.<span class="property">name</span>]: <span class="number">0</span>,</span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="keyword">const</span> tmp = folder.<span class="title function_">add</span>(bindParameter, q.<span class="property">name</span>, q.<span class="property">min</span>, q.<span class="property">max</span>, q.<span class="property">step</span>).<span class="title function_">listen</span>();</span><br><span class="line">                tmp.<span class="title function_">onFinishChange</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">                  <span class="keyword">const</span> tmp = _.<span class="title function_">get</span>(object3D, q.<span class="property">name</span>) <span class="keyword">as</span> <span class="title class_">Function</span>;</span><br><span class="line">                  tmp.<span class="title function_">call</span>(object3D, value);</span><br><span class="line">                &#125;);</span><br><span class="line">              &#125; <span class="keyword">else</span> folder.<span class="title function_">add</span>(object3D <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Object3D</span>, q.<span class="property">name</span>, q.<span class="property">min</span>, q.<span class="property">max</span>, q.<span class="property">step</span>).<span class="title function_">listen</span>();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">          <span class="comment">// 不是数组</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> obj = props.<span class="property">guiChangePropertys</span> &amp;&amp; (props.<span class="property">guiChangePropertys</span>[p] <span class="keyword">as</span> &#123; <span class="attr">name</span>: <span class="built_in">string</span>; min?: <span class="built_in">number</span>; max?: <span class="built_in">number</span>; step?: <span class="built_in">number</span> &#125;);</span><br><span class="line">          <span class="keyword">if</span> (!obj) <span class="keyword">return</span>;</span><br><span class="line">          <span class="keyword">if</span> (obj.<span class="property">name</span> === <span class="string">&quot;color&quot;</span>) &#123;</span><br><span class="line">            gui.<span class="title function_">addColor</span>(object3D <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Object3D</span>, obj.<span class="property">name</span>);</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (_.<span class="title function_">isFunction</span>(_.<span class="title function_">get</span>(object3D, obj.<span class="property">name</span>))) &#123;</span><br><span class="line">              <span class="keyword">const</span> bindParameter = &#123;</span><br><span class="line">                [obj.<span class="property">name</span>]: <span class="number">0</span>,</span><br><span class="line">              &#125;;</span><br><span class="line">              <span class="keyword">const</span> tmp = gui.<span class="title function_">add</span>(bindParameter, obj.<span class="property">name</span>, obj.<span class="property">min</span>, obj.<span class="property">max</span>, obj.<span class="property">step</span>).<span class="title function_">listen</span>();</span><br><span class="line">              tmp.<span class="title function_">onFinishChange</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> tmp = _.<span class="title function_">get</span>(object3D, obj.<span class="property">name</span>) <span class="keyword">as</span> <span class="title class_">Function</span>;</span><br><span class="line">                tmp.<span class="title function_">call</span>(object3D, value);</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125; <span class="keyword">else</span> gui.<span class="title function_">add</span>(object3D <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Object3D</span>, obj.<span class="property">name</span>, obj.<span class="property">min</span>, obj.<span class="property">max</span>, obj.<span class="property">step</span>).<span class="title function_">listen</span>();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">onload</span> = func;</span><br><span class="line">  &#125;, [props.<span class="property">guiChangePropertys</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    clock.<span class="property">current</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Clock</span>();</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//初始化性能监视器</span></span><br><span class="line">  <span class="keyword">const</span> initStarts = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">placeRenderingRef: React.RefObject&lt;HTMLElement&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> tmp = <span class="keyword">new</span> <span class="title class_">Stats</span>();</span><br><span class="line">    <span class="comment">//默认显示的界面，点击的时候可以切换</span></span><br><span class="line">    tmp.<span class="title function_">showPanel</span>(<span class="number">0</span>); <span class="comment">// 0: fps, 1: ms, 2: mb, 3+: custom</span></span><br><span class="line">    <span class="comment">// 将stats的界面对应左上角</span></span><br><span class="line">    tmp.<span class="property">dom</span>.<span class="property">style</span>.<span class="property">position</span> = <span class="string">&quot;absolute&quot;</span>;</span><br><span class="line">    tmp.<span class="property">dom</span>.<span class="property">style</span>.<span class="property">left</span> = <span class="string">&quot;0px&quot;</span>;</span><br><span class="line">    tmp.<span class="property">dom</span>.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&quot;0px&quot;</span>;</span><br><span class="line">    placeRenderingRef.<span class="property">current</span> &amp;&amp; (placeRenderingRef.<span class="property">current</span> <span class="keyword">as</span> <span class="title class_">HTMLElement</span>).<span class="title function_">appendChild</span>(tmp.<span class="property">dom</span>);</span><br><span class="line">    starts.<span class="property">current</span> = tmp;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//配置相机</span></span><br><span class="line">  <span class="keyword">const</span> configCamera = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">fov: <span class="built_in">number</span>, cameraPosition: THREE.Vector3, cameraLookAt: THREE.Vector3</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (camera.<span class="property">current</span> <span class="keyword">instanceof</span> <span class="variable constant_">THREE</span>.<span class="property">PerspectiveCamera</span>) &#123;</span><br><span class="line">      (camera.<span class="property">current</span> <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">PerspectiveCamera</span>).<span class="property">fov</span> = fov;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//相机的位置</span></span><br><span class="line">    camera.<span class="property">current</span>?.<span class="property">position</span>.<span class="title function_">set</span>(cameraPosition.<span class="property">x</span>, cameraPosition.<span class="property">y</span>, cameraPosition.<span class="property">z</span>);</span><br><span class="line">    <span class="comment">//相机看向的位置</span></span><br><span class="line">    camera.<span class="property">current</span>?.<span class="title function_">lookAt</span>(cameraLookAt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果有辅助相机，一并更新</span></span><br><span class="line">    <span class="keyword">if</span> (assistCamera.<span class="property">current</span> <span class="keyword">instanceof</span> <span class="variable constant_">THREE</span>.<span class="property">PerspectiveCamera</span>) &#123;</span><br><span class="line">      (assistCamera.<span class="property">current</span> <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">PerspectiveCamera</span>).<span class="property">fov</span> = fov;</span><br><span class="line">    &#125;</span><br><span class="line">    assistCamera.<span class="property">current</span>?.<span class="property">position</span>.<span class="title function_">set</span>(cameraPosition.<span class="property">x</span>, cameraPosition.<span class="property">y</span>, cameraPosition.<span class="property">z</span>);</span><br><span class="line">    assistCamera.<span class="property">current</span>?.<span class="title function_">lookAt</span>(cameraLookAt);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//增加几何体</span></span><br><span class="line">  <span class="keyword">const</span> addObjectToScene = <span class="title function_">useCallback</span>(</span><br><span class="line">    <span class="function">(<span class="params">mesh: THREE.Object3D[]</span>) =&gt;</span></span><br><span class="line">      mesh.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">        scene.<span class="property">current</span> &amp;&amp; scene.<span class="property">current</span>.<span class="title function_">add</span>(p);</span><br><span class="line">      &#125;),</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line">  <span class="comment">//增加各种光源</span></span><br><span class="line">  <span class="keyword">const</span> addLightsToScene = <span class="title function_">useCallback</span>(</span><br><span class="line">    <span class="function">(<span class="params">lights: THREE.Light[]</span>) =&gt;</span></span><br><span class="line">      lights.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (p <span class="keyword">instanceof</span> <span class="variable constant_">THREE</span>.<span class="property">AmbientLight</span>) &#123;</span><br><span class="line">          <span class="comment">//环境光不能有俩个</span></span><br><span class="line">          <span class="keyword">const</span> tmp1 = scene.<span class="property">current</span>?.<span class="property">children</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">q</span>) =&gt;</span> q <span class="keyword">instanceof</span> <span class="variable constant_">THREE</span>.<span class="property">AmbientLight</span>);</span><br><span class="line">          !tmp1 &amp;&amp; scene.<span class="property">current</span> &amp;&amp; scene.<span class="property">current</span>.<span class="title function_">add</span>(p);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">//相同位置不能添加俩次</span></span><br><span class="line">          <span class="keyword">const</span> tmp2 = scene.<span class="property">current</span>?.<span class="property">children</span>.<span class="title function_">find</span>(<span class="function">(<span class="params">q</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> _.<span class="title function_">isEqual</span>(p.<span class="property">position</span>, q.<span class="property">position</span>);</span><br><span class="line">          &#125;);</span><br><span class="line">          !tmp2 &amp;&amp; scene.<span class="property">current</span> &amp;&amp; scene.<span class="property">current</span>.<span class="title function_">add</span>(p);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;),</span><br><span class="line">    []</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">//设置初始动画</span></span><br><span class="line">  <span class="keyword">const</span> configPrimaryAnimation = <span class="title function_">useCallback</span>(<span class="function">(<span class="params">animation: <span class="built_in">Map</span>&lt;<span class="built_in">string</span>, <span class="built_in">Function</span>&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    primaryAnimation.<span class="property">current</span> = animation;</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//执行渲染</span></span><br><span class="line">  <span class="keyword">const</span> render = <span class="title function_">useCallback</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//clear 的效果还不知道</span></span><br><span class="line">    <span class="comment">// renderer.current &amp;&amp; renderer.current?.clear();</span></span><br><span class="line">    primaryAnimation.<span class="property">current</span> &amp;&amp;</span><br><span class="line">      primaryAnimation.<span class="property">current</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">        p &amp;&amp; <span class="title function_">p</span>();</span><br><span class="line">      &#125;);</span><br><span class="line">    <span class="comment">// 以每秒60次的频率来绘制场景。requestAnimationFrame这个函数，它用来替代 setInterval，</span></span><br><span class="line">    <span class="comment">//这个新接口具备多个优点，比如浏览器Tab切换后停止渲染以节约资源、和屏幕刷新同步避免无效刷新、</span></span><br><span class="line">    <span class="comment">//在不支持该接口的浏览器中能安全回退为setInterval。</span></span><br><span class="line">    scene.<span class="property">current</span> &amp;&amp; camera.<span class="property">current</span> &amp;&amp; renderer.<span class="property">current</span> &amp;&amp; renderer.<span class="property">current</span>?.<span class="title function_">render</span>(scene.<span class="property">current</span>, camera.<span class="property">current</span>);</span><br><span class="line">    starts.<span class="property">current</span>?.<span class="title function_">update</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">requestAnimationFrame</span>(render);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//页面加载的时候生成渲染器</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 需要控制相机的宽高比和屏幕的保持一致，near 尽可能小 far 尽可能大，方便进行缩放，这里的值没有单位是相对的</span></span><br><span class="line">    <span class="comment">// 场景渲染用透视相机，符合人眼的近大远小</span></span><br><span class="line">    !camera.<span class="property">current</span> &amp;&amp; (camera.<span class="property">current</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">60</span>, <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>, <span class="number">1</span>, <span class="number">10000</span>));</span><br><span class="line">    !scene.<span class="property">current</span> &amp;&amp; (scene.<span class="property">current</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Scene</span>());</span><br><span class="line">    !renderer.<span class="property">current</span> &amp;&amp;</span><br><span class="line">      (renderer.<span class="property">current</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">WebGLRenderer</span>(&#123;</span><br><span class="line">        <span class="comment">//抗锯齿</span></span><br><span class="line">        <span class="attr">antialias</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;));</span><br><span class="line">    <span class="comment">//设置场景的颜色</span></span><br><span class="line">    renderer.<span class="property">current</span> &amp;&amp; renderer.<span class="property">current</span>.<span class="title function_">setClearColor</span>(<span class="string">&quot;white&quot;</span>);</span><br><span class="line">    renderer.<span class="property">current</span> &amp;&amp; (renderer.<span class="property">current</span>.<span class="property">pixelRatio</span> = <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>);</span><br><span class="line">    <span class="comment">//设置平面网格</span></span><br><span class="line">    <span class="keyword">const</span> gridHelper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">GridHelper</span>(<span class="number">80</span>, <span class="number">30</span>, <span class="number">0x888888</span>, <span class="number">0x888888</span>);</span><br><span class="line">    gridHelper.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">    scene.<span class="property">current</span>.<span class="title function_">add</span>(gridHelper);</span><br><span class="line">  &#125;, []);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//点击获取几何体</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">onDocumentMouseDown</span>(<span class="params">event: &#123; clientX: <span class="built_in">number</span>; clientY: <span class="built_in">number</span> &#125;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!camera.<span class="property">current</span> || !props.<span class="property">placeRenderingRef</span>.<span class="property">current</span> || !scene.<span class="property">current</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//鼠标是二维向量</span></span><br><span class="line">      <span class="keyword">let</span> mouse = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>();</span><br><span class="line">      <span class="comment">//射线是相机到鼠标点击位置之间的一条线</span></span><br><span class="line">      <span class="keyword">let</span> ray = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Raycaster</span>();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> px = props.<span class="property">placeRenderingRef</span>.<span class="property">current</span>.<span class="title function_">getBoundingClientRect</span>().<span class="property">left</span>;</span><br><span class="line">      <span class="keyword">const</span> py = props.<span class="property">placeRenderingRef</span>.<span class="property">current</span>.<span class="title function_">getBoundingClientRect</span>().<span class="property">top</span>;</span><br><span class="line">      <span class="comment">//鼠标点位的坐标转换为3D 坐标</span></span><br><span class="line">      <span class="comment">//通过鼠标点击位置,计算出 raycaster 所需点的位置,映射到，以画布为中心点,范围 -1 到 1的位置去</span></span><br><span class="line">      <span class="comment">//以下的公式是等比列函数换算的</span></span><br><span class="line">      mouse.<span class="property">x</span> = ((event.<span class="property">clientX</span> - px) / props.<span class="property">placeRenderingRef</span>.<span class="property">current</span>.<span class="property">offsetWidth</span>) * <span class="number">2</span> - <span class="number">1</span>;</span><br><span class="line">      mouse.<span class="property">y</span> = -((event.<span class="property">clientY</span> - py) / props.<span class="property">placeRenderingRef</span>.<span class="property">current</span>.<span class="property">offsetHeight</span>) * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//通过鼠标点击的位置和当前相机的矩阵计算出射线位置</span></span><br><span class="line">      ray.<span class="title function_">setFromCamera</span>(mouse, camera.<span class="property">current</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// intersectObjects 第一个参数是一个数组 传 场景(scence)的各个对象 第二个参数 是否检查后代对象</span></span><br><span class="line">      <span class="comment">// 有些模型是是在group 组里,需要检查后代对象</span></span><br><span class="line">      <span class="keyword">const</span> intersects = _.<span class="title function_">unionBy</span>(ray.<span class="title function_">intersectObjects</span>([...scene.<span class="property">current</span>.<span class="property">children</span>.<span class="title function_">filter</span>(<span class="function">(<span class="params">p</span>) =&gt;</span> p.<span class="property">type</span> === <span class="string">&quot;Mesh&quot;</span> || p.<span class="property">type</span> === <span class="string">&quot;Group&quot;</span>)], <span class="literal">true</span>), <span class="string">&quot;uuid&quot;</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/*鼠标点和相机之间射线上的所有对象</span></span><br><span class="line"><span class="comment">      这将返回一个 Array，其中包含与cubes的孩子的所有光线交点，按距离排序（最近的对象排在第一位）。每个交集都是一个具有以下属性的对象：</span></span><br><span class="line"><span class="comment">      距离：相交发生的距离相机多远</span></span><br><span class="line"><span class="comment">      点：光线与其相交的对象中的确切点</span></span><br><span class="line"><span class="comment">      面：相交的面。</span></span><br><span class="line"><span class="comment">      对象：与哪个对象相交 */</span></span><br><span class="line">      <span class="keyword">if</span> (intersects.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> meshs = intersects.<span class="title function_">filter</span>(<span class="function">(<span class="params">q</span>) =&gt;</span> q.<span class="property">object</span>.<span class="property">type</span> === <span class="string">&quot;Mesh&quot;</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">q</span>) =&gt;</span> q.<span class="property">object</span> <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Mesh</span>);</span><br><span class="line">        <span class="keyword">const</span> groups = intersects.<span class="title function_">filter</span>(<span class="function">(<span class="params">q</span>) =&gt;</span> q.<span class="property">object</span>.<span class="property">type</span> === <span class="string">&quot;Group&quot;</span>).<span class="title function_">map</span>(<span class="function">(<span class="params">q</span>) =&gt;</span> q.<span class="property">object</span> <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Group</span>);</span><br><span class="line">        props.<span class="property">clickHandle</span> &amp;&amp; props.<span class="title function_">clickHandle</span>([...meshs, ...groups]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (props.<span class="property">placeRenderingRef</span>.<span class="property">current</span> &amp;&amp; !props.<span class="property">placeRenderingRef</span>.<span class="property">current</span>.<span class="property">onclick</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> ref = props.<span class="property">placeRenderingRef</span>.<span class="property">current</span>;</span><br><span class="line">      ref.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, onDocumentMouseDown);</span><br><span class="line">      <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        ref.<span class="title function_">removeEventListener</span>(<span class="string">&quot;click&quot;</span>, onDocumentMouseDown);</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [props, props.<span class="property">clickHandle</span>, props.<span class="property">placeRenderingRef</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//容器大小变化后，刷新画布</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">func</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">const</span> ele = props.<span class="property">placeRenderingRef</span>.<span class="property">current</span> <span class="keyword">as</span> <span class="title class_">HTMLElement</span>;</span><br><span class="line">      <span class="comment">//尺寸变化了，必须要更新相机</span></span><br><span class="line">      camera.<span class="property">current</span> &amp;&amp; ((camera.<span class="property">current</span> <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">PerspectiveCamera</span>).<span class="property">aspect</span> = <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>);</span><br><span class="line">      camera.<span class="property">current</span> &amp;&amp; (camera.<span class="property">current</span> <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">PerspectiveCamera</span>).<span class="title function_">updateProjectionMatrix</span>();</span><br><span class="line">      renderer.<span class="property">current</span> &amp;&amp; (renderer.<span class="property">current</span>.<span class="property">pixelRatio</span> = <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>);</span><br><span class="line">      renderer.<span class="property">current</span> &amp;&amp; renderer.<span class="property">current</span>.<span class="title function_">setSize</span>(ele.<span class="property">clientWidth</span>, ele.<span class="property">clientHeight</span>);</span><br><span class="line">      <span class="comment">//窗口大小变化后立马刷新下</span></span><br><span class="line">      renderer.<span class="property">current</span> &amp;&amp; scene.<span class="property">current</span> &amp;&amp; camera.<span class="property">current</span> &amp;&amp; renderer.<span class="property">current</span>.<span class="title function_">render</span>(scene.<span class="property">current</span>, camera.<span class="property">current</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;resize&quot;</span>, func);</span><br><span class="line">    <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;resize&quot;</span>, func);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;, [props.<span class="property">placeRenderingRef</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//配置辅助相机</span></span><br><span class="line">    <span class="keyword">if</span> (scene.<span class="property">current</span> &amp;&amp; props.<span class="property">isUseAssistCamera</span> &amp;&amp; !assistCamera.<span class="property">current</span>) &#123;</span><br><span class="line">      assistCamera.<span class="property">current</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PerspectiveCamera</span>(<span class="number">60</span>, <span class="variable language_">window</span>.<span class="property">innerWidth</span> / <span class="variable language_">window</span>.<span class="property">innerHeight</span>, <span class="number">1</span>, <span class="number">10000</span>);</span><br><span class="line">      scene.<span class="property">current</span>.<span class="title function_">add</span>(assistCamera.<span class="property">current</span>);</span><br><span class="line">      <span class="keyword">const</span> cameraHelper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CameraHelper</span>(assistCamera.<span class="property">current</span>);</span><br><span class="line">      scene.<span class="property">current</span>.<span class="title function_">add</span>(cameraHelper);</span><br><span class="line">      cameraHelper.<span class="title function_">update</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//显示辅助轴</span></span><br><span class="line">    <span class="keyword">if</span> (scene.<span class="property">current</span> &amp;&amp; props.<span class="property">isUseAxes</span> &amp;&amp; !axesHelper.<span class="property">current</span>) &#123;</span><br><span class="line">      axesHelper.<span class="property">current</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">800</span>);</span><br><span class="line">      scene.<span class="property">current</span>.<span class="title function_">add</span>(axesHelper.<span class="property">current</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//显示相机轨道控制器</span></span><br><span class="line">    <span class="keyword">if</span> (renderer.<span class="property">current</span> &amp;&amp; camera.<span class="property">current</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (orbitControls.<span class="property">current</span> &amp;&amp; props.<span class="property">isUseOrbitControls</span>) &#123;</span><br><span class="line">        orbitControls.<span class="property">current</span>.<span class="property">enabled</span> = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (orbitControls.<span class="property">current</span> &amp;&amp; !props.<span class="property">isUseOrbitControls</span>) &#123;</span><br><span class="line">        orbitControls.<span class="property">current</span>.<span class="property">enabled</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (!orbitControls.<span class="property">current</span> &amp;&amp; props.<span class="property">isUseOrbitControls</span>) &#123;</span><br><span class="line">        orbitControls.<span class="property">current</span> = <span class="keyword">new</span> <span class="title class_">OrbitControls</span>(camera.<span class="property">current</span>, renderer.<span class="property">current</span>.<span class="property">domElement</span>);</span><br><span class="line">        orbitControls.<span class="property">current</span>.<span class="property">enableDamping</span> = <span class="literal">true</span>;</span><br><span class="line">        orbitControls.<span class="property">current</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;change&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">          props.<span class="property">orbitControlsChange</span> &amp;&amp; props.<span class="title function_">orbitControlsChange</span>();</span><br><span class="line">          scene.<span class="property">current</span> &amp;&amp; camera.<span class="property">current</span> &amp;&amp; renderer.<span class="property">current</span> &amp;&amp; renderer.<span class="property">current</span>?.<span class="title function_">render</span>(scene.<span class="property">current</span>, camera.<span class="property">current</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [props, props.<span class="property">isUseAssistCamera</span>, props.<span class="property">isUseAxes</span>, props.<span class="property">isUseOrbitControls</span>, render]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//渲染到dom</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (renderer.<span class="property">current</span> &amp;&amp; props.<span class="property">placeRenderingRef</span>.<span class="property">current</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> ((props.<span class="property">placeRenderingRef</span>.<span class="property">current</span> <span class="keyword">as</span> <span class="title class_">HTMLElement</span>).<span class="property">childElementCount</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> ele = props.<span class="property">placeRenderingRef</span>.<span class="property">current</span> <span class="keyword">as</span> <span class="title class_">HTMLElement</span>;</span><br><span class="line">        <span class="comment">//设置画布初始大小和容器一样大</span></span><br><span class="line">        renderer.<span class="property">current</span>.<span class="title function_">setSize</span>(ele.<span class="property">clientWidth</span>, ele.<span class="property">clientHeight</span>);</span><br><span class="line">        ele.<span class="title function_">appendChild</span>(renderer.<span class="property">current</span>.<span class="property">domElement</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      !starts.<span class="property">current</span> &amp;&amp; props.<span class="property">isUsePerformanceMonitor</span> &amp;&amp; <span class="title function_">initStarts</span>(props.<span class="property">placeRenderingRef</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [initStarts, props.<span class="property">isUsePerformanceMonitor</span>, props.<span class="property">placeRenderingRef</span>]);</span><br><span class="line">  <span class="comment">//返回</span></span><br><span class="line">  <span class="keyword">return</span> &#123; configCamera, configPrimaryAnimation, addObjectToScene, addLightsToScene, camera, render, clock &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> useTHREE;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="使用自定义-hooks"><a href="#使用自定义-hooks" class="headerlink" title="使用自定义 hooks"></a>使用自定义 hooks</h1><p>自定义的 useTHREE(mainCanvas, true, true, true) hooks</p>
<p>需要注的是需要去除 react 的 &lt;React.StrictMode&gt; ,此标记是 react 用来做 hooks 副作用的并发测试，总是会重复执行 hooks 一次</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123; useEffect, useRef &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> *  <span class="keyword">as</span> <span class="variable constant_">THREE</span> <span class="keyword">from</span> <span class="string">&quot;three&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MathUtils</span>, <span class="title class_">Vector3</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> useTHREE <span class="keyword">from</span> <span class="string">&#x27;./myHooks&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// dat.gui 更改的属性,函数也可以改变 mesh1 是名字</span></span><br><span class="line"><span class="comment">// 提供此对象，能方便的可需要更改属性的几何体进行解耦</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">changePropertys</span>: guiChangePropertyType = &#123;</span><br><span class="line">  <span class="comment">//这种会分组</span></span><br><span class="line">  <span class="string">&#x27;mesh1,position&#x27;</span>: [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;x&#x27;</span>, <span class="attr">min</span>: -<span class="number">10</span>, <span class="attr">max</span>: <span class="number">10</span>, <span class="attr">step</span>: <span class="number">.01</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;y&#x27;</span>, <span class="attr">min</span>: -<span class="number">10</span>, <span class="attr">max</span>: <span class="number">10</span>, <span class="attr">step</span>: <span class="number">.01</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;z&#x27;</span>, <span class="attr">min</span>: -<span class="number">10</span>, <span class="attr">max</span>: <span class="number">10</span>, <span class="attr">step</span>: <span class="number">.01</span> &#125;],</span><br><span class="line"></span><br><span class="line">  <span class="string">&#x27;mesh1,scale&#x27;</span>: [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;x&#x27;</span>, <span class="attr">step</span>: <span class="number">.01</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;y&#x27;</span>, <span class="attr">step</span>: <span class="number">.01</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;z&#x27;</span>, <span class="attr">step</span>: <span class="number">.01</span> &#125;],</span><br><span class="line"></span><br><span class="line">  <span class="string">&#x27;mesh1&#x27;</span>: [</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;rotateX&#x27;</span>, <span class="attr">min</span>: -<span class="title class_">Math</span>.<span class="property">PI</span>, <span class="attr">max</span>: <span class="title class_">Math</span>.<span class="property">PI</span>, <span class="attr">step</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;rotateY&#x27;</span>, <span class="attr">min</span>: -<span class="title class_">Math</span>.<span class="property">PI</span>, <span class="attr">max</span>: <span class="title class_">Math</span>.<span class="property">PI</span>, <span class="attr">step</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;rotateZ&#x27;</span>, <span class="attr">min</span>: -<span class="title class_">Math</span>.<span class="property">PI</span>, <span class="attr">max</span>: <span class="title class_">Math</span>.<span class="property">PI</span>, <span class="attr">step</span>: <span class="number">1</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;translateX&#x27;</span>, <span class="attr">min</span>: -<span class="number">10</span>, <span class="attr">max</span>: <span class="number">10</span>, <span class="attr">step</span>: <span class="number">0.1</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;translateY&#x27;</span>, <span class="attr">min</span>: -<span class="number">10</span>, <span class="attr">max</span>: <span class="number">10</span>, <span class="attr">step</span>: <span class="number">0.1</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;translateZ&#x27;</span>, <span class="attr">min</span>: -<span class="number">10</span>, <span class="attr">max</span>: <span class="number">10</span>, <span class="attr">step</span>: <span class="number">0.1</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;visible&#x27;</span>,  &#125;,</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">&#x27;mesh1,material&#x27;</span>:</span><br><span class="line">    &#123; <span class="attr">name</span>: <span class="string">&#x27;color&#x27;</span> &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">App</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> mainCanvas = <span class="title function_">useRef</span>(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//使用自定义 THREE hooks</span></span><br><span class="line">  <span class="keyword">const</span> &#123; configCamera, configPrimaryAnimation, addObjectToScene, addLightsToScene, camera, render, clock &#125; =</span><br><span class="line">    <span class="title function_">useTHREE</span>(&#123;</span><br><span class="line">      <span class="attr">placeRenderingRef</span>: mainCanvas,</span><br><span class="line">      <span class="attr">isUseAxes</span>:<span class="literal">true</span>, </span><br><span class="line">      <span class="attr">isUseOrbitControls</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">isUsePerformanceMonitor</span>:<span class="literal">true</span>,</span><br><span class="line">      <span class="attr">guiChangePropertys</span>: changePropertys,</span><br><span class="line">      <span class="comment">/** 点击画布的元素拾取 mesh,group */</span></span><br><span class="line">      <span class="attr">clickHandle</span>: (<span class="function"><span class="params">clickMesh</span> =&gt;</span> &#123;</span><br><span class="line">        clickMesh.<span class="title function_">forEach</span>(<span class="variable language_">console</span>.<span class="property">log</span>)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">orbitControlsChange</span>: <span class="function">() =&gt;</span> &#123;&#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//页面加载的时候配置初始的THREE</span></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//配置相机 相对单位</span></span><br><span class="line">    <span class="title function_">configCamera</span>(<span class="number">60</span>, <span class="keyword">new</span> <span class="title class_">Vector3</span>(<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>), <span class="keyword">new</span> <span class="title class_">Vector3</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">   </span><br><span class="line">    <span class="comment">//增加显示的几何体</span></span><br><span class="line">    <span class="keyword">const</span> box = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(</span><br><span class="line">      &#123; <span class="attr">color</span>: <span class="number">0x00ffff</span>, <span class="attr">transparent</span>: <span class="literal">true</span>, <span class="attr">opacity</span>: <span class="number">0.5</span>, <span class="attr">wireframe</span>: <span class="literal">false</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(box, material);</span><br><span class="line">    <span class="comment">//如果需要 dar.gui 控制属性必须设置 name</span></span><br><span class="line">    mesh.<span class="property">name</span>=<span class="string">&#x27;mesh1&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="title function_">addObjectToScene</span>([mesh]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置光照</span></span><br><span class="line">    <span class="comment">//0xffffff 白色</span></span><br><span class="line">    <span class="comment">/** 光线太亮的话，物体的棱角不会太明显   pointLight 光源的位置不对的话，棱角也不会明显  */</span></span><br><span class="line">    <span class="keyword">const</span> ambientLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AmbientLight</span>(<span class="string">&#x27;white&#x27;</span>, <span class="number">0.6</span>);</span><br><span class="line">    <span class="keyword">const</span> pointLight = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PointLight</span>(<span class="string">&#x27;white&#x27;</span>, <span class="number">0.1</span>)</span><br><span class="line">    pointLight.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">1</span>, <span class="number">20</span>, <span class="number">30</span>)</span><br><span class="line">    <span class="comment">// 只有环境光，没有点光或聚光的话，显示不出暗面，就不能突出棱角</span></span><br><span class="line">    <span class="title function_">addLightsToScene</span>([ambientLight, pointLight]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//配置初始动画</span></span><br><span class="line">    <span class="title function_">configPrimaryAnimation</span>(<span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>&gt;([[<span class="string">&quot;a1&quot;</span>, <span class="function">() =&gt;</span> mesh.<span class="title function_">rotateX</span>(<span class="title class_">MathUtils</span>.<span class="title function_">degToRad</span>(<span class="number">1</span>))]]))</span><br><span class="line"></span><br><span class="line">    <span class="comment">//改变相机，也可以做动画的效果</span></span><br><span class="line">    <span class="comment">//camera.current &amp;&amp; (camera.current.position.x+=0.01)</span></span><br><span class="line"></span><br><span class="line">  &#125;, [addLightsToScene, configPrimaryAnimation, configCamera, addObjectToScene])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">useEffect</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!mainCanvas.<span class="property">current</span>) <span class="keyword">return</span></span><br><span class="line">    <span class="title function_">render</span>();</span><br><span class="line">  &#125;, [render])</span><br><span class="line"></span><br><span class="line">  <span class="comment">//更新相机的 fov ,相机的距离并没有改变，但是物体的远近效果变了</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">changeFov</span>=(<span class="params">fov:<span class="built_in">number</span></span>)=&gt;&#123;</span><br><span class="line">    (camera.<span class="property">current</span> <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">PerspectiveCamera</span>).<span class="property">fov</span> = fov;</span><br><span class="line">    (camera.<span class="property">current</span> <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">PerspectiveCamera</span>)?.<span class="title function_">updateProjectionMatrix</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       &#123;/* 画布要设置大小 */&#125;</span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&#123;mainCanvas&#125;</span> <span class="attr">style</span>=<span class="string">&#123;&#123;width:</span>&#x27;<span class="attr">90rem</span>&#x27;,<span class="attr">height:</span>&#x27;<span class="attr">40rem</span>&#x27;,<span class="attr">border:</span>&#x27;<span class="attr">2px</span> <span class="attr">solid</span> <span class="attr">blue</span>&#x27;&#125;&#125;/&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">App</span>;</span><br></pre></td></tr></table></figure>

<h1 id="光源"><a href="#光源" class="headerlink" title="光源"></a>光源</h1><p>threejs 渲染的真实性和光源的使用有很大的关系，THREE.Light 光源的基类。<br>threejs 在光源上常见的种类：</p>
<blockquote>
<p>THREE.AmbientLight 环境光,处于多次漫反射的形成的光，这种光任何几何体的都能够照射到，没有方向性，所以不会产生阴影效果，光的强度在任何地方都一样的，不会衰减。<br>主要是均匀整体改变Threejs物体表面的明暗效果，这一点和具有方向的光源不同，比如点光源可以让物体表面不同区域明暗程度不同。</p>
</blockquote>
<blockquote>
<p>THREE.DirectionalLight 平行光(方向光) 可以看做是模拟太阳发出的光源，这个光源所发出的光都是相互平行的。光的强度在照射的范围内是一样的，不会产生阴影效果<br>平行光顾名思义光线平行，对于一个平面而言，平面不同区域接收到平行光的入射角一样。<br>点光源因为是向四周发散，所以设置好位置属性.position就可以确定光线和物体表面的夹角，对于平行光而言,主要是确定光线的方向,光线方向设定好了，光线的与物体表面入射角就确定了，<br>仅仅设置光线位置是不起作用的。<br>在三维空间中为了确定一条直线的方向只需要确定直线上两个点的坐标即可，所以Threejs平行光提供了位置.position和目标.target两个属性来一起确定平行光方向。目标.target的属性<br>值可以是Threejs场景中任何一个三维模型对象，比如一个网格模型Mesh，这样Threejs计算平行光照射方向的时候，会通过自身位置属性.position和.target表示的物体的位置属性.position计算出来。</p>
</blockquote>
<blockquote>
<p>THREE.SpotLight 聚灯光，类似于射灯，在照射的中心很亮，边缘区域很暗，有阴影效果<br>聚光源可以认为是一个沿着特定方会逐渐发散的光源，照射范围在三维空间中构成一个圆锥体。通过属性.angle可以设置聚光源发散角度，聚光源照射方向设置和平行光光源一样<br>是通过位置.position和目标.target两个属性来实现。  </p>
</blockquote>
<blockquote>
<p>THREE.PointLight 点光源就像生活中的白炽灯，光线沿着发光核心向外发散，同一平面的不同位置与点光源光线入射角是不同的，点光源照射下，同一个平面不同区域是呈现出不同的明暗效果。<br>和环境光不同，环境光不需要设置光源位置，而点光源需要设置位置属性.position，光源位置不同，物体表面被照亮的面不同，远近不同因为衰减明暗程度不同。</p>
</blockquote>
<p><strong>仅仅使用环境光的情况下，你会发现整个立方体没有任何棱角感，这是因为环境光只是设置整个空间的明暗效果。如果需要立方体渲染要想有立体效果，需要使用具有方向性的点光源、平行光源等。</strong></p>
<p>光线线是和几何体的法线和材质有关系</p>
<ul>
<li>MeshBasicMaterial 光线影响几何体的明暗，不会影响颜色的反射。这种材质不会反射光线</li>
<li>MeshLambertMaterial 材质的法线和颜色都会影响光线，这种材质会反射光线，环境光和法线没有关系，是整体的变亮或变暗，带有方向的光源受法线影响<br>如果光线是红色的,几何体是绿色，显示的效果是几何体是黑色的，因为几何体吸收的是除过绿色的其他光</li>
</ul>
<h1 id="点，线，三角面，几何体"><a href="#点，线，三角面，几何体" class="headerlink" title="点，线，三角面，几何体"></a>点，线，三角面，几何体</h1><p>THREE 所有的几何体都是通过 THREE.BufferAttribute THREE.BufferGeometry 俩个API 生成的<br>在 R125版本开始移除了THREE.Geometry,代码被移到 three/examples/jsm/deprecated/Geometry 里</p>
<h2 id="顶点位置数据渲染"><a href="#顶点位置数据渲染" class="headerlink" title="顶点位置数据渲染"></a>顶点位置数据渲染</h2><p>通过 THREE.BufferGeometry 可以够着自定义的图形</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> geo=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//有点可以组成线，线组成面。 THREE 的面是三角面，需要3个顶点</span></span><br><span class="line"><span class="keyword">const</span> arr =<span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">    <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>,</span><br><span class="line">    <span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">  </span><br><span class="line">    <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>,</span><br><span class="line">    <span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,</span><br><span class="line"></span><br><span class="line">    <span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>,</span><br><span class="line">    <span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">//缓存 3个一组</span></span><br><span class="line"><span class="keyword">const</span> points=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferAttribute</span>(arr,<span class="number">3</span>);</span><br><span class="line"><span class="comment">//给几何体增加点</span></span><br><span class="line">geo.<span class="title function_">setAttribute</span>(<span class="string">&#x27;position&#x27;</span>,points)</span><br><span class="line"><span class="comment">//自定义面测下只能用  MeshBasicMaterial 材质</span></span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(</span><br><span class="line">&#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>,<span class="attr">side</span>:<span class="title class_">DoubleSide</span>&#125;);</span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, material);</span><br><span class="line"><span class="title function_">addObjectToScene</span>([obj]);</span><br></pre></td></tr></table></figure>
<p><strong>如上代码绘制的3个三角面</strong><br><img src="/2022/06/05/three/three_basic/%E7%BB%98%E5%88%B6%E4%B8%89%E8%A7%92%E9%9D%A2.png" alt="绘制三角面"></p>
<p>渲染成点模型,修改材质</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> material=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PointsMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>:<span class="string">&#x27;red&#x27;</span> </span><br><span class="line">    <span class="attr">size</span>: <span class="number">0.5</span> <span class="comment">//点大小</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> obj=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Points</span>(geo,material)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([obj]);</span><br></pre></td></tr></table></figure>

<p><strong>如上代码绘制的9个点</strong><br><img src="/2022/06/05/three/three_basic/%E7%BB%98%E5%88%B6%E7%82%B9.png" alt="绘制三角面"></p>
<p>渲染成线模型,修改材质</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> material=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>:<span class="string">&#x27;red&#x27;</span> &#125;)<span class="comment">//线条颜色</span></span><br><span class="line"><span class="keyword">var</span> obj=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geo,material)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([obj]);</span><br></pre></td></tr></table></figure>
<p><strong>如上代码绘制的9条线</strong><br><img src="/2022/06/05/three/three_basic/%E7%BB%98%E5%88%B6%E7%BA%BF.png" alt="绘制三角面"></p>
<h3 id="几何体的本质"><a href="#几何体的本质" class="headerlink" title="几何体的本质"></a>几何体的本质</h3><p>立方体几何体BoxGeometry本质上就是一系列的顶点构成，只是Threejs的APIBoxGeometry把顶点的生成细节封装了，用户可以直接使用。比如一个立方体网格模型，有6个面，每个面至少两个三角形拼成一个矩形平面，每个三角形三个顶点构成，<br>对于球体网格模型而言，同样是通过三角形拼出来一个球面，三角形数量越多，网格模型表面越接近于球形。</p>
<p><img src="/2022/06/05/three/three_basic/%E5%87%A0%E4%BD%95%E4%BD%93.png" alt="几何体"></p>
<p>如下的球体，查看顶点，和线 mesh ,漂亮的球体也是有大量的点连城的线绘制的三角面</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sphere=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">const</span> materia=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PointsMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">color</span>:<span class="string">&#x27;pink&#x27;</span>,</span><br><span class="line">  <span class="attr">size</span>:<span class="number">0.1</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> points=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Points</span>(sphere,materia)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([points]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> sphere=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">const</span> materia=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">color</span>:<span class="string">&#x27;pink&#x27;</span>,</span><br><span class="line">  <span class="attr">side</span>:<span class="title class_">DoubleSide</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> points=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(sphere,materia)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([points]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E7%90%83%E4%BD%93%E7%82%B9.png" alt="球体点"><br><img src="/2022/06/05/three/three_basic/%E7%90%83%E4%BD%93%E7%BA%BF.png" alt="球体线"></p>
<h2 id="颜色插值计算"><a href="#颜色插值计算" class="headerlink" title="颜色插值计算"></a>颜色插值计算</h2><h3 id="线段颜色有顶点颜色插值得来"><a href="#线段颜色有顶点颜色插值得来" class="headerlink" title="线段颜色有顶点颜色插值得来"></a>线段颜色有顶点颜色插值得来</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> line = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//线段起点终点</span></span><br><span class="line"><span class="keyword">const</span> pointArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>,</span><br><span class="line">])</span><br><span class="line">line.<span class="title function_">setAttribute</span>(<span class="string">&#x27;position&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(pointArr, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//线段端点颜色 插值的颜色是0-1  而不是 0-255</span></span><br><span class="line"><span class="keyword">const</span> colorArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">//顶点1颜色</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点2颜色</span></span><br><span class="line">]);</span><br><span class="line">line.<span class="title function_">setAttribute</span>(<span class="string">&#x27;color&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(colorArr, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//线段材质</span></span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">    <span class="comment">//颜色有顶点决定</span></span><br><span class="line">    <span class="attr">vertexColors</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(line, material)</span><br><span class="line">  obj.<span class="property">position</span>.<span class="property">z</span> = <span class="number">0.5</span></span><br><span class="line">  obj.<span class="property">position</span>.<span class="property">y</span> = <span class="number">0.5</span></span><br><span class="line">  <span class="title function_">addObjectToScene</span>([obj]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E7%BA%BF%E6%AE%B5%E9%A2%9C%E8%89%B2%E6%8F%92%E5%80%BC.png" alt="线段插值"></p>
<h3 id="面颜色插值"><a href="#面颜色插值" class="headerlink" title="面颜色插值"></a>面颜色插值</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//有顶点组成面</span></span><br><span class="line"><span class="keyword">const</span> rectangle = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//逆时针放置点</span></span><br><span class="line"><span class="keyword">const</span> pointArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>,</span><br><span class="line">  <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>,</span><br><span class="line">  <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>,</span><br><span class="line">  <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">])</span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;position&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(pointArr, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> colorArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">//顶点0颜色 红</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点1颜色 绿</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">//顶点2颜色 蓝</span></span><br><span class="line"></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,  <span class="comment">//顶点3颜色</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,  <span class="comment">//顶点4颜色</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,  <span class="comment">//顶点5颜色</span></span><br><span class="line">]);</span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;color&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(colorArr, <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshBasicMaterial</span>(&#123;</span><br><span class="line">  <span class="comment">//面的颜色有顶点插值得来</span></span><br><span class="line">  <span class="attr">vertexColors</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(rectangle, material)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([obj]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E9%9D%A2%E9%A2%9C%E8%89%B2%E6%8F%92%E5%80%BC.png" alt="面插值"></p>
<h2 id="带法线的几何体"><a href="#带法线的几何体" class="headerlink" title="带法线的几何体"></a>带法线的几何体</h2><p>如果渲染的材质是可以反射光的材质，必须要设置法向</p>
<p>上面的例子面插值，如果更改材质为 MeshLambertMaterial，面显示黑色，就是因为没有设置法线的原因</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="comment">//面的颜色有顶点插值得来</span></span><br><span class="line">  <span class="attr">vertexColors</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>增加法线后 MeshLambertMaterial 材质才知道如何反射光线</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//增加法线,用来反射光线，每个顶点都要定义</span></span><br><span class="line"><span class="keyword">const</span> normalArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">]);</span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;normal&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(normalArr, <span class="number">3</span>))</span><br></pre></td></tr></table></figure>

<h2 id="通过索引减少重复的点"><a href="#通过索引减少重复的点" class="headerlink" title="通过索引减少重复的点"></a>通过索引减少重复的点</h2><p>绘制一个正方形常规是用4个点，而不是6个点，有俩个点是重复的，但是在THREE 里正方形是由三角形拼接的，不考虑分段，一个正方形需要俩个三角形才能拼接出来<br>俩个三角形是6个顶点，有俩个是重复的，通过索引复用顶点可以用四个点绘制正方形</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//逆时针放置四个点 </span></span><br><span class="line"><span class="keyword">const</span> pointArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">//顶点0</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="comment">//顶点1</span></span><br><span class="line">  <span class="number">2</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="comment">//顶点2</span></span><br><span class="line">  <span class="number">2</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">//顶点3</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//四个点的颜色</span></span><br><span class="line"><span class="keyword">const</span> colorArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">//顶点0颜色 红</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点1颜色 绿</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">//顶点2颜色 蓝</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">//顶点4颜色 红</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">//四个点的法线增加法线,用来反射光线</span></span><br><span class="line"><span class="keyword">const</span> normalArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点1法线</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点2法线</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点3法线</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点4法线</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过索引绘制俩个三角形，逆时针绘制三角形</span></span><br><span class="line"><span class="comment">//必须是无符号整数</span></span><br><span class="line"><span class="keyword">const</span> indexArr = <span class="keyword">new</span> <span class="title class_">Uint16Array</span>([</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="comment">//第一个三角形</span></span><br><span class="line">    <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>  <span class="comment">//第二个三角形</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//有顶点组成面</span></span><br><span class="line"><span class="keyword">const</span> rectangle = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>();</span><br><span class="line"></span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;position&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(pointArr, <span class="number">3</span>));</span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;normal&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(normalArr, <span class="number">3</span>));</span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;color&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(colorArr, <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置索引</span></span><br><span class="line">rectangle.<span class="property">index</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferAttribute</span>(indexArr, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="comment">//面的颜色有顶点插值得来</span></span><br><span class="line">  <span class="attr">vertexColors</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> obj1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(rectangle, material)</span><br><span class="line">obj1.<span class="property">position</span>.<span class="property">x</span> = -<span class="number">5</span></span><br><span class="line"><span class="title function_">addObjectToScene</span>([obj1]);</span><br></pre></td></tr></table></figure>

<p>通过索引自定义正方体</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//逆时针放置点</span></span><br><span class="line"><span class="keyword">const</span> pointArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">  <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> colorArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">//顶点0颜色 红</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点1颜色 绿</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">//顶点2颜色 蓝</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">//顶点4颜色 红</span></span><br><span class="line"></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">//顶点0颜色 红</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点1颜色 绿</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">//顶点2颜色 蓝</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">//顶点4颜色 红</span></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">//增加法线,用来反射光线</span></span><br><span class="line"><span class="keyword">const</span> normalArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点1法线</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点2法线</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点3法线</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点4法线</span></span><br><span class="line"></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点1法线</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点2法线</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点3法线</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="comment">//顶点4法线</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//必须是无符号整数</span></span><br><span class="line"><span class="keyword">const</span> indexArr = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,</span><br><span class="line">  <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>,</span><br><span class="line">  <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">6</span>, <span class="number">7</span>, <span class="number">4</span>,</span><br><span class="line">  <span class="number">4</span>, <span class="number">6</span>, <span class="number">6</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">1</span>, <span class="number">6</span>, <span class="number">2</span>,</span><br><span class="line">  <span class="number">2</span>, <span class="number">6</span>, <span class="number">5</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">0</span>, <span class="number">7</span>, <span class="number">4</span>,</span><br><span class="line">  <span class="number">4</span>, <span class="number">3</span>, <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">7</span>,</span><br><span class="line">  <span class="number">7</span>, <span class="number">1</span>, <span class="number">6</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//有顶点组成面</span></span><br><span class="line"><span class="keyword">const</span> rectangle = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//geometry.setIndex( indices );</span></span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;position&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(pointArr, <span class="number">3</span>));</span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;normal&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(normalArr, <span class="number">3</span>));</span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;color&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(colorArr, <span class="number">3</span>));</span><br><span class="line">rectangle.<span class="property">index</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferAttribute</span>(indexArr, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="comment">//面的颜色有顶点插值得来</span></span><br><span class="line">  <span class="attr">vertexColors</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">  <span class="attr">wireframe</span>: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(rectangle, material)</span><br><span class="line"></span><br><span class="line"><span class="title function_">addObjectToScene</span>([obj]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E8%87%AA%E5%AE%9A%E4%B9%89%E6%AD%A3%E6%96%B9%E4%BD%93.png" alt="自定义正方体"></p>
<h2 id="访问几何体数据及拷贝复制"><a href="#访问几何体数据及拷贝复制" class="headerlink" title="访问几何体数据及拷贝复制"></a>访问几何体数据及拷贝复制</h2><h3 id="访问几何体并更改数据"><a href="#访问几何体并更改数据" class="headerlink" title="访问几何体并更改数据"></a>访问几何体并更改数据</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> box = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(</span><br><span class="line">  &#123; <span class="attr">color</span>: <span class="number">0x00ffff</span>, <span class="attr">transparent</span>: <span class="literal">true</span>, <span class="attr">opacity</span>: <span class="number">0.5</span>, <span class="attr">wireframe</span>: <span class="literal">false</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(box, material);</span><br><span class="line"><span class="comment">//可以访问几何体的高度可以，但是更改几何体的尺寸后,THREE.js 并不会去渲染修改后的数据</span></span><br><span class="line">mesh.<span class="property">geometry</span>.<span class="property">parameters</span>.<span class="property">height</span>=<span class="number">2</span></span><br><span class="line"><span class="comment">//只能通过 scale 去更改</span></span><br><span class="line"><span class="comment">//几何体的 scale 会改变几何体的顶点坐标</span></span><br><span class="line">box.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line"><span class="comment">//mesh的 scale 不会改变顶点数据</span></span><br><span class="line">mesh.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line"><span class="comment">//如果更改属性长宽高要通过 mesh 的缩放</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//可以更改几何体的材质属性</span></span><br><span class="line">mesh.<span class="property">material</span>.<span class="property">color</span>=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>

<h3 id="拷贝复制"><a href="#拷贝复制" class="headerlink" title="拷贝复制"></a>拷贝复制</h3><p>对几何体 colone 是深拷贝，对mesh colone 是浅 colone</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> box = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(</span><br><span class="line">  &#123; <span class="attr">color</span>: <span class="number">0x00ffff</span>, <span class="attr">transparent</span>: <span class="literal">true</span>, <span class="attr">opacity</span>: <span class="number">0.5</span>, <span class="attr">wireframe</span>: <span class="literal">false</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(box.<span class="property">id</span>)  <span class="comment">//5</span></span><br><span class="line"><span class="keyword">const</span> newBox= box.<span class="title function_">clone</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newBox.<span class="property">id</span>)  <span class="comment">//6</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(material.<span class="property">id</span>)  <span class="comment">//8</span></span><br><span class="line"><span class="keyword">const</span> newMaterial= material.<span class="title function_">clone</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newMaterial.<span class="property">id</span>)  <span class="comment">//9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(box, material);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mesh.<span class="property">id</span>)  <span class="comment">//13</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mesh.<span class="property">geometry</span>.<span class="property">id</span>)<span class="comment">//5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mesh.<span class="property">material</span>.<span class="property">id</span>) <span class="comment">//8</span></span><br><span class="line"><span class="keyword">const</span> newMesh= mesh.<span class="title function_">clone</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newMesh.<span class="property">id</span>)  <span class="comment">//14</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newMesh.<span class="property">geometry</span>.<span class="property">id</span>) <span class="comment">//5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newMesh.<span class="property">material</span>.<span class="property">id</span>) <span class="comment">//8</span></span><br></pre></td></tr></table></figure>

<p>mesh 的copy 是浅 copy</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//增加显示的几何体</span></span><br><span class="line"><span class="keyword">const</span> box = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(</span><br><span class="line">&#123; <span class="attr">color</span>: <span class="number">0x00ffff</span>, <span class="attr">transparent</span>: <span class="literal">true</span>, <span class="attr">opacity</span>: <span class="number">0.5</span>, <span class="attr">wireframe</span>: <span class="literal">false</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(box.<span class="property">id</span>)  <span class="comment">//5</span></span><br><span class="line"><span class="keyword">const</span> newBox=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>().<span class="title function_">copy</span>(box)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newBox.<span class="property">id</span>)  <span class="comment">//6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(newBox, material);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mesh.<span class="property">geometry</span>.<span class="property">id</span>)<span class="comment">//6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mesh.<span class="property">material</span>.<span class="property">id</span>) <span class="comment">//8</span></span><br><span class="line"><span class="keyword">const</span> newMesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>().<span class="title function_">copy</span>(mesh);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newMesh.<span class="property">geometry</span>.<span class="property">id</span>) <span class="comment">//6</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>( (newMesh.<span class="property">material</span> <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">MeshLambertMaterial</span>).<span class="property">id</span>) <span class="comment">//8</span></span><br></pre></td></tr></table></figure>

<h1 id="本地坐标和世界坐标"><a href="#本地坐标和世界坐标" class="headerlink" title="本地坐标和世界坐标"></a>本地坐标和世界坐标</h1><blockquote>
<p>世界坐标中心点默认在画布的中心位置，一个 scene 只有一个世界坐标，方向参考右手定则<br>默认世界坐标的中心画布中心，通过如下方法可以更改世界坐标的中心<br>scene.current.position.set(1,1,1)</p>
</blockquote>
<blockquote>
<p>本地坐标，每个 mesh 都有一个本地坐标，默认坐标的中心在几何体的中心位置<br>在不指定 mesh 本地坐标的情况下，默认本地坐标和世界坐标的中心重合<br>本地坐标的 position 是参考世界坐标的，对 mesh 进行 平移，缩放，旋转 会改变 mesh 的 position 位置</p>
</blockquote>
<p>上面的自定义正方体的例子，默认本地坐标和世界坐标是重合的，对 mesh 进行平移，就能看出来本地坐标的中心在几何体的中心位置(图中的几何体的中心点在坐标 (0,0,0) 位置)<br>对几何体的进行平移，缩放，旋转的参考都参考几何体本地坐标进行的，会改变几何体的顶点数据，因为顶点的坐标是参考本地坐标定义的</p>
<p>对 mesh 进行 平移，缩放，旋转 ，参考的是本地坐标，mesh 内的几何体的顶点坐标相对 mesh 的本地坐标并没有发生改变（除过缩放），因为 THREE.js 会一起更新几何体,</p>
<p><strong>对 mesh 进行 平移，缩放，旋转 ，能改变 mesh 相对于世界坐标的 position 位置</strong></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(rectangle, material)</span><br><span class="line"><span class="comment">//让 mesh 显示坐标辅助</span></span><br><span class="line"><span class="keyword">const</span> axesHelper=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">3</span>)</span><br><span class="line">obj.<span class="title function_">add</span>(axesHelper)</span><br><span class="line"><span class="comment">// mesh 进行移动，其实改变的是 mesh 的本地坐标,几何体的顶点数据并没有改变</span></span><br><span class="line">obj.<span class="title function_">translateX</span>(<span class="number">2</span>);</span><br><span class="line">obj.<span class="title function_">translateZ</span>(-<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/three/three_basic/%E5%9D%90%E6%A0%87%E7%A7%8D%E7%B1%BB.png" alt="坐标种类"></p>
<h1 id="旋转-缩放-平移-旋转方向是右手定则"><a href="#旋转-缩放-平移-旋转方向是右手定则" class="headerlink" title="旋转 缩放 平移 ,旋转方向是右手定则"></a>旋转 缩放 平移 ,旋转方向是右手定则</h1><h2 id="旋转-底层是欧拉角Euler"><a href="#旋转-底层是欧拉角Euler" class="headerlink" title="旋转 底层是欧拉角Euler"></a>旋转 底层是欧拉角Euler</h2><blockquote>
<p>欧拉角是用来表示三维坐标系中方向和方向变换的</p>
</blockquote>
<p>对几何进行旋转，会改变几何体的顶点坐标，因为本地坐标没有旋转，相对的几何体的顶点坐标就变化了<br>对 mesh ,group 对象进行旋转不对改变几何体的顶点坐标，因为几何体的顶点坐标是参考本地坐标的<br>在本地坐标旋转的时候，几何体的本地顶点坐标也会跟着一起变化。</p>
<h3 id="rotateX-rotateY-rotateZ"><a href="#rotateX-rotateY-rotateZ" class="headerlink" title="rotateX, rotateY,rotateZ,"></a>rotateX, rotateY,rotateZ,</h3><p>要有旋转的效果必须渲染函数里重复调用</p>
<p>测试的版本是 R144</p>
<blockquote>
<p>对于mesh 或 geometry 旋转效果是围绕几何体自身的本地坐标轴旋转<br>group 对象是围绕世界坐标系旋转</p>
</blockquote>
<p> 还是自定义正方体的例子.本地坐标没有改变</p>
<p><img src="/2022/06/05/three/three_basic/%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E6%9C%AC%E5%9C%B0%E5%9D%90%E6%A0%87%E5%92%8C%E4%B8%96%E7%95%8C%E5%9D%90%E6%A0%87%E9%87%8D%E5%A4%8D.png" alt="几何体的本地坐标和世界坐标重复"></p>
<p>对 mesh 进行旋转参考的坐标轴是几何体本地的坐标轴，</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(rectangle, material)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">table</span>(rectangle.<span class="title function_">getAttribute</span>(<span class="string">&#x27;position&#x27;</span>))</span><br><span class="line"><span class="comment">//对几何体的本地坐标参考自己的 Z 轴进行旋转90度</span></span><br><span class="line">obj.<span class="title function_">rotateZ</span>(<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">0.5</span>)</span><br><span class="line"><span class="comment">//对几何体的本地坐标 在自己的 Y 轴方向移动 单位1</span></span><br><span class="line">obj.<span class="title function_">translateY</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">//在目前的本地坐标内，对几何体在 x 轴移动 单位1</span></span><br><span class="line">rectangle.<span class="title function_">translate</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">table</span>(rectangle.<span class="title function_">getAttribute</span>(<span class="string">&#x27;position&#x27;</span>))</span><br><span class="line"><span class="keyword">const</span> axesHelper=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">3</span>)</span><br><span class="line">obj.<span class="title function_">add</span>(axesHelper)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([obj]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E6%97%8B%E8%BD%AC%E6%9C%AC%E5%9C%B0%E5%9D%90%E6%A0%87.png" alt="旋转本地坐标"></p>
<h3 id="rotateOnAxis，"><a href="#rotateOnAxis，" class="headerlink" title="rotateOnAxis，"></a>rotateOnAxis，</h3><blockquote>
<p>rotateOnWorldAxis 以世界坐标系为起点</p>
</blockquote>
<p>因为向量的原因只能是mesh group 使用此API</p>
<p>如果绕 Y 轴旋转如下设置<br>rotateOnAxis(new THREE.Vector3(0,1,0) ,MathUtils.degToRad(1))<br>如果绕 Y 轴反向旋转如下设置<br>rotateOnAxis(new THREE.Vector3(0,-1,0) ,MathUtils.degToRad(1))</p>
<p><strong>以 mesh 本地坐标中心为起点 new Vector3(1,1,1) 为终点的自定义旋转轴</strong></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(rectangle, material)</span><br><span class="line">obj1.<span class="title function_">translateX</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> obj2= obj1.<span class="title function_">clone</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> v3= <span class="keyword">new</span> <span class="title class_">Vector3</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">obj2.<span class="title function_">rotateOnAxis</span>(v3,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">0.25</span>)</span><br><span class="line">obj2.<span class="title function_">translateOnAxis</span>(v3,<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> axesHelper=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">1.5</span>)</span><br><span class="line">obj1.<span class="title function_">add</span>(axesHelper)</span><br><span class="line">obj2.<span class="title function_">add</span>(axesHelper.<span class="title function_">clone</span>())</span><br><span class="line"><span class="title function_">addObjectToScene</span>([obj1,obj2]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E5%90%91%E9%87%8F%E6%96%B9%E5%90%91%E6%97%8B%E8%BD%AC.png" alt="向量方向旋转"></p>
<h3 id="当父对象旋转的时候，子对象绕父对象旋转"><a href="#当父对象旋转的时候，子对象绕父对象旋转" class="headerlink" title="当父对象旋转的时候，子对象绕父对象旋转"></a>当父对象旋转的时候，子对象绕父对象旋转</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cylinder = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CylinderGeometry</span>(<span class="number">0.5</span>, <span class="number">1</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cylinderMesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(cylinder, material);</span><br><span class="line">cylinderMesh.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">5</span>,cylinder.<span class="property">parameters</span>.<span class="property">height</span>/<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> box = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1.2</span>, <span class="number">1.2</span>, <span class="number">1.2</span>);</span><br><span class="line"><span class="keyword">const</span> boxMesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(box, material);</span><br><span class="line">boxMesh1.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">2</span>,box1.<span class="property">parameters</span>.<span class="property">height</span>/<span class="number">2</span>-cylinder.<span class="property">parameters</span>.<span class="property">height</span>/<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line"><span class="comment">//添加子对象</span></span><br><span class="line">cylinderMesh.<span class="title function_">add</span>(boxMesh1)</span><br><span class="line"><span class="title function_">addMeshesToScene</span>([cylinderMesh]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//父对象旋转</span></span><br><span class="line"><span class="title function_">configPrimaryAnimation</span>(<span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>&gt;([</span><br><span class="line">  [<span class="string">&quot;a1&quot;</span>, <span class="function">() =&gt;</span> cylinderMesh.<span class="title function_">rotateY</span>(<span class="title class_">MathUtils</span>.<span class="title function_">degToRad</span>(<span class="number">1</span>))],</span><br><span class="line">]))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="平移"><a href="#平移" class="headerlink" title="平移"></a>平移</h2><h3 id="translateX-translateY-translateZ"><a href="#translateX-translateY-translateZ" class="headerlink" title="translateX ,translateY, translateZ"></a>translateX ,translateY, translateZ</h3><p>对几何进行translate，会改变几何体的顶点坐标, 因为本地坐标没有 translate<br>对 mesh ，组对象进行 translate 不会改变顶点坐标，因为几何体的顶点坐标会跟着 mesh 的本地坐标进行 translate</p>
<p> 还是自定义正方体的例子.本地坐标没有改变</p>
<p><img src="/2022/06/05/three/three_basic/%E5%87%A0%E4%BD%95%E4%BD%93%E7%9A%84%E6%9C%AC%E5%9C%B0%E5%9D%90%E6%A0%87%E5%92%8C%E4%B8%96%E7%95%8C%E5%9D%90%E6%A0%87%E9%87%8D%E5%A4%8D.png" alt="几何体的本地坐标和世界坐标重复"></p>
<p>此正方体的长宽高都是1，先对几何体的本地坐标参考自己的Y 轴旋转 90 度<br>在对几何体的本地坐标x轴上参考自己的 X 轴 平移1，在对几何体在参考本地坐标 X 轴平移 -1 </p>
 <figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(rectangle, material)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">table</span>(rectangle.<span class="title function_">getAttribute</span>(<span class="string">&#x27;position&#x27;</span>))</span><br><span class="line"><span class="comment">// 让 mesh 的本地坐标进行平移，几何体的顶点数据并没有改变</span></span><br><span class="line"><span class="comment">// 平移的参考点并不是世界坐标，是参考自己的本地坐标</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">table</span>(rectangle.<span class="title function_">getAttribute</span>(<span class="string">&#x27;position&#x27;</span>))</span><br><span class="line"><span class="comment">//本地坐标参考自己旋转 90 度</span></span><br><span class="line">obj.<span class="title function_">rotateY</span>(<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">0.5</span>)</span><br><span class="line"><span class="comment">//本地坐标在当前的本地坐标系内 X 轴平移 1 个单位</span></span><br><span class="line">obj.<span class="title function_">translateX</span>(<span class="number">1</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">table</span>(rectangle.<span class="title function_">getAttribute</span>(<span class="string">&#x27;position&#x27;</span>))</span><br><span class="line"><span class="comment">//几何体参考自己本地坐标 X 轴平移 -1 个单位</span></span><br><span class="line">rectangle.<span class="title function_">translate</span>(-<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">table</span>(rectangle.<span class="title function_">getAttribute</span>(<span class="string">&#x27;position&#x27;</span>))</span><br><span class="line"><span class="keyword">const</span> axesHelper=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">3</span>)</span><br><span class="line">obj.<span class="title function_">add</span>(axesHelper)</span><br></pre></td></tr></table></figure>
<p> <img src="/2022/06/05/three/three_basic/%E7%A7%BB%E5%8A%A8%E6%9C%AC%E5%9C%B0%E5%9D%90%E6%A0%87.png" alt="移动本地坐标"></p>
<h3 id="translateOnAxis-沿着着指定的向量方向平移一定的距离"><a href="#translateOnAxis-沿着着指定的向量方向平移一定的距离" class="headerlink" title="translateOnAxis 沿着着指定的向量方向平移一定的距离"></a>translateOnAxis 沿着着指定的向量方向平移一定的距离</h3><p>translateOnAxis 可以灵活的向任意方向平移,因为向量的原因只能是mesh group 使用此API</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(rectangle, material)</span><br><span class="line"></span><br><span class="line"><span class="comment">//对第一个mesh X 轴平移 1个单位</span></span><br><span class="line">obj1.<span class="title function_">translateX</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment">//克隆第一个 mesh</span></span><br><span class="line"><span class="keyword">const</span> obj2= obj.<span class="title function_">clone</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//对第二个 mesh2 以自己本地坐标系的中心为起点，以 new Vector3(1,1,1)为终点作为平移的参考线</span></span><br><span class="line"><span class="keyword">const</span> v3= <span class="keyword">new</span> <span class="title class_">Vector3</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">obj2.<span class="title function_">translateOnAxis</span>(v3,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axesHelper=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">3</span>)</span><br><span class="line">obj1.<span class="title function_">add</span>(axesHelper)</span><br><span class="line">obj2.<span class="title function_">add</span>(axesHelper.<span class="title function_">clone</span>())</span><br><span class="line"><span class="title function_">addObjectToScene</span>([obj1,obj2]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E5%90%91%E9%87%8F%E6%96%B9%E5%90%91%E5%B9%B3%E7%A7%BB.png" alt="向量方向平移"></p>
<h2 id="缩放"><a href="#缩放" class="headerlink" title="缩放"></a>缩放</h2><blockquote>
<p>对几何体进行 scale，会改变几何体的顶点坐标, 缩放是三个方向都可以的 scale(x,y,z)</p>
<blockquote>
<p>几何体 scale(-x,-y,-z) 的效果是几何体会到反方向的底部。</p>
</blockquote>
</blockquote>
<p><img src="/2022/06/05/three/three_basic/%E5%87%A0%E4%BD%95%E4%BD%93%E5%8F%8D%E6%96%B9%E5%90%91%E7%BC%A9%E6%94%BE.png" alt="几何体反方向缩放"></p>
<blockquote>
<p>对  mesh , group 进行 scale ,几何体的体积会变化，但是比较奇怪的是顶点坐标不会变化。或许是为了和 平移，旋转 保持一致吧</p>
<blockquote>
<p>mesh scale(-x,-y,-z) 的效果是几何体会到反方向的底部。坐标轴也会到反方向的底部</p>
</blockquote>
</blockquote>
<p><img src="/2022/06/05/three/three_basic/mesh%E5%8F%8D%E6%96%B9%E5%90%91%E7%BC%A9%E6%94%BE.png" alt="mesh反方向缩放"></p>
<h1 id="设置几何体的几何中心"><a href="#设置几何体的几何中心" class="headerlink" title="设置几何体的几何中心"></a>设置几何体的几何中心</h1><p>center 几何体调用此方法后会让几何体的中心居于本地坐标的中心，而不是默认的顶点坐标最小点<br><strong>会改变几何体的所有顶点坐标</strong></p>
<p><img src="/2022/06/05/three/three_basic/center%E5%89%8D.png" alt="center前"></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(rectangle, material)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">table</span>(rectangle.<span class="title function_">getAttribute</span>(<span class="string">&#x27;position&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">table</span>(obj.<span class="property">position</span>)</span><br><span class="line"></span><br><span class="line">obj.<span class="title function_">translateX</span>(<span class="number">1</span>)</span><br><span class="line">obj.<span class="title function_">translateZ</span>(<span class="number">1</span>)</span><br><span class="line">rectangle.<span class="title function_">center</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">table</span>(rectangle.<span class="title function_">getAttribute</span>(<span class="string">&#x27;position&#x27;</span>))</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">table</span>(obj.<span class="property">position</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> axesHelper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">3</span>)</span><br><span class="line">obj.<span class="title function_">add</span>(axesHelper)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([obj]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/center%E5%90%8E.png" alt="center后"></p>
<p>矩阵变换、欧拉、四元数、</p>
<h1 id="几何体的层次结构"><a href="#几何体的层次结构" class="headerlink" title="几何体的层次结构"></a>几何体的层次结构</h1><p><strong>通过 group 建立层级关系</strong><br><strong>嵌套的层级关系，里面的对象参考外面对象的坐标</strong></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//增加显示的几何体</span></span><br><span class="line"><span class="keyword">const</span> box = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"><span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(</span><br><span class="line">  &#123; <span class="attr">color</span>: <span class="number">0x00ffff</span>, <span class="attr">transparent</span>: <span class="literal">true</span>, <span class="attr">opacity</span>: <span class="number">0.5</span>, <span class="attr">wireframe</span>: <span class="literal">false</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(box, material);</span><br><span class="line">mesh.<span class="title function_">translateX</span>(<span class="number">1</span>)</span><br><span class="line">mesh.<span class="title function_">translateZ</span>(<span class="number">1</span>)</span><br><span class="line">mesh.<span class="title function_">translateY</span>(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过 group 可以建立层级关系</span></span><br><span class="line"><span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>()</span><br><span class="line">group.<span class="title function_">add</span>(mesh)</span><br><span class="line">group.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(group.<span class="property">position</span>) <span class="comment">// 1,1,1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(mesh.<span class="property">position</span>)  <span class="comment">// 1,0.5,1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//通过 getWorldPosition 获取对象的相对世界坐标的位置</span></span><br><span class="line"><span class="keyword">const</span> v3 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>()</span><br><span class="line">mesh.<span class="title function_">getWorldPosition</span>(v3)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(v3)<span class="comment">//2,1.5,2</span></span><br><span class="line"></span><br><span class="line">group.<span class="title function_">add</span>(ax.<span class="title function_">clone</span>())</span><br><span class="line">mesh.<span class="title function_">add</span>(ax)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([group]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E5%B1%82%E7%BA%A7%E5%85%B3%E7%B3%BBgroup.png" alt="层级关系group"></p>
<p>group.remove 方法也可以移除添加的对象</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">group.<span class="title function_">add</span>(mesh)</span><br><span class="line"><span class="keyword">const</span> newMesh=mesh.<span class="title function_">clone</span>().<span class="title function_">translateX</span>(<span class="number">2</span>)</span><br><span class="line">group.<span class="title function_">add</span>(newMesh)</span><br><span class="line">group.<span class="title function_">remove</span>(newMesh)</span><br></pre></td></tr></table></figure>

<p><strong>mesh 之间也可以建立层级关系</strong><br><strong>嵌套的层级关系，里面的对象参考外面对象的坐标</strong><br>** mesh.remove 也可以移除内部的对象</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//增加显示的几何体</span></span><br><span class="line">    <span class="keyword">const</span> box = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(</span><br><span class="line">      &#123; <span class="attr">color</span>: <span class="number">0x00ffff</span>, <span class="attr">transparent</span>: <span class="literal">true</span>, <span class="attr">opacity</span>: <span class="number">0.5</span>, <span class="attr">wireframe</span>: <span class="literal">false</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span> &#125;);</span><br><span class="line">    <span class="keyword">const</span> v3 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>()</span><br><span class="line">    <span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(box, material);</span><br><span class="line">    mesh.<span class="title function_">translateX</span>(<span class="number">1</span>)</span><br><span class="line">    mesh.<span class="title function_">translateZ</span>(<span class="number">1</span>)</span><br><span class="line">    mesh.<span class="title function_">translateY</span>(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>()</span><br><span class="line">    group.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,)</span><br><span class="line"></span><br><span class="line">    group.<span class="title function_">add</span>(ax.<span class="title function_">clone</span>())</span><br><span class="line">    group.<span class="title function_">add</span>(mesh)</span><br><span class="line">    <span class="keyword">const</span> newMesh=mesh.<span class="title function_">clone</span>().<span class="title function_">translateX</span>(<span class="number">1</span>)</span><br><span class="line">    newMesh.<span class="property">material</span>=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>().<span class="title function_">copy</span>(mesh.<span class="property">material</span>)</span><br><span class="line">    newMesh.<span class="property">material</span>.<span class="property">color</span>=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">    newMesh.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">1</span>,<span class="number">0.5</span>,<span class="number">1</span>)</span><br><span class="line">    <span class="comment">//mesh 之间建立的层级关系</span></span><br><span class="line">    mesh.<span class="title function_">add</span>(newMesh.<span class="title function_">add</span>(ax.<span class="title function_">clone</span>()))</span><br><span class="line">    </span><br><span class="line">    newMesh.<span class="title function_">getWorldPosition</span>(v3)<span class="comment">//3,1,3</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(v3);</span><br><span class="line">    mesh.<span class="title function_">add</span>(ax)</span><br><span class="line">    <span class="title function_">addObjectToScene</span>([group]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E5%B1%82%E7%BA%A7%E5%85%B3%E7%B3%BBmesh.png" alt="层级关系mesh"></p>
<h1 id="绘制平面图形"><a href="#绘制平面图形" class="headerlink" title="绘制平面图形"></a>绘制平面图形</h1><h2 id="直线"><a href="#直线" class="headerlink" title="直线"></a>直线</h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">const</span> startV2=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> endV2=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">5</span>,<span class="number">5</span>)</span><br><span class="line"><span class="keyword">const</span> line=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineCurve</span>(startV2,endV2);</span><br><span class="line"><span class="keyword">const</span> geo=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(line.<span class="title function_">getPoints</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">const</span> mesh=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geo,<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>:<span class="string">&#x27;pink&#x27;</span>,</span><br><span class="line">&#125;))</span><br><span class="line">mesh.<span class="title function_">rotateX</span>(<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">0.5</span>)</span><br><span class="line">mesh.<span class="title function_">add</span>(ax)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/three/three_basic/%E5%B9%B3%E9%9D%A2%E7%9B%B4%E7%BA%BF.png" alt="平面直线"></p>
<p>三位空间的直线</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">const</span> startV3=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> endV3=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> geo=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>([startV3,endV3])</span><br><span class="line"><span class="keyword">const</span> mesh=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geo,<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>:<span class="string">&#x27;pink&#x27;</span>,</span><br><span class="line">&#125;))</span><br><span class="line">mesh.<span class="title function_">add</span>(ax)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>


<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">const</span> startV2=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> endV2=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>)</span><br><span class="line"><span class="keyword">const</span> line=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineCurve3</span>(startV2,endV2);</span><br><span class="line"><span class="keyword">const</span> geo=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(line.<span class="title function_">getPoints</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">const</span> mesh=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geo,<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>:<span class="string">&#x27;pink&#x27;</span>,</span><br><span class="line">&#125;))</span><br><span class="line">mesh.<span class="title function_">add</span>(ax)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>

<h2 id="圆弧"><a href="#圆弧" class="headerlink" title="圆弧"></a>圆弧</h2><p>ArcCurve </p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// aClockwise 表示绘制的是是否按照顺时针绘制</span></span><br><span class="line"><span class="keyword">const</span> arc=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ArcCurve</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>,<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//平面图形必须要转换为三维图形</span></span><br><span class="line"><span class="comment">//arc.getPoints(50) 在指线上取指定的顶点</span></span><br><span class="line"><span class="keyword">const</span> geo=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(arc.<span class="title function_">getPoints</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">const</span> mesh1=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geo,<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>:<span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">&#125;))</span><br><span class="line">mesh.<span class="title function_">rotateX</span>(<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">0.5</span>).<span class="title function_">translateX</span>(<span class="number">2</span>).<span class="title function_">translateY</span>(<span class="number">1</span>)</span><br><span class="line">mesh.<span class="title function_">add</span>(ax)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E5%B9%B3%E9%9D%A2%E5%9C%86%E5%BC%A7.png" alt="平面圆弧"></p>
<h2 id="椭圆"><a href="#椭圆" class="headerlink" title="椭圆"></a>椭圆</h2><p>Ellipse</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//最后一个参数指定旋转椭圆的弧度</span></span><br><span class="line"><span class="keyword">const</span> ellipse=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">EllipseCurve</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">2</span>*<span class="title class_">Math</span>.<span class="property">PI</span>,<span class="literal">false</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">0.5</span>);</span><br><span class="line"><span class="keyword">const</span> geo=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(ellipse.<span class="title function_">getPoints</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">const</span> mesh=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geo,<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">color</span>:<span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">&#125;))</span><br><span class="line">mesh.<span class="title function_">rotateX</span>(<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">0.5</span>)</span><br><span class="line">mesh.<span class="title function_">add</span>(ax)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E5%B9%B3%E9%9D%A2%E6%A4%AD%E5%9C%86.png" alt="平面椭圆"></p>
<h2 id="样条曲线"><a href="#样条曲线" class="headerlink" title="样条曲线"></a>样条曲线</h2><ol>
<li><p>SplineCurve 二维样条曲线</p>
</li>
<li><p>CatmullRomCurve3 三维样条曲线</p>
</li>
</ol>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> curve1=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CatmullRomCurve3</span>([</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>),</span><br><span class="line">],<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> curve2=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CatmullRomCurve3</span>([</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(-<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(-<span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>),</span><br><span class="line">],<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> geo1=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(curve1.<span class="title function_">getPoints</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">const</span> geo2=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(curve2.<span class="title function_">getPoints</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">const</span> mesh1=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geo1,<span class="keyword">new</span> <span class="title class_">LineBasicMaterial</span>(&#123;<span class="attr">color</span>:<span class="string">&#x27;#B09A37&#x27;</span>&#125;))</span><br><span class="line"><span class="keyword">const</span> mesh2=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geo2,<span class="keyword">new</span> <span class="title class_">LineBasicMaterial</span>(&#123;<span class="attr">color</span>:<span class="string">&#x27;#B09A37&#x27;</span>&#125;))</span><br><span class="line"><span class="keyword">const</span> group=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>()</span><br><span class="line">group.<span class="title function_">add</span>(mesh1,mesh2)</span><br><span class="line">group.<span class="title function_">add</span>(ax)</span><br><span class="line"></span><br><span class="line"><span class="title function_">addObjectToScene</span>([group]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E4%B8%89%E7%BB%B4%E6%A0%B7%E6%9D%A1%E6%9B%B2%E7%BA%BF.png" alt="三维样条曲线"></p>
<h2 id="贝塞尔曲线"><a href="#贝塞尔曲线" class="headerlink" title="贝塞尔曲线"></a>贝塞尔曲线</h2><p>贝塞尔曲线有二维和三维的</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//二阶三维贝塞尔</span></span><br><span class="line"><span class="keyword">const</span> curve1=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">QuadraticBezierCurve3</span>(</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> curve2=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CubicBezierCurve3</span>(</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(-<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(-<span class="number">1</span>,<span class="number">1</span>,-<span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(-<span class="number">1</span>,<span class="number">1</span>,-<span class="number">2</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//三阶三维贝塞尔</span></span><br><span class="line"><span class="keyword">const</span> geo1=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(curve1.<span class="title function_">getPoints</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">const</span> geo2=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(curve2.<span class="title function_">getPoints</span>(<span class="number">50</span>))</span><br><span class="line"><span class="keyword">const</span> mesh1=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geo1,<span class="keyword">new</span> <span class="title class_">LineBasicMaterial</span>(&#123;<span class="attr">color</span>:<span class="string">&#x27;#B09A37&#x27;</span>&#125;))</span><br><span class="line"><span class="keyword">const</span> mesh2=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geo2,<span class="keyword">new</span> <span class="title class_">LineBasicMaterial</span>(&#123;<span class="attr">color</span>:<span class="string">&#x27;#B09A37&#x27;</span>&#125;))</span><br><span class="line"><span class="keyword">const</span> group=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>()</span><br><span class="line">group.<span class="title function_">add</span>(mesh1,mesh2)</span><br><span class="line">group.<span class="title function_">add</span>(ax)</span><br><span class="line"></span><br><span class="line"><span class="title function_">addObjectToScene</span>([group]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E4%B8%89%E7%BB%B4%E8%B4%9D%E5%A1%9E%E5%B0%94%E6%9B%B2%E7%BA%BF.png" alt="三维贝塞尔曲线"></p>
<h2 id="多个线条组合曲线CurvePath"><a href="#多个线条组合曲线CurvePath" class="headerlink" title="多个线条组合曲线CurvePath"></a>多个线条组合曲线CurvePath</h2><p>绘制跑道，注意要按照固定的顺序绘制,此线是按照顺时针绘制的</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">const</span> curve1=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ArcCurve</span>(<span class="number">0</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="title class_">Math</span>.<span class="property">PI</span>,<span class="number">0</span>,<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">const</span> curve2=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineCurve</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">2</span>,<span class="number">5</span>),<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">2</span>,<span class="number">2</span>))</span><br><span class="line">    <span class="keyword">const</span> curve3=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ArcCurve</span>(<span class="number">0</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>,<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">const</span> curve4=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineCurve</span>(<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(-<span class="number">2</span>,<span class="number">2</span>),<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(-<span class="number">2</span>,<span class="number">5</span>))</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">const</span> curvePath=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CurvePath</span>()</span><br><span class="line">    curvePath.<span class="property">curves</span>.<span class="title function_">push</span>(curve1,curve2,curve3,curve4)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">const</span> geo=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>()</span><br><span class="line">    geo.<span class="title function_">setFromPoints</span>(curvePath.<span class="title function_">getPoints</span>(<span class="number">200</span>) <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Vector2</span>[])</span><br><span class="line">    <span class="keyword">const</span> line=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geo,<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LineBasicMaterial</span>(&#123;</span><br><span class="line">      <span class="attr">color</span>:<span class="string">&#x27;#022239&#x27;</span>,</span><br><span class="line">    &#125;))</span><br><span class="line">    line.<span class="title function_">rotateX</span>(<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">0.5</span>).<span class="title function_">translateX</span>(<span class="number">2</span>)</span><br><span class="line">    line.<span class="title function_">add</span>(ax)</span><br><span class="line">    <span class="title function_">addObjectToScene</span>([line]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/curvepath.png" alt="curvepath"></p>
<h2 id="path"><a href="#path" class="headerlink" title="path"></a>path</h2><p>只是线段，没有三角面，path 能显示的只能是点及有点组成的线段，不能渲染成形状</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//也可以在构造函数里传入点</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Path</span>()</span><br><span class="line">path.<span class="title function_">moveTo</span>(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">path.<span class="title function_">lineTo</span>(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//贝塞尔曲线 这里的坐标是连续的</span></span><br><span class="line"><span class="comment">// bezierCurveTo() 方法通过使用表示三次贝塞尔曲线的指定控制点，向当前路径添加一个点。</span></span><br><span class="line"><span class="comment">//三次贝塞尔曲线需要三个点。前两个点是用于三次贝塞尔计算中的控制点，第三个点是曲线的结束点。曲线的开始点是当前路径中最后一个点。</span></span><br><span class="line">path.<span class="title function_">bezierCurveTo</span>(<span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//不带 to的 是坐标从零开始计算</span></span><br><span class="line">path.<span class="title function_">arc</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="title class_">Math</span>.<span class="property">PI</span>, <span class="number">0</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="comment">//在回到之前的坐标</span></span><br><span class="line">path.<span class="title function_">lineTo</span>(<span class="number">8</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">path.<span class="title function_">lineTo</span>(<span class="number">8</span>, <span class="number">0.5</span>)</span><br><span class="line">path.<span class="title function_">lineTo</span>(<span class="number">2</span>, <span class="number">0.5</span>)</span><br><span class="line">path.<span class="title function_">lineTo</span>(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line"><span class="comment">//shape.arc(1,3,1,-Math.PI*0.5,Math.PI*0.5,false)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>().<span class="title function_">setFromPoints</span>(path.<span class="title function_">getPoints</span>(<span class="number">30</span>))</span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Line</span>(geo, <span class="keyword">new</span> <span class="title class_">LineBasicMaterial</span>(&#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>&#125;))</span><br><span class="line"></span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/path.png" alt="path"></p>
<h2 id="shape"><a href="#shape" class="headerlink" title="shape"></a>shape</h2><p> <strong>shape 类似 HTML DOM Canvas 对象，通过路径来绘制二维形状平面。简单理解就是在一个平面上用不规则的线连接成一个图形</strong></p>
<h3 id="多个线条的组合"><a href="#多个线条的组合" class="headerlink" title="多个线条的组合"></a>多个线条的组合</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// shape 类似 HTML DOM Canvas 对象</span></span><br><span class="line"><span class="keyword">const</span> shape = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape.<span class="title function_">moveTo</span>(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">shape.<span class="title function_">lineTo</span>(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//贝塞尔曲线 这里的坐标是连续的</span></span><br><span class="line"><span class="comment">// bezierCurveTo() 方法通过使用表示三次贝塞尔曲线的指定控制点，向当前路径添加一个点。</span></span><br><span class="line"><span class="comment">//三次贝塞尔曲线需要三个点。前两个点是用于三次贝塞尔计算中的控制点，第三个点是曲线的结束点。曲线的开始点是当前路径中最后一个点。</span></span><br><span class="line">shape.<span class="title function_">bezierCurveTo</span>(<span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//不带 to的 是坐标从零开始计算</span></span><br><span class="line">shape.<span class="title function_">arc</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="title class_">Math</span>.<span class="property">PI</span>, <span class="number">0</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="comment">//在回到之前的坐标</span></span><br><span class="line">shape.<span class="title function_">lineTo</span>(<span class="number">8</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">shape.<span class="title function_">lineTo</span>(<span class="number">8</span>, <span class="number">0.5</span>)</span><br><span class="line">shape.<span class="title function_">lineTo</span>(<span class="number">2</span>, <span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//shape.arc(1,3,1,-Math.PI*0.5,Math.PI*0.5,false)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ShapeGeometry</span>(shape)</span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, <span class="keyword">new</span> <span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>, <span class="attr">wireframe</span>: <span class="literal">false</span> &#125;))</span><br><span class="line">mesh.<span class="title function_">add</span>(ax)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/canvas%E7%BB%98%E5%88%B62dShape.png" alt="(canvas绘制2dShape"></p>
<h3 id="多个点的组合"><a href="#多个点的组合" class="headerlink" title="多个点的组合"></a>多个点的组合</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> points = [</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">2</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">3</span>, <span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">3</span>, <span class="number">2</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">2</span>, <span class="number">3</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector2</span>(<span class="number">1</span>, <span class="number">2</span>),</span><br><span class="line">]</span><br><span class="line"><span class="comment">// shape 类似 HTML DOM Canvas 对象</span></span><br><span class="line"><span class="keyword">const</span> shape = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>(points)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ShapeGeometry</span>(shape)</span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, <span class="keyword">new</span> <span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>, <span class="attr">wireframe</span>: <span class="literal">true</span> &#125;))</span><br><span class="line"></span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/point%E7%BB%98%E5%88%B6Shape.png" alt="(point绘制Shape"></p>
<h3 id="在形状内部挖孔"><a href="#在形状内部挖孔" class="headerlink" title="在形状内部挖孔"></a>在形状内部挖孔</h3><p>shape.holes 可以用path 或 shape 去挖 shape 的孔</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> shape = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape.<span class="title function_">moveTo</span>(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">shape.<span class="title function_">lineTo</span>(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//贝塞尔曲线 这里的坐标是连续的</span></span><br><span class="line"><span class="comment">// bezierCurveTo() 方法通过使用表示三次贝塞尔曲线的指定控制点，向当前路径添加一个点。</span></span><br><span class="line"><span class="comment">//三次贝塞尔曲线需要三个点。前两个点是用于三次贝塞尔计算中的控制点，第三个点是曲线的结束点。曲线的开始点是当前路径中最后一个点。</span></span><br><span class="line">shape.<span class="title function_">bezierCurveTo</span>(<span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//不带 to的 是坐标从零开始计算</span></span><br><span class="line">shape.<span class="title function_">arc</span>(<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="title class_">Math</span>.<span class="property">PI</span>, <span class="number">0</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="comment">//在回到之前的坐标</span></span><br><span class="line">shape.<span class="title function_">lineTo</span>(<span class="number">8</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">shape.<span class="title function_">lineTo</span>(<span class="number">8</span>, <span class="number">0.5</span>)</span><br><span class="line">shape.<span class="title function_">lineTo</span>(<span class="number">2</span>, <span class="number">0.5</span>)</span><br><span class="line">shape.<span class="title function_">lineTo</span>(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path1=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Path</span>()</span><br><span class="line">path1.<span class="title function_">arc</span>(<span class="number">4</span>,<span class="number">3</span>,<span class="number">0.5</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> path2=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Path</span>()</span><br><span class="line">path2.<span class="title function_">arc</span>(<span class="number">6</span>,<span class="number">1.2</span>,<span class="number">0.5</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//用path 去挖孔</span></span><br><span class="line">shape.<span class="property">holes</span>.<span class="title function_">push</span>(path1,path2)</span><br><span class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ShapeGeometry</span>(shape)</span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, <span class="keyword">new</span> <span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>, <span class="attr">wireframe</span>:<span class="literal">false</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>&#125;))</span><br><span class="line"></span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/shapeHole.png" alt="(shapeHole"></p>
<h3 id="多个shape-的组合"><a href="#多个shape-的组合" class="headerlink" title="多个shape 的组合"></a>多个shape 的组合</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> shape1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape1.<span class="title function_">arc</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> shape2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape2.<span class="title function_">arc</span>(<span class="number">2.4</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> shape3 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape3.<span class="title function_">arc</span>(<span class="number">1.6</span>,<span class="number">2.3</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ShapeGeometry</span>([shape1,shape2,shape3])</span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, <span class="keyword">new</span> <span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>, <span class="attr">wireframe</span>:<span class="literal">false</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>&#125;))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> shape4 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape4.<span class="title function_">arc</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> shape5 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape5.<span class="title function_">arc</span>(<span class="number">3</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> shape6 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape6.<span class="title function_">arc</span>(<span class="number">2</span>,<span class="number">2.7</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">2</span>,<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> geo1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ShapeGeometry</span>([shape4,shape5,shape6])</span><br><span class="line"><span class="keyword">const</span> mesh1= <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo1, <span class="keyword">new</span> <span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>, <span class="attr">wireframe</span>:<span class="literal">false</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>&#125;))</span><br><span class="line">mesh1.<span class="title function_">translateX</span>(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh,mesh1]);</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/three/three_basic/%E7%BB%84%E5%90%88shape.png" alt="(组合shape"></p>
<h1 id="绘制三维图形"><a href="#绘制三维图形" class="headerlink" title="绘制三维图形"></a>绘制三维图形</h1><h2 id="tube"><a href="#tube" class="headerlink" title="tube"></a>tube</h2><p>TubeGeometry</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> curve1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CatmullRomCurve3</span>(</span><br><span class="line">  [</span><br><span class="line">    <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">3</span>, <span class="number">3</span>, -<span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(-<span class="number">3</span>, <span class="number">3</span>, -<span class="number">3</span>),</span><br><span class="line">    <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">1</span>, <span class="number">6</span>, <span class="number">0</span>),</span><br><span class="line">  ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> curvePath = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="property">CurvePath</span>&lt;<span class="variable constant_">THREE</span>.<span class="property">Vector3</span>&gt;()</span><br><span class="line">curvePath.<span class="property">curves</span>.<span class="title function_">push</span>(curve1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tube = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TubeGeometry</span>(curvePath, <span class="number">200</span>, <span class="number">0.5</span>, <span class="number">30</span>, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(tube, <span class="keyword">new</span> <span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>

<p> <img src="/2022/06/05/three/three_basic/tube.png" alt="tube"></p>
<h2 id="旋转-Lathe"><a href="#旋转-Lathe" class="headerlink" title="旋转 Lathe"></a>旋转 Lathe</h2><p>提供2维或3维的点集合</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">const</span> points=[</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Vector2</span>(<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Vector2</span>(<span class="number">3</span>,<span class="number">5</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Vector2</span>(<span class="number">2</span>,<span class="number">6</span>),</span><br><span class="line">]</span><br><span class="line"><span class="comment">//默认绕 Y 轴旋转</span></span><br><span class="line"><span class="keyword">const</span> geo=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LatheGeometry</span>(points,<span class="number">30</span>,<span class="number">0</span>,<span class="title class_">Math</span>.<span class="property">PI</span>)</span><br><span class="line"><span class="keyword">const</span> mesh=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo,<span class="keyword">new</span> <span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>:<span class="string">&#x27;#B09A37&#x27;</span>,<span class="attr">side</span>:<span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>&#125;))</span><br><span class="line">mesh.<span class="title function_">add</span>(ax)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E6%97%8B%E8%BD%AC%E6%88%90%E5%9E%8B.png" alt="旋转成型"></p>
<p><strong>借助Shape对象的方法.splineThru()，把上面的三个顶点进行样条插值计算， 可以得到一个光滑的旋转曲面</strong></p>
<p>shape.getPoints(20)的作用是利用已有的顶点插值计算出新的顶点，两个顶点之间插值计算出20个顶点，如果细分数是1不是20，相当于不进行插值计算， 插值计算的规则通过Shape对象的方法.splineThru()定义，几何曲线的角度描述，splineThru的作用就是创建一个样条曲线，除了样条曲线还可以使用贝赛尔等曲线进行插值计算。</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line"><span class="keyword">const</span> points=[</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Vector2</span>(<span class="number">1</span>,<span class="number">1</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Vector2</span>(<span class="number">3</span>,<span class="number">5</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Vector2</span>(<span class="number">2</span>,<span class="number">6</span>),</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> shape=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>();</span><br><span class="line">shape.<span class="title function_">splineThru</span>(points)</span><br><span class="line"><span class="keyword">const</span> geo=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">LatheGeometry</span>(shape.<span class="title function_">getPoints</span>(<span class="number">20</span>),<span class="number">30</span>)</span><br><span class="line"><span class="keyword">const</span> mesh=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo,<span class="keyword">new</span> <span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>:<span class="string">&#x27;#B09A37&#x27;</span>,<span class="attr">side</span>:<span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>&#125;))</span><br><span class="line">mesh.<span class="title function_">add</span>(ax)</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/three/three_basic/%E5%85%89%E6%BB%91%E7%9A%84%E6%97%8B%E8%BD%AC%E6%88%90%E5%9E%8B.png" alt="光滑的旋转成型"></p>
<h2 id="拉伸，扫描成型-ExtrudeGeometry"><a href="#拉伸，扫描成型-ExtrudeGeometry" class="headerlink" title="拉伸，扫描成型 ExtrudeGeometry"></a>拉伸，扫描成型 ExtrudeGeometry</h2><h3 id="拉伸成型-是直线拉伸，拉伸的轨迹不能自定义，只能之定义拉伸的距离"><a href="#拉伸成型-是直线拉伸，拉伸的轨迹不能自定义，只能之定义拉伸的距离" class="headerlink" title="拉伸成型 是直线拉伸，拉伸的轨迹不能自定义，只能之定义拉伸的距离"></a>拉伸成型 是直线拉伸，拉伸的轨迹不能自定义，只能之定义拉伸的距离</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> shape1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape1.<span class="title function_">arc</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> shape2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape2.<span class="title function_">arc</span>(<span class="number">2.4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> shape3 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape3.<span class="title function_">arc</span>(<span class="number">1.6</span>, <span class="number">2.3</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> shape4 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape4.<span class="title function_">arc</span>(<span class="number">6</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> shape5 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape5.<span class="title function_">arc</span>(<span class="number">8</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> shape6 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape6.<span class="title function_">arc</span>(<span class="number">7</span>, <span class="number">2.7</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ExtrudeGeometry</span>([shape1, shape2, shape3, shape4, shape5, shape6],&#123;</span><br><span class="line">  <span class="attr">depth</span>:<span class="number">10</span>,</span><br><span class="line">  <span class="attr">bevelEnabled</span>:<span class="literal">false</span><span class="comment">//无倒角</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, <span class="keyword">new</span> <span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>, <span class="attr">wireframe</span>: <span class="literal">false</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span> &#125;))</span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E6%8B%89%E4%BC%B8%E6%88%90%E5%9E%8B.png" alt="拉伸成型"></p>
<h3 id="扫描成型，不能定义距离，但是要指定扫描的轨迹"><a href="#扫描成型，不能定义距离，但是要指定扫描的轨迹" class="headerlink" title="扫描成型，不能定义距离，但是要指定扫描的轨迹"></a>扫描成型，不能定义距离，但是要指定扫描的轨迹</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> shape = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape.<span class="title function_">arc</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> curve1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CatmullRomCurve3</span>([</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Vector3</span>(<span class="number">5</span>, <span class="number">5</span>, <span class="number">8</span>),</span><br><span class="line"></span><br><span class="line">], <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ExtrudeGeometry</span>([shape], &#123;</span><br><span class="line">  <span class="attr">extrudePath</span>: curve1,</span><br><span class="line">  <span class="attr">bevelEnabled</span>: <span class="literal">false</span><span class="comment">//无倒角</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, <span class="keyword">new</span> <span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>, <span class="attr">wireframe</span>: <span class="literal">false</span>, <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span> &#125;))</span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh]);</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/three/three_basic/%E6%89%AB%E6%8F%8F%E6%8B%89%E4%BC%B8%E6%88%90%E5%9E%8B.png" alt="扫描拉伸成型"></p>
<h2 id="绘制3d文字"><a href="#绘制3d文字" class="headerlink" title="绘制3d文字"></a>绘制3d文字</h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//字体加载器</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">FontLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/examples/jsm/loaders/FontLoader&#x27;</span></span><br><span class="line"><span class="comment">//三维字体几何体</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">TextGeometry</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/examples/jsm/geometries/TextGeometry&#x27;</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">const</span> fontLoader = <span class="keyword">new</span> <span class="title class_">FontLoader</span>();</span><br><span class="line">  <span class="comment">// fonts/DengXian_Regular.json 是一个大文件,最好的办好是根据显示的汉字选择对应的字体</span></span><br><span class="line">  <span class="comment">// 这个文件需要绝对路径，一般放在 public 目录下</span></span><br><span class="line">  <span class="comment">// 把操作系统下的 ttf 格式的字体文件 在这个 https://gero3.github.io/facetype.js/ 网站转换为json 文件</span></span><br><span class="line">  <span class="keyword">const</span> font = <span class="keyword">await</span> fontLoader.<span class="title function_">loadAsync</span>(<span class="string">&#x27;fonts/DengXian_Regular.json&#x27;</span>)</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  parameters：</span></span><br><span class="line"><span class="comment">    font[Font]：THREE.Font 实例。</span></span><br><span class="line"><span class="comment">    size[Float]：字体大小，默认值为 100。</span></span><br><span class="line"><span class="comment">    height[Float]：挤出文本的厚度，默认值为 50。</span></span><br><span class="line"><span class="comment">    curveSegments[Integer]：表示文本的曲线上点的数量，默认值为 12,越多越光滑</span></span><br><span class="line"><span class="comment">    bevelEnabled[Boolean]：是否开启斜角，默认为 false。</span></span><br><span class="line"><span class="comment">    bevelThickness[Float]：文本斜角的深度，默认值为 20。</span></span><br><span class="line"><span class="comment">    bevelSize[Float]：斜角与原始文本轮廓之间的延伸距离，默认值为 8。</span></span><br><span class="line"><span class="comment">    bevelSegments[Integer]：斜角的分段数，默认值为 3。</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="title class_">TextGeometry</span>(<span class="string">&#x27;哈喽 THREE.JS&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">font</span>: font,</span><br><span class="line">    <span class="attr">size</span>: <span class="number">0.2</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">0.1</span>,</span><br><span class="line">    <span class="attr">curveSegments</span>: <span class="number">10</span>,</span><br><span class="line">    <span class="attr">bevelEnabled</span>:<span class="literal">true</span>,</span><br><span class="line">    <span class="attr">bevelThickness</span>:<span class="number">0.01</span>,</span><br><span class="line">    <span class="attr">bevelSize</span>:<span class="number">0.01</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  geo.<span class="title function_">center</span>()</span><br><span class="line">  <span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo,</span><br><span class="line">    [</span><br><span class="line">      <span class="comment">//字体表面材质</span></span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="string">&#x27;pink&#x27;</span> &#125;),</span><br><span class="line">      <span class="comment">//厚度方向材质</span></span><br><span class="line">      <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span> &#125;),</span><br><span class="line">    ])</span><br><span class="line">  <span class="title function_">addObjectToScene</span>([mesh])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/three/three_basic/%E7%BB%98%E5%88%B63d%E6%96%87%E5%AD%97.png" alt="绘制3d文字"></p>
<h1 id="纹理贴图"><a href="#纹理贴图" class="headerlink" title="纹理贴图"></a>纹理贴图</h1><h2 id="纹理贴图表达的是图片和几何体的面坐标之间的映射关系"><a href="#纹理贴图表达的是图片和几何体的面坐标之间的映射关系" class="headerlink" title="纹理贴图表达的是图片和几何体的面坐标之间的映射关系"></a>纹理贴图表达的是图片和几何体的面坐标之间的映射关系</h2><p><strong>uvz坐标填写的顺序一定要和坐标点的顺序能对应，才能正确的映射</strong><br><strong>默认 uv 的左下角是0，0 右上角是1，1</strong></p>
<h3 id="裁剪图片一半"><a href="#裁剪图片一半" class="headerlink" title="裁剪图片一半"></a>裁剪图片一半</h3><p><img src="/2022/06/05/three/three_basic/uv%E8%A3%81%E5%89%AA%E5%9D%90%E6%A0%871.png" alt="uv裁剪坐标1"></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改 uv 坐标本质上就是对图片进行裁剪</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">dir</span>((((geo.<span class="title function_">getAttribute</span>(<span class="string">&#x27;uv&#x27;</span>) <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Float32BufferAttribute</span>).<span class="property">array</span>) <span class="keyword">as</span> <span class="title class_">Float32Array</span>))</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 默认的 uv 坐标和 顶点坐标是重合的,不会对图进行裁剪</span></span><br><span class="line">  <span class="comment">// 0,1  1,1  0,0  1,0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//在原有的UV 坐标的情况下，选取上半部分的图片区域</span></span><br><span class="line">  <span class="comment">//填写的顺序一定要和坐标点的顺序能对应</span></span><br><span class="line">  <span class="keyword">const</span> newPoints = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">    <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0.5</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">0.5</span></span><br><span class="line">  ]);</span><br><span class="line">  geo.<span class="title function_">setAttribute</span>(<span class="string">&#x27;uv&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferAttribute</span>(newPoints, <span class="number">2</span>))</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">dir</span>((((geo.<span class="title function_">getAttribute</span>(<span class="string">&#x27;uv&#x27;</span>) <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Float32BufferAttribute</span>).<span class="property">array</span>) <span class="keyword">as</span> <span class="title class_">Float32Array</span>))</span><br><span class="line">  <span class="comment">//0,1  1,1  0,0.5  1,0.5</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>()</span><br><span class="line">  </span><br><span class="line">  textureLoader.<span class="title function_">load</span>(flower, <span class="function">(<span class="params">texture</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> materia = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">      <span class="comment">//color:&#x27;red&#x27;,</span></span><br><span class="line">      <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">      <span class="attr">map</span>: texture,</span><br><span class="line">      <span class="attr">wireframe</span>: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, materia)</span><br><span class="line">    mesh.<span class="title function_">translateX</span>(<span class="number">1.1</span>)</span><br><span class="line">    mesh.<span class="title function_">add</span>(ax)</span><br><span class="line">    <span class="title function_">addObjectToScene</span>([mesh]);</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// uv 没有裁剪</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>()</span><br><span class="line">  </span><br><span class="line">  textureLoader.<span class="title function_">load</span>(flower, <span class="function">(<span class="params">texture</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> materia = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">      <span class="comment">//color:&#x27;red&#x27;,</span></span><br><span class="line">      <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">      <span class="attr">map</span>: texture,</span><br><span class="line">      <span class="attr">wireframe</span>: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, materia)</span><br><span class="line">    mesh.<span class="title function_">add</span>(ax)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">addObjectToScene</span>([mesh]);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>UV坐标裁剪的效果</strong><br><img src="/2022/06/05/three/three_basic/uv%E8%A3%81%E5%89%AA%E5%9B%BE%E7%89%87%E7%9A%84%E4%B8%80%E5%8D%8A.png" alt="uv裁剪图片的一半"></p>
<h3 id="三角面uv"><a href="#三角面uv" class="headerlink" title="三角面uv"></a>三角面uv</h3><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> shape=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">shape.<span class="title function_">moveTo</span>(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">shape.<span class="title function_">lineTo</span>(<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line">shape.<span class="title function_">lineTo</span>(<span class="number">0.5</span>,<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>()</span><br><span class="line">textureLoader.<span class="title function_">load</span>(flower,<span class="function"><span class="params">t</span>=&gt;</span>&#123;</span><br><span class="line">  <span class="keyword">const</span> geo=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">ShapeGeometry</span>(shape)</span><br><span class="line">  <span class="keyword">const</span> mesh=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo,<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">    <span class="attr">side</span>:<span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">    <span class="attr">map</span>:t</span><br><span class="line">  &#125;))</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">table</span>((((geo.<span class="title function_">getAttribute</span>(<span class="string">&#x27;uv&#x27;</span>) <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Float32BufferAttribute</span>).<span class="property">array</span>) <span class="keyword">as</span> <span class="title class_">Float32Array</span>))</span><br><span class="line">   <span class="comment">// 三角面只有三个顶点,也就是默认只有三个 uv 点,默认注定会裁剪</span></span><br><span class="line">  <span class="comment">// 0.5,1   1,0   0,0</span></span><br><span class="line">  <span class="title function_">addObjectToScene</span>([mesh]);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/three/three_basic/%E4%B8%89%E8%A7%92%E9%9D%A2uv.png" alt="三角面uv"></p>
<h3 id="裁剪后的面积减少了，但是-uv-坐标的个数不能减少"><a href="#裁剪后的面积减少了，但是-uv-坐标的个数不能减少" class="headerlink" title="裁剪后的面积减少了，但是 uv 坐标的个数不能减少"></a>裁剪后的面积减少了，但是 uv 坐标的个数不能减少</h3><p><img src="/2022/06/05/three/three_basic/uv%E8%A3%81%E5%89%AA4%E5%88%86%E4%B9%8B%E4%B8%80.png" alt="uv裁剪4分之一"></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ax = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">5</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">table</span>((((geo.<span class="title function_">getAttribute</span>(<span class="string">&#x27;uv&#x27;</span>) <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Float32BufferAttribute</span>).<span class="property">array</span>) <span class="keyword">as</span> <span class="title class_">Float32Array</span>))</span><br><span class="line">  <span class="comment">//9个 uv 坐标</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">table</span>((((geo.<span class="title function_">getAttribute</span>(<span class="string">&#x27;position&#x27;</span>) <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Float32BufferAttribute</span>).<span class="property">array</span>) <span class="keyword">as</span> <span class="title class_">Float32Array</span>))</span><br><span class="line">  <span class="comment">//9个 顶点坐标</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//即使现在的裁剪后的面积减少了，新的 uv 坐标也必须是 9个，主要顺序要和顶点坐标一直</span></span><br><span class="line">  <span class="keyword">const</span> newPoints = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">    <span class="number">0.5</span>, <span class="number">1</span>,</span><br><span class="line">    <span class="number">0.75</span>, <span class="number">1</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="number">0.5</span>, <span class="number">0.75</span>,</span><br><span class="line">    <span class="number">0.75</span>, <span class="number">0.75</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">0.75</span>,</span><br><span class="line"></span><br><span class="line">    <span class="number">0.5</span>, <span class="number">0.5</span>,</span><br><span class="line">    <span class="number">0.75</span>, <span class="number">0.5</span>,</span><br><span class="line">    <span class="number">1</span>, <span class="number">0.5</span>,</span><br><span class="line"></span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  geo.<span class="title function_">setAttribute</span>(<span class="string">&#x27;uv&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferAttribute</span>(newPoints, <span class="number">2</span>))</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">table</span>((((geo.<span class="title function_">getAttribute</span>(<span class="string">&#x27;uv&#x27;</span>) <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Float32BufferAttribute</span>).<span class="property">array</span>) <span class="keyword">as</span> <span class="title class_">Float32Array</span>))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>()</span><br><span class="line"></span><br><span class="line">  textureLoader.<span class="title function_">load</span>(flower, <span class="function">(<span class="params">texture</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> materia = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">      <span class="comment">//color:&#x27;red&#x27;,</span></span><br><span class="line">      <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">      <span class="attr">map</span>: texture,</span><br><span class="line">      <span class="attr">wireframe</span>: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, materia)</span><br><span class="line">    mesh.<span class="title function_">translateX</span>(<span class="number">1.1</span>)</span><br><span class="line">    mesh.<span class="title function_">add</span>(ax)</span><br><span class="line">    <span class="title function_">addObjectToScene</span>([mesh]);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// uv 没有裁剪</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">const</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>()</span><br><span class="line">  </span><br><span class="line">  textureLoader.<span class="title function_">load</span>(flower, <span class="function">(<span class="params">texture</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> materia = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">      <span class="comment">//color:&#x27;red&#x27;,</span></span><br><span class="line">      <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">      <span class="attr">map</span>: texture,</span><br><span class="line">      <span class="attr">wireframe</span>: <span class="literal">false</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, materia)</span><br><span class="line">    mesh.<span class="title function_">add</span>(ax)</span><br><span class="line"></span><br><span class="line">    <span class="title function_">addObjectToScene</span>([mesh]);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/uv%E5%9D%90%E6%A0%87%E4%B8%AA%E6%95%B0%E4%B8%80%E8%87%B4.png" alt="uv坐标个数一致"></p>
<h3 id="自定义几何体的纹理贴图"><a href="#自定义几何体的纹理贴图" class="headerlink" title="自定义几何体的纹理贴图"></a>自定义几何体的纹理贴图</h3><p><strong>自定义几何体要确保法线和坐标数和顶点坐标数数量匹配</strong></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pointArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">//0顶点</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">//1顶点</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="comment">//2顶点</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="comment">//3顶点</span></span><br><span class="line"></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">//4顶点</span></span><br><span class="line">  <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">//5顶点</span></span><br><span class="line">  <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="comment">//6顶点</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="comment">//7顶点</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//面索引 必须是无符号整数</span></span><br><span class="line"><span class="keyword">const</span> indexArr = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([</span><br><span class="line">  <span class="comment">//左边</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,</span><br><span class="line">  <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>,</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//右边</span></span><br><span class="line">  <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">  <span class="number">6</span>, <span class="number">7</span>, <span class="number">4</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> uv = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="comment">//第一组四个uv 坐标对应前四组四个顶点坐标</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">  <span class="comment">//第二组四个uv 坐标对应前四组四个顶点坐标</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">//有顶点组成面</span></span><br><span class="line"><span class="keyword">const</span> rectangle = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>();</span><br><span class="line"></span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;position&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(pointArr, <span class="number">3</span>));</span><br><span class="line">rectangle.<span class="property">index</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferAttribute</span>(indexArr, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//自动生成法向量,目前不知道,法线自动计算的规则</span></span><br><span class="line">rectangle.<span class="title function_">computeVertexNormals</span>()</span><br><span class="line"><span class="comment">//增加 uv</span></span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;uv&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(uv, <span class="number">2</span>))</span><br><span class="line">rectangle.<span class="title function_">rotateX</span>(-<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">0.25</span>)</span><br><span class="line"><span class="keyword">const</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>()</span><br><span class="line">textureLoader.<span class="title function_">load</span>(flower, <span class="function"><span class="params">t</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">    <span class="comment">//面的颜色有顶点插值得来</span></span><br><span class="line">    <span class="comment">//vertexColors: true,</span></span><br><span class="line">    <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">    <span class="attr">wireframe</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">map</span>: t,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">table</span>(rectangle.<span class="title function_">getAttribute</span>(<span class="string">&#x27;normal&#x27;</span>));</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(rectangle, material)</span><br><span class="line">  <span class="keyword">const</span> axesHelper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">3</span>)</span><br><span class="line">  obj.<span class="title function_">add</span>(axesHelper)</span><br><span class="line">  </span><br><span class="line">  <span class="title function_">addObjectToScene</span>([obj]);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/three/three_basic/%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%A0%E4%BD%95%E4%BD%93.png" alt="自定义几何体"></p>
<h2 id="数组材质"><a href="#数组材质" class="headerlink" title="数组材质"></a>数组材质</h2><p>几何体可以赋予数组材质，如果材质是数组形式提供,数组的个数少于几何体的面,则几何体有面不会渲染</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> texture1 = textureLoader.<span class="title function_">load</span>(dice1)</span><br><span class="line"><span class="keyword">const</span> texture2 = textureLoader.<span class="title function_">load</span>(dice2)</span><br><span class="line"><span class="keyword">const</span> texture3 = textureLoader.<span class="title function_">load</span>(dice3)</span><br><span class="line"><span class="keyword">const</span> texture4 = textureLoader.<span class="title function_">load</span>(dice4)</span><br><span class="line"><span class="keyword">const</span> texture5 = textureLoader.<span class="title function_">load</span>(dice5)</span><br><span class="line"><span class="keyword">const</span> texture6 = textureLoader.<span class="title function_">load</span>(dice6)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> materia1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">map</span>: texture1,</span><br><span class="line">  <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> materia2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">map</span>: texture2,</span><br><span class="line">  <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> materia3 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">map</span>: texture3,</span><br><span class="line">  <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> materia4 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">map</span>: texture4,</span><br><span class="line">  <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> materia5 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">map</span>: texture5,</span><br><span class="line">  <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> materia6 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">map</span>: texture6,</span><br><span class="line">  <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//按顺序给几何体的每个面赋予不同的材质</span></span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, [materia1, materia2, materia3, materia4, materia5, materia6])</span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh])</span><br></pre></td></tr></table></figure>

<p><img src="/dice.png" alt="dice"></p>
<h2 id="纹理阵列"><a href="#纹理阵列" class="headerlink" title="纹理阵列"></a>纹理阵列</h2><ol>
<li><p>wrapS<br>纹理在水平方向上纹理包裹方式，在UV映射中对应于U，默认THREE.ClampToEdgeWrapping，表示纹理边缘与网格的边缘贴合。中间部分等比缩放。还可以设置为：THREE.RepeatWrapping(重复平铺) 和 THREE.MirroredRepeatWrapping（先镜像再重复平铺）</p>
</li>
<li><p>wrapT<br>纹理贴图在垂直方向上的包裹方式，在UV映射中对应于V，默认也是THREE.ClampToEdgeWrapping，与wrapS属性一样也可以设置为：THREE.RepeatWrapping(重复平铺) 和 THREE.MirroredRepeatWrapping（先镜像再重复平铺）</p>
</li>
<li><p>repeat<br>用来设置纹理将在表面上，分别在U、V方向重复多少次。<br>repeat属性是Vector2类型，可以使用如下语句来为它赋值<br>this.cube.material.map.repeat.set(repeatX, repeatY)</p>
<blockquote>
<p> repeatX 用来指定在x轴方向上多久重复一次，repeatY用来指定在y轴方向上多久重复一次<br> 这两个变量取值范围与对应效果如下</p>
<blockquote>
<p>如果设置等于1，则纹理不会重复<br>如果设置为 大于0小于1 的值，纹理会被放大<br>如果设置为 小于0 的值，那么会产生纹理的镜像<br>如果设置为 大于1 的值，纹理会重复平铺</p>
</blockquote>
</blockquote>
</li>
</ol>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> texture1 = textureLoader.<span class="title function_">load</span>(flower)</span><br><span class="line">texture1.<span class="property">wrapS</span> = <span class="variable constant_">THREE</span>.<span class="property">RepeatWrapping</span>;</span><br><span class="line">texture1.<span class="property">wrapT</span> = <span class="variable constant_">THREE</span>.<span class="property">RepeatWrapping</span>;</span><br><span class="line"><span class="comment">// uv两个方向纹理重复数量 重复及镜像</span></span><br><span class="line">texture1.<span class="property">repeat</span>.<span class="title function_">set</span>(-<span class="number">2</span>, -<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> materia = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">map</span>: texture1,</span><br><span class="line">  <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, materia)</span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh])</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E7%BA%B9%E7%90%86%E9%98%B5%E5%88%97.png" alt="纹理阵列"></p>
<h2 id="纹理偏移"><a href="#纹理偏移" class="headerlink" title="纹理偏移"></a>纹理偏移</h2><p> <strong>texture.offset.set(x, y) x和y 的范围-1到1</strong></p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pointArr = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">//0顶点</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">//1顶点</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="comment">//2顶点</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="comment">//3顶点</span></span><br><span class="line"></span><br><span class="line">  <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">//4顶点</span></span><br><span class="line">  <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="comment">//5顶点</span></span><br><span class="line">  <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="comment">//6顶点</span></span><br><span class="line">  <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="comment">//7顶点</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="comment">//面索引 必须是无符号整数</span></span><br><span class="line"><span class="keyword">const</span> indexArr = <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([</span><br><span class="line">  <span class="comment">//左边</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>,</span><br><span class="line">  <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">  <span class="comment">//右边</span></span><br><span class="line">  <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>,</span><br><span class="line">  <span class="number">6</span>, <span class="number">7</span>, <span class="number">4</span></span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> uv = <span class="keyword">new</span> <span class="title class_">Float32Array</span>([</span><br><span class="line">  <span class="comment">//第一组四个uv 坐标对应前四组四个顶点坐标</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">  <span class="comment">//第二组四个uv 坐标对应前四组四个顶点坐标</span></span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">//有顶点组成面</span></span><br><span class="line"><span class="keyword">const</span> rectangle = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferGeometry</span>();</span><br><span class="line"></span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;position&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(pointArr, <span class="number">3</span>));</span><br><span class="line">rectangle.<span class="property">index</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BufferAttribute</span>(indexArr, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//自动生成法向量,目前不知道,法线自动计算的规则</span></span><br><span class="line">rectangle.<span class="title function_">computeVertexNormals</span>()</span><br><span class="line"><span class="comment">//增加 uv</span></span><br><span class="line">rectangle.<span class="title function_">setAttribute</span>(<span class="string">&#x27;uv&#x27;</span>, <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(uv, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> textureLoader = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>()</span><br><span class="line">textureLoader.<span class="title function_">load</span>(flower, <span class="function"><span class="params">t</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">  t.<span class="property">offset</span>.<span class="title function_">set</span>(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">    <span class="comment">//面的颜色有顶点插值得来</span></span><br><span class="line">    <span class="comment">//vertexColors: true,</span></span><br><span class="line">    <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">    <span class="attr">wireframe</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">map</span>: t,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> obj = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(rectangle, material)</span><br><span class="line">  <span class="keyword">const</span> axesHelper = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AxesHelper</span>(<span class="number">3</span>)</span><br><span class="line">  obj.<span class="title function_">add</span>(axesHelper)</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addObjectToScene</span>([obj]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="title function_">configPrimaryAnimation</span>(<span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>&gt;([</span><br><span class="line">    [<span class="string">&quot;a1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (obj.<span class="property">material</span>.<span class="property">map</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> tmp = obj.<span class="property">material</span>.<span class="property">map</span>.<span class="property">offset</span>.<span class="property">x</span></span><br><span class="line">        <span class="keyword">if</span> (tmp &lt;=-<span class="number">1</span>) &#123;</span><br><span class="line">          obj.<span class="property">material</span>.<span class="property">map</span>.<span class="property">offset</span>.<span class="title function_">setX</span>(<span class="number">0</span>)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          obj.<span class="property">material</span>.<span class="property">map</span>.<span class="property">offset</span>.<span class="title function_">setX</span>((-<span class="number">0.02</span>)+tmp)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">      &#125;</span><br><span class="line">    &#125;]</span><br><span class="line">  ]))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E7%BA%B9%E7%90%86%E5%81%8F%E7%A7%BB%E5%8A%A8%E7%94%BB.gif" alt="纹理偏移动画"></p>
<h2 id="纹理旋转"><a href="#纹理旋转" class="headerlink" title="纹理旋转"></a>纹理旋转</h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置纹理旋转角度</span></span><br><span class="line">texture.<span class="property">rotation</span> = <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">0.5</span></span><br><span class="line"><span class="comment">// 设置纹理的旋转中心，默认(0,0)</span></span><br><span class="line">texture.<span class="property">center</span>.<span class="title function_">set</span>(<span class="number">0.5</span>, <span class="number">0.5</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E7%BA%B9%E7%90%86%E6%97%8B%E8%BD%AC.png" alt="纹理旋转"></p>
<h2 id="canvas-作为纹理"><a href="#canvas-作为纹理" class="headerlink" title="canvas 作为纹理"></a>canvas 作为纹理</h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> geo = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>)</span><br><span class="line"><span class="comment">//canvas 画布大小,单位 px </span></span><br><span class="line">canvas.<span class="property">width</span>=<span class="number">500</span>;</span><br><span class="line">canvas.<span class="property">height</span>=<span class="number">500</span>;</span><br><span class="line"><span class="keyword">const</span> ctx= canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(ctx)&#123;</span><br><span class="line">  ctx.<span class="property">fillStyle</span>=<span class="string">&#x27;#3F535E&#x27;</span></span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">500</span>,<span class="number">500</span>)</span><br><span class="line">  ctx.<span class="property">fillStyle</span>=<span class="string">&#x27;pink&#x27;</span></span><br><span class="line">  ctx.<span class="property">font</span>=<span class="string">&#x27;30px  solid&#x27;</span></span><br><span class="line">  ctx.<span class="title function_">fillText</span>(<span class="string">&#x27;你好 canvasTexture&#x27;</span>,<span class="number">10</span>,<span class="number">50</span>);</span><br><span class="line">  ctx.<span class="title function_">fillText</span>(<span class="string">&#x27;今天是2022-10-16 周末&#x27;</span>,<span class="number">10</span>,<span class="number">100</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> canvasTexture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">CanvasTexture</span>(canvas)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geo, <span class="keyword">new</span> <span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">map</span>: canvasTexture,</span><br><span class="line">  <span class="attr">side</span>:<span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span>,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh])</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/canvasTexture%E7%BA%B9%E7%90%86.png" alt="canvasTexture纹理"></p>
<h2 id="视频作为纹理"><a href="#视频作为纹理" class="headerlink" title="视频作为纹理"></a>视频作为纹理</h2><p>视频作为纹理的不方便支持在于浏览器不允许带声音的自动播放</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建video对象</span></span><br><span class="line"> <span class="keyword">const</span> video = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;video&#x27;</span>) <span class="keyword">as</span> <span class="title class_">HTMLVideoElement</span></span><br><span class="line"> video.<span class="property">autoplay</span> = <span class="literal">true</span></span><br><span class="line"> video.<span class="property">muted</span> = <span class="literal">true</span></span><br><span class="line"> video.<span class="property">loop</span> = <span class="literal">true</span></span><br><span class="line"> video.<span class="property">id</span> = <span class="string">&quot;video&quot;</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> source = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;source&#x27;</span>) <span class="keyword">as</span> <span class="title class_">HTMLSourceElement</span></span><br><span class="line"> source.<span class="property">src</span> = <span class="built_in">require</span>(<span class="string">&#x27;./static/movie.mp4&#x27;</span>)</span><br><span class="line"> source.<span class="property">type</span> = <span class="string">&#x27;video/mp4&#x27;</span></span><br><span class="line"> video.<span class="title function_">appendChild</span>(source)</span><br><span class="line"></span><br><span class="line"> <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">   video.<span class="title function_">play</span>()</span><br><span class="line"> &#125;)</span><br><span class="line"></span><br><span class="line"> <span class="comment">// video对象作为VideoTexture参数创建纹理对象</span></span><br><span class="line"> <span class="keyword">const</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">VideoTexture</span>(video)</span><br><span class="line"> texture.<span class="property">wrapS</span> = texture.<span class="property">wrapT</span> = <span class="variable constant_">THREE</span>.<span class="property">ClampToEdgeWrapping</span>;</span><br><span class="line"> <span class="comment">//视频纹理是把视频播放后的画面进行采集图片渲染的</span></span><br><span class="line"> texture.<span class="property">minFilter</span> = <span class="variable constant_">THREE</span>.<span class="property">LinearFilter</span>;</span><br><span class="line"> <span class="keyword">const</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">4</span>,<span class="number">4</span>); <span class="comment">//矩形平面</span></span><br><span class="line"> geometry.<span class="title function_">translate</span>(<span class="number">2</span>,<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line"> <span class="keyword">const</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshPhongMaterial</span>(&#123;</span><br><span class="line">   <span class="attr">map</span>: texture, <span class="comment">// 设置纹理贴图</span></span><br><span class="line">   <span class="attr">side</span>: <span class="variable constant_">THREE</span>.<span class="property">DoubleSide</span></span><br><span class="line"> &#125;);</span><br><span class="line"> <span class="keyword">const</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material); <span class="comment">//网格模型对象Mesh</span></span><br><span class="line"> </span><br><span class="line"> <span class="title function_">addObjectToScene</span>([mesh])</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E7%BA%B9%E7%90%86%E8%A7%86%E9%A2%91.gif" alt="纹理视频"></p>
<h2 id="凹凸贴图-法线贴图"><a href="#凹凸贴图-法线贴图" class="headerlink" title="凹凸贴图 ,法线贴图"></a>凹凸贴图 ,法线贴图</h2><p>法线贴图是凹凸贴图的一种</p>
<blockquote>
<p>在3D计算机图形学中，法线贴图是一种用于伪造凹凸光照的技术，是凹凸贴图的一种实现。它用于添加细节，<br>而不使用更多的多边形。这种技术的一个常见用途是，通过从高精度多边形或高度图生成法线贴图，来极大地增强低精度多边形的外观和细节</p>
</blockquote>
<h1 id="帧动画"><a href="#帧动画" class="headerlink" title="帧动画"></a>帧动画</h1><p><strong>Threejs提供了一系列用户编辑和播放关键帧动画的API,例如关键帧KeyframeTrack、剪辑AnimationClip、操作AnimationAction、混合器AnimationMixer</strong></p>
<ul>
<li>AnimationMixer<br>作为特定对象的动画混合器，可以管理该对象的所有动画</li>
<li>AnimationAction            <br>为播放器指定对应的片段存储一系列行为，用来指定动画快慢，循环类型等</li>
<li>AnimationClip<br>表示可重用的动画行为片段，用来指定一个动画的动画效果（放大缩小、上下移动等）</li>
<li>KeyframeTrack<br>与时间相关的帧序列，传入时间和值，应用在指定对象的属性上。目前有 BooleanKeyframeTrack VectorKeyframeTrack 等。</li>
</ul>
<h2 id="自绘模型动画帧"><a href="#自绘模型动画帧" class="headerlink" title="自绘模型动画帧"></a>自绘模型动画帧</h2><figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> box = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> sphere = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SphereGeometry</span>(<span class="number">0.5</span>)</span><br><span class="line"><span class="keyword">const</span> materia = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123; <span class="attr">color</span>: <span class="string">&#x27;pink&#x27;</span> &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> boxMesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(box, materia)</span><br><span class="line">boxMesh.<span class="property">name</span> = <span class="string">&#x27;box&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> sphereMesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(sphere, materia.<span class="title function_">clone</span>())</span><br><span class="line">sphereMesh.<span class="property">name</span> = <span class="string">&#x27;sphere&#x27;</span></span><br><span class="line">sphereMesh.<span class="title function_">translateX</span>(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>()</span><br><span class="line">group.<span class="property">name</span> = <span class="string">&#x27;myGroup&#x27;</span></span><br><span class="line">group.<span class="title function_">add</span>(boxMesh)</span><br><span class="line">group.<span class="title function_">add</span>(sphereMesh)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> times = [<span class="number">0</span>, <span class="number">10</span>]; <span class="comment">//关键帧时间数组，离散的时间点序列</span></span><br><span class="line"><span class="keyword">const</span> values = [<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>];<span class="comment">//位置数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//位置动画，sphere.position 这里的 sphere 是 mesh 的 name</span></span><br><span class="line"><span class="keyword">const</span> posTrack = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;sphere.position&#x27;</span>, times, values);</span><br><span class="line"><span class="comment">//颜色动画这里的颜色是0-1数据范围, 这里的 sphere 是 mesh 的 name</span></span><br><span class="line"><span class="keyword">const</span> colorKF = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;sphere.material.color&#x27;</span>, [<span class="number">3</span>, <span class="number">10</span>],</span><br><span class="line">  [<span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">0</span>, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="number">1</span>])</span><br><span class="line"><span class="comment">//缩放动画 这里的 box 是 mesh 的 name</span></span><br><span class="line"><span class="keyword">const</span> scaleTrack = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;box.scale&#x27;</span>, [<span class="number">0</span>, <span class="number">3</span>], [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// duration决定了默认的播放时间，一般取所有帧动画的最大时间</span></span><br><span class="line"><span class="comment">// duration偏小，帧动画数据无法播放完，偏大，播放完帧动画会继续空播放</span></span><br><span class="line"><span class="keyword">const</span> duration = <span class="number">10</span>;</span><br><span class="line"><span class="comment">//动画剪辑器</span></span><br><span class="line"><span class="keyword">const</span> clip = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationClip</span>(<span class="string">&quot;default&quot;</span>, duration, [posTrack, colorKF, scaleTrack]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// group作为混合器的参数，可以播放group中所有子对象的帧动画</span></span><br><span class="line"><span class="keyword">const</span> mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(group);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 剪辑clip作为参数，通过混合器clipAction方法返回一个操作对象AnimationAction</span></span><br><span class="line"><span class="keyword">const</span> animationAction = mixer.<span class="title function_">clipAction</span>(clip);</span><br><span class="line"><span class="comment">//通过操作Action设置播放方式</span></span><br><span class="line">animationAction.<span class="property">timeScale</span> = <span class="number">5</span>;<span class="comment">//默认1，可以调节播放速度</span></span><br><span class="line">animationAction.<span class="property">loop</span> = <span class="variable constant_">THREE</span>.<span class="property">LoopOnce</span>; <span class="comment">//不循环播放,默认是循环播放</span></span><br><span class="line"><span class="comment">//暂停在最后一帧播放的状态,如果不循环播放就停在动画的最后一帧，而不是默认回到最初位置</span></span><br><span class="line">animationAction.<span class="property">clampWhenFinished</span> = <span class="literal">true</span>; </span><br><span class="line">animationAction.<span class="title function_">play</span>();<span class="comment">//开始播放</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//可以控制总的动画的开始时间</span></span><br><span class="line"><span class="comment">//animationAction.time=4</span></span><br><span class="line"><span class="comment">//如果更改动画的结束时间可开始时间等于是播放特定的帧</span></span><br><span class="line"><span class="comment">//clip.duration=4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//暂停动画的播放</span></span><br><span class="line"><span class="keyword">const</span> btn=  <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#pauseBtn&#x27;</span>)</span><br><span class="line">btn?.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  animationAction.<span class="property">paused</span>= !animationAction.<span class="property">paused</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">addObjectToScene</span>([group])</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置初始动画</span></span><br><span class="line"><span class="title function_">configPrimaryAnimation</span>(<span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>&gt;([</span><br><span class="line">  [<span class="string">&quot;a1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//混合器更新</span></span><br><span class="line">    clock.<span class="property">current</span> &amp;&amp; mixer.<span class="title function_">update</span>(clock.<span class="property">current</span>.<span class="title function_">getDelta</span>());</span><br><span class="line">  &#125;]</span><br><span class="line">]))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/three/three_basic/%E5%8A%A8%E7%94%BB%E5%B8%A7.gif" alt="动画帧"></p>
<h2 id="外部模型动画帧"><a href="#外部模型动画帧" class="headerlink" title="外部模型动画帧"></a>外部模型动画帧</h2><h1 id="变形动画"><a href="#变形动画" class="headerlink" title="变形动画"></a>变形动画</h1><p><strong>几何体的顶点的位置坐标发生变化，从一个状态过渡到另一个状态自然就产生了变形动画</strong></p>
<p>微信跳一跳小游戏就是变形动画</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> geometry = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>); <span class="comment">//立方体几何对象</span></span><br><span class="line"><span class="comment">// 为geometry提供变形目标的数据</span></span><br><span class="line"><span class="keyword">var</span> box1 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">6</span>, <span class="number">3</span>, <span class="number">6</span>); <span class="comment">//为变形目标1提供数据</span></span><br><span class="line"><span class="keyword">var</span> box2 = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">BoxGeometry</span>(<span class="number">4</span>, <span class="number">10</span>, <span class="number">4</span>); <span class="comment">//为变形目标2提供数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置变形目标的顶点数据数组</span></span><br><span class="line">geometry.<span class="property">morphAttributes</span>.<span class="property">position</span> = [];</span><br><span class="line"><span class="comment">//第一组变形数据</span></span><br><span class="line">geometry.<span class="property">morphAttributes</span>.<span class="property">position</span>[<span class="number">0</span>] = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(box1.<span class="title function_">getAttribute</span>(<span class="string">&#x27;position&#x27;</span>).<span class="property">array</span>, <span class="number">3</span>);</span><br><span class="line"><span class="comment">//第二组变形数据</span></span><br><span class="line">geometry.<span class="property">morphAttributes</span>.<span class="property">position</span>[<span class="number">1</span>] = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Float32BufferAttribute</span>(box2.<span class="title function_">getAttribute</span>(<span class="string">&#x27;position&#x27;</span>).<span class="property">array</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> material = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span></span><br><span class="line">&#125;); <span class="comment">//材质对象</span></span><br><span class="line"><span class="keyword">var</span> mesh = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(geometry, material); <span class="comment">//网格模型对象</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置第一组顶点在没有动画的情况下的是否影响 0-&gt;不影响 1-&gt;完全影响 0-1 之间的状态</span></span><br><span class="line">mesh.<span class="property">morphTargetInfluences</span> &amp;&amp; (mesh.<span class="property">morphTargetInfluences</span>[<span class="number">0</span>] = <span class="number">1</span>);</span><br><span class="line"><span class="comment">//配置第二组顶点在没有动画的情况下的是否影响 0-&gt;不影响 1-&gt;完全影响 0-1 之间的状态</span></span><br><span class="line">mesh.<span class="property">morphTargetInfluences</span> &amp;&amp; (mesh.<span class="property">morphTargetInfluences</span>[<span class="number">1</span>] = <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//第一组顶点变化 时间在 0, 10, 20 之间 权重分别是 0, 1, 0 （0秒不会改变原来的顶点，10秒完全改变到设置的第一组变形顶点，20秒恢复到默认的顶点</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Track1</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;.morphTargetInfluences[0]&#x27;</span>, [<span class="number">0</span>, <span class="number">10</span>, <span class="number">20</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]);</span><br><span class="line"><span class="comment">//第二组顶点变化</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Track2</span> = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">KeyframeTrack</span>(<span class="string">&#x27;.morphTargetInfluences[1]&#x27;</span>, [<span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> clip = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationClip</span>(<span class="string">&quot;default&quot;</span>, <span class="number">40</span>, [<span class="title class_">Track1</span>, <span class="title class_">Track2</span>]);</span><br><span class="line"><span class="keyword">const</span> mixer = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">AnimationMixer</span>(mesh); <span class="comment">//创建混合器</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">AnimationAction</span> = mixer.<span class="title function_">clipAction</span>(clip); <span class="comment">//返回动画操作对象</span></span><br><span class="line"><span class="title class_">AnimationAction</span>.<span class="property">timeScale</span> = <span class="number">5</span>; </span><br><span class="line"><span class="title class_">AnimationAction</span>.<span class="property">clampWhenFinished</span> = <span class="literal">true</span>;<span class="comment">//暂停在最后一帧播放的状态</span></span><br><span class="line"><span class="title class_">AnimationAction</span>.<span class="title function_">play</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置初始动画</span></span><br><span class="line"><span class="title function_">configPrimaryAnimation</span>(<span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>&gt;([</span><br><span class="line">  [<span class="string">&quot;a1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    clock.<span class="property">current</span> &amp;&amp; mixer.<span class="title function_">update</span>(clock.<span class="property">current</span>.<span class="title function_">getDelta</span>());</span><br><span class="line">  &#125;]</span><br><span class="line">]))</span><br><span class="line"></span><br><span class="line"><span class="title function_">addObjectToScene</span>([mesh])</span><br></pre></td></tr></table></figure>

<p><img src="/2022/06/05/three/three_basic/%E5%8F%98%E5%BD%A2%E5%8A%A8%E7%94%BB%E5%B8%A7.gif" alt="变形动画帧"></p>
<h1 id="使用外部模型"><a href="#使用外部模型" class="headerlink" title="使用外部模型"></a>使用外部模型</h1><p> <strong>大部分情况下对于复杂的模型，都是采用3D 软件设计模型导入到 THREE.js 进行交互</strong></p>
<p> 常用的外部模型:obj, fbx, gltf</p>
<blockquote>
<p>主流的是 gltf(GL TransmissionFormat)，即图形语言交换格式，它是一种3D内容的格式标准，由 Khronos Group管理<br>(Khronos Group还管理着OpenGL系列、OpenCL等重要的行业标准)<br>glTF的设计是面向实时渲染应用的，尽量提供可以直接传输给图形API的数据形式，不再需要二次转换；<br>glTF对OpenGL ES、WebGL非常友好,glTF的目标是：3D领域的JPEG；<br>GLTF具体的数据存储格式可以去官方网站上看：<a target="_blank" rel="noopener" href="https://www.khronos.org/gltf/%EF%BC%8C%E4%BD%BF%E7%94%A8">https://www.khronos.org/gltf/，使用</a> json 描述模型的结构</p>
</blockquote>
<p> gltf 常用的格式：</p>
<ol>
<li> 用二进制格式(.glb)，通常较小且独立，但不易编辑  </li>
<li> 嵌入式格式(.gltf), 其他模型利用转换工具也可以转成 .gltf 格式，基于json的文本文件</li>
<li> 分离式的</li>
</ol>
<p>如果不想使用THREE.JS 渲染 可以直接显示一个模型在网页里，还是伟大的谷歌公司开源的组件 model-viewer</p>
<blockquote>
<p>谷歌公司开源的一个 JS 项目： model-viewer<br>项目 Github 地址：<a target="_blank" rel="noopener" href="https://github.com/google/model-viewer">https://github.com/google/model-viewer</a><br>项目官网：<a target="_blank" rel="noopener" href="https://modelviewer.dev/">https://modelviewer.dev/</a><br>项目介绍：Easily display interactive 3D models on the web &amp; in AR<br>简单来说就是：在 Web 或 AR 中，一个简单的用来显示 3D 模型的 JS 库。</p>
</blockquote>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">GLTFLoader</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;three/examples/jsm/loaders/GLTFLoader&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> loader = <span class="keyword">new</span> <span class="title class_">GLTFLoader</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//模型文件如果是本地加载的话，要放在 public 目录内</span></span><br><span class="line">loader.<span class="title function_">load</span>(<span class="string">&#x27;models/untitled.gltf&#x27;</span>, <span class="function"><span class="params">gltf</span> =&gt;</span> &#123; </span><br><span class="line">  gltf.<span class="property">scene</span>.<span class="title function_">traverse</span>(<span class="function"><span class="params">p</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(p.<span class="property">type</span>===<span class="string">&#x27;Mesh&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">const</span> mesh= p <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">Mesh</span>;</span><br><span class="line">        <span class="keyword">const</span> material=  mesh.<span class="property">material</span> <span class="keyword">as</span> <span class="variable constant_">THREE</span>.<span class="property">MeshStandardMaterial</span> </span><br><span class="line">        material.<span class="property">color</span>=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Color</span>(<span class="string">&#x27;pink&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  gltf.<span class="property">scene</span>.<span class="title function_">translateX</span>(<span class="number">2</span>)</span><br><span class="line">  <span class="title function_">addObjectToScene</span>([gltf.<span class="property">scene</span>])</span><br><span class="line">&#125;, <span class="literal">undefined</span>, <span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(error.<span class="property">message</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h1 id="精灵模型和粒子系统"><a href="#精灵模型和粒子系统" class="headerlink" title="精灵模型和粒子系统"></a>精灵模型和粒子系统</h1><blockquote>
<p>精灵模型对象Sprite。精灵模型对象和网格模型一样需要设置材质，不过精灵模型不需要程序员设置几何体，Threejs系统渲染的时候会自动设置。<br>通过Threejs精灵模型可以给场景中模型对象设置标签，也快成大量精灵模型对象模拟一个粒子系统，实现下雨或下雪的渲染效果</p>
</blockquote>
<blockquote>
<p>它的特性是，永远正对相机平面。不像广告牌，可以绕到后面看看，绕到侧面看看，它永远会正对着你。所以我们可以用它来显示一些标签，比如在可视化监控系统中，就可以显示传感器的数据，</p>
</blockquote>
<p>模拟下雨</p>
<figure class="highlight tsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> texture = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>().<span class="title function_">load</span>(rain);</span><br><span class="line"><span class="comment">//创建精灵材质对象SpriteMaterial</span></span><br><span class="line"><span class="keyword">const</span> spriteMaterial = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">SpriteMaterial</span>(&#123;</span><br><span class="line">  <span class="attr">color</span>: <span class="number">0xffffff</span>,<span class="comment">//设置精灵矩形区域颜色</span></span><br><span class="line">  <span class="comment">//rotation:Math.PI/4,//旋转精灵对象45度，弧度值</span></span><br><span class="line">  <span class="attr">map</span>: texture,<span class="comment">//设置精灵纹理贴图</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> sprite = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Sprite</span>(spriteMaterial);</span><br><span class="line"><span class="comment">//z 方向的分量不会使用</span></span><br><span class="line">sprite.<span class="property">scale</span>.<span class="title function_">set</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> group = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Group</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> index = <span class="number">0</span>; index &lt; <span class="number">800</span>; index++) &#123;</span><br><span class="line">  <span class="keyword">const</span> clone = sprite.<span class="title function_">clone</span>()</span><br><span class="line">  clone.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">100</span> * (<span class="title class_">Math</span>.<span class="title function_">random</span>()-<span class="number">0.5</span>), <span class="number">30</span> * (<span class="title class_">Math</span>.<span class="title function_">random</span>()), <span class="number">100</span> * (<span class="title class_">Math</span>.<span class="title function_">random</span>()-<span class="number">0.6</span>))</span><br><span class="line">  clone.<span class="title function_">rotateX</span>(<span class="title class_">Math</span>.<span class="property">PI</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>())</span><br><span class="line">  clone.<span class="title function_">rotateY</span>(<span class="title class_">Math</span>.<span class="property">PI</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>())</span><br><span class="line">  clone.<span class="title function_">rotateZ</span>(<span class="title class_">Math</span>.<span class="property">PI</span> * <span class="title class_">Math</span>.<span class="title function_">random</span>())</span><br><span class="line">  group.<span class="title function_">add</span>(clone)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> grasslandTextureLoader=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">TextureLoader</span>();</span><br><span class="line"><span class="keyword">const</span> grasslandTexture= grasslandTextureLoader.<span class="title function_">load</span>(grassland)</span><br><span class="line">  <span class="keyword">const</span> planeGeometry=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">PlaneGeometry</span>(<span class="number">120</span>,<span class="number">120</span>)</span><br><span class="line">  <span class="keyword">const</span> plan=<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Mesh</span>(planeGeometry,<span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">MeshLambertMaterial</span>(&#123;<span class="attr">map</span>:grasslandTexture&#125;))</span><br><span class="line">  plan.<span class="title function_">rotateX</span>(-<span class="title class_">Math</span>.<span class="property">PI</span>*<span class="number">0.5</span>)</span><br><span class="line">  plan.<span class="property">position</span>.<span class="title function_">set</span>(<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="title function_">addObjectToScene</span>([group,plan]);</span><br><span class="line"><span class="title function_">configPrimaryAnimation</span>(<span class="keyword">new</span> <span class="title class_">Map</span>&lt;<span class="built_in">string</span>, <span class="title class_">Function</span>&gt;([</span><br><span class="line">  [<span class="string">&quot;a1&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    group.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">p</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (p.<span class="property">position</span>.<span class="property">y</span> &lt; -<span class="number">1</span>) &#123;</span><br><span class="line">        p.<span class="property">position</span>.<span class="property">y</span> =<span class="number">30</span></span><br><span class="line">      &#125;</span><br><span class="line">      p.<span class="property">position</span>.<span class="property">y</span> -= <span class="number">0.2</span>;</span><br><span class="line">      </span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;]</span><br><span class="line">]))</span><br></pre></td></tr></table></figure>
<p><img src="/2022/06/05/three/three_basic/rainSprint.gif" alt="rainSprint"></p>
<h1 id="dat-gui-工具的使用"><a href="#dat-gui-工具的使用" class="headerlink" title="dat.gui 工具的使用"></a>dat.gui 工具的使用</h1><p>Google Data Arts Team 开源一款插件,three.js 发起人参与此开源项目，此工具最大优势就是可插拨的加入项目,由于改变对象的属性</p>
<blockquote>
<p>官方文档<a target="_blank" rel="noopener" href="https://github.com/dataarts/dat.gui/blob/master/API.md">https://github.com/dataarts/dat.gui/blob/master/API.md</a></p>
</blockquote>
<p>在这个开源工具的基础有有基于react 开发的其他工具</p>
<p>GUI 会根据你设置的属性类型来渲染不同的控件</p>
<ol>
<li>如果是Number 类型则用 slider来控制</li>
<li>如果是 Boolean 类型，则用 Checkbox来控制</li>
<li>如果是 Function 类型则用 button 来控制</li>
<li>如果是 String 类型则用 input 来控制</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">gui.<span class="title function_">add</span>(text, <span class="string">&#x27;noiseStrength&#x27;</span>).<span class="title function_">step</span>(<span class="number">5</span>); <span class="comment">// 增长的步长</span></span><br><span class="line">gui.<span class="title function_">add</span>(text, <span class="string">&#x27;growthSpeed&#x27;</span>, -<span class="number">5</span>, <span class="number">5</span>); <span class="comment">// 最大、最小值</span></span><br><span class="line">gui.<span class="title function_">add</span>(text, <span class="string">&#x27;maxSize&#x27;</span>).<span class="title function_">min</span>(<span class="number">0</span>).<span class="title function_">step</span>(<span class="number">0.25</span>); <span class="comment">// 最大值和步长</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 文本输入项</span></span><br><span class="line">gui.<span class="title function_">add</span>(text, <span class="string">&#x27;message&#x27;</span>, [ <span class="string">&#x27;pizza&#x27;</span>, <span class="string">&#x27;chrome&#x27;</span>, <span class="string">&#x27;hooray&#x27;</span> ] );</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 下拉框形式选择文案</span></span><br><span class="line">gui.<span class="title function_">add</span>(text, <span class="string">&#x27;speed&#x27;</span>, &#123; <span class="title class_">Stopped</span>: <span class="number">0</span>, <span class="title class_">Slow</span>: <span class="number">0.1</span>, <span class="title class_">Fast</span>: <span class="number">5</span> &#125; );</span><br></pre></td></tr></table></figure>

<p>为了方便使用进行封装,见 hooks</p>
<p><img src="/2022/06/05/three/three_basic/dat-gui%E4%BD%BF%E7%94%A8%E6%95%88%E6%9E%9C.png" alt="dat-gui使用效果"></p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Hank Bai
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="http://bh.com/2022/06/05/three/three_basic/" title="three.js 基础">http://bh.com/2022/06/05/three/three_basic/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/05/29/git/git/" rel="prev" title="git 常用命令">
                  <i class="fa fa-chevron-left"></i> git 常用命令
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/06/05/three/three_%20advance/" rel="next" title="three.js 进阶">
                  three.js 进阶 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hank Bai</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">98k</span>
  </span>
</div>


  <script src='https://unpkg.com/mermaid@9.2.2/dist/mermaid.min.js'></script>
  <script>
    if (window.mermaid) {
      mermaid.initialize({theme: 'forest'});
    }
  </script>


    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"version":"9.2.2","theme":{"light":"default","dark":"dark","options":{"maxTextSize":99999}},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.2.2/mermaid.min.js","integrity":"sha256-CemUs9ITT7liCZpVMktcEw0BpAOZ1+mujlMB3UyuImU="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  




<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"BAI-HANK","repo":"bai-hank.github.io","client_id":"ee40f9d8aaf703fdb6ed","client_secret":"64cd53b08de038c5276753612c35ace517544597","admin_user":"BAI-HANK","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"zh-CN","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.7.2/gitalk.min.js","integrity":"sha256-Pmj85ojLaPOWwRtlMJwmezB/Qg8BzvJp5eTzvXaYAfA="},"path_md5":"700b944518b3bb4a6920de1aca87dba7"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":0.7}});</script></body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/custom/clickLove.js"></script>

